"use strict";(self.webpackChunkopen_docs=self.webpackChunkopen_docs||[]).push([[9194],{17942:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>d});var a=t(50959);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=a.createContext({}),p=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},c=function(e){var n=p(e.components);return a.createElement(l.Provider,{value:n},e.children)},u="mdxType",k={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},g=a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),u=p(t),g=o,d=u["".concat(l,".").concat(g)]||u[g]||k[g]||r;return t?a.createElement(d,s(s({ref:n},c),{},{components:t})):a.createElement(d,s({ref:n},c))}));function d(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var r=t.length,s=new Array(r);s[0]=g;var i={};for(var l in n)hasOwnProperty.call(n,l)&&(i[l]=n[l]);i.originalType=e,i[u]="string"==typeof e?e:o,s[1]=i;for(var p=2;p<r;p++)s[p]=t[p];return a.createElement.apply(null,s)}return a.createElement.apply(null,t)}g.displayName="MDXCreateElement"},40931:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>k,frontMatter:()=>r,metadata:()=>i,toc:()=>p});var a=t(28957),o=(t(50959),t(17942));const r={},s="\u90e8\u7f72",i={unversionedId:"deploy/deploy",id:"deploy/deploy",title:"\u90e8\u7f72",description:"\u524d\u6587\u53ef\u77e5\uff0c\u6211\u4eec ONES \u5c06 Project \u548c Wiki \u4e24\u90e8\u5206\u90fd\u8fdb\u884c\u4e86\u5f00\u6e90\u3002\u60a8\u53ef\u4ee5\u6839\u636e\u60a8\u7684\u9700\u6c42\u5bf9\u5355\u4e00\u5de5\u7a0b\u8fdb\u884c\u5f00\u53d1\uff0c\u4e5f\u53ef\u4ee5\u540c\u65f6\u5f00\u53d1\u4e24\u4e2a\u5de5\u7a0b\u3002\u5e76\u4e14\uff0c\u60a8\u80fd\u591f\u8fdb\u884c\u672c\u5730\u6784\u5efa\uff0c\u751f\u6210 tar \u5305\u3002",source:"@site/i18n/zh-CN/docusaurus-plugin-content-docs-project/current/deploy/deploy.md",sourceDirName:"deploy",slug:"/deploy/",permalink:"/open-docs/zh-CN/project/deploy/",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"deploy"},l={},p=[{value:"\u90e8\u7f72 wiki-web",id:"\u90e8\u7f72-wiki-web",level:2},{value:"\u79c1\u6709\u90e8\u7f72\u73af\u5883",id:"\u79c1\u6709\u90e8\u7f72\u73af\u5883",level:3},{value:"\u524d\u7f6e\u6761\u4ef6",id:"\u524d\u7f6e\u6761\u4ef6",level:4},{value:"\u90e8\u7f72\u6b65\u9aa4",id:"\u90e8\u7f72\u6b65\u9aa4",level:4},{value:"\u6267\u884c onesopenwiki \u5de5\u5177\uff0c\u751f\u6210 ones-release \u65b0\u955c\u50cf",id:"\u6267\u884c-onesopenwiki-\u5de5\u5177\u751f\u6210-ones-release-\u65b0\u955c\u50cf",level:5},{value:"\u90e8\u7f72\u65b0\u955c\u50cf",id:"\u90e8\u7f72\u65b0\u955c\u50cf",level:5},{value:"\u9a8c\u8bc1\u6548\u679c",id:"\u9a8c\u8bc1\u6548\u679c",level:5},{value:"\u56de\u9000",id:"\u56de\u9000",level:5},{value:"\u9ad8\u53ef\u7528\u73af\u5883",id:"\u9ad8\u53ef\u7528\u73af\u5883",level:3},{value:"\u524d\u7f6e\u6761\u4ef6",id:"\u524d\u7f6e\u6761\u4ef6-1",level:4},{value:"\u90e8\u7f72\u6b65\u9aa4",id:"\u90e8\u7f72\u6b65\u9aa4-1",level:4},{value:"\u6267\u884c onesopenwiki \u5de5\u5177\uff0c\u751f\u6210\u672c\u5730\u955c\u50cf\u6587\u4ef6",id:"\u6267\u884c-onesopenwiki-\u5de5\u5177\u751f\u6210\u672c\u5730\u955c\u50cf\u6587\u4ef6",level:5},{value:"\u5c06\u955c\u50cf\u63a8\u9001\u5230\u516c\u5171|\u79c1\u6709\u4ed3\u5e93",id:"\u5c06\u955c\u50cf\u63a8\u9001\u5230\u516c\u5171\u79c1\u6709\u4ed3\u5e93",level:5},{value:"\u9ad8\u53ef\u7528\u90e8\u7f72",id:"\u9ad8\u53ef\u7528\u90e8\u7f72",level:5},{value:"\u9a8c\u8bc1\u6548\u679c",id:"\u9a8c\u8bc1\u6548\u679c-1",level:5},{value:"\u56de\u9000",id:"\u56de\u9000-1",level:5},{value:"\u90e8\u7f72 ones-project-web",id:"\u90e8\u7f72-ones-project-web",level:2}],c={toc:p},u="wrapper";function k(e){let{components:n,...r}=e;return(0,o.kt)(u,(0,a.Z)({},c,r,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"\u90e8\u7f72"},"\u90e8\u7f72"),(0,o.kt)("p",null,"\u524d\u6587\u53ef\u77e5\uff0c\u6211\u4eec ONES \u5c06 Project \u548c Wiki \u4e24\u90e8\u5206\u90fd\u8fdb\u884c\u4e86\u5f00\u6e90\u3002\u60a8\u53ef\u4ee5\u6839\u636e\u60a8\u7684\u9700\u6c42\u5bf9\u5355\u4e00\u5de5\u7a0b\u8fdb\u884c\u5f00\u53d1\uff0c\u4e5f\u53ef\u4ee5\u540c\u65f6\u5f00\u53d1\u4e24\u4e2a\u5de5\u7a0b\u3002\u5e76\u4e14\uff0c\u60a8\u80fd\u591f\u8fdb\u884c\u672c\u5730\u6784\u5efa\uff0c\u751f\u6210 tar \u5305\u3002"),(0,o.kt)("p",null,"\u672c\u6587\u4ecb\u7ecd\uff0c\u5982\u4f55\u4f7f\u7528\u8fd0\u7ef4\u5de5\u5177\uff0c\u5c06 tar \u5305\u5728\u60a8\u7684\u751f\u4ea7\uff08\u6d4b\u8bd5\uff09\u73af\u5883\u4e2d\u8fdb\u884c\u90e8\u7f72\u3002\u8003\u8651\u5230\uff0cONES \u7684\u5ba2\u6237\u73af\u5883\u5305\u542b\uff1a\u79c1\u6709\u90e8\u7f72\u73af\u5883\uff0c\u9ad8\u53ef\u7528\u73af\u5883\u3002\u4e0b\u9762\uff0c\u6211\u4eec\u5206\u522b\u4ece\u8fd9\u4e24\u79cd\u73af\u5883\uff0c\u8be6\u7ec6\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528\u8fd0\u7ef4\u5de5\u5177\u6765\u90e8\u7f72 wiki-web\uff08ones-project-web \u540c\u7406\uff09\u3002"),(0,o.kt)("h2",{id:"\u90e8\u7f72-wiki-web"},"\u90e8\u7f72 wiki-web"),(0,o.kt)("h3",{id:"\u79c1\u6709\u90e8\u7f72\u73af\u5883"},"\u79c1\u6709\u90e8\u7f72\u73af\u5883"),(0,o.kt)("h4",{id:"\u524d\u7f6e\u6761\u4ef6"},"\u524d\u7f6e\u6761\u4ef6"),(0,o.kt)("p",null,"\u5728\u5f00\u59cb\u4e4b\u524d\uff0c\u8bf7\u8fdb\u884c\u4ee5\u4e0b\u51c6\u5907\u5de5\u4f5c\uff1a"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u79c1\u6709\u90e8\u7f72\u73af\u5883\u8bbe\u5907\uff1a\u60a8\u5df2\u7ecf\u62e5\u6709\u79c1\u6709\u90e8\u7f72\u5b9e\u4f8b\uff0c\u540e\u7eed\u76f8\u5173\u64cd\u4f5c\u90fd\u662f\u5728\u8be5\u5b9e\u4f8b\u8bbe\u5907\u4e0a\u9762\u8fdb\u884c\uff0c\u5982 192.168.100.10\u3002"),(0,o.kt)("li",{parentName:"ul"},"\u524d\u7aef\u5b9a\u5236 tar \u5305\uff1a\u672c\u5730\u6784\u5efa\u6240\u751f\u6210 tar \u5305\uff0c\u5982 ones-wiki-web.tar.gz\u3002"),(0,o.kt)("li",{parentName:"ul"},"\u8fd0\u7ef4\u5de5\u5177\uff1a\u8be5\u5de5\u5177\u5c06 tar \u5305\u96c6\u6210\u5230\u79c1\u6709\u90e8\u7f72\u73af\u5883\uff0c\u5982 onesopenwiki\u3002")),(0,o.kt)("p",null,"\u524d\u7aef\u5b9a\u5236 tar \u5305\u548c\u8fd0\u7ef4\u5de5\u5177\uff0c\u9700\u4e0a\u4f20\u5230\u79c1\u6709\u90e8\u7f72\u73af\u5883\u8bbe\u5907\u3002\u6709\u5f88\u591a\u65b9\u5f0f\u53ef\u4ee5\u5b9e\u73b0\uff0c\u5e38\u7528\u7684\u5982 scp\uff0cxftp\u3002\u5982\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"scp ones-wiki-web.tar.gz user_name@192.168.100.10:/home/user_name\nscp onesopenwiki user_name@192.168.100.10:/home/user_name\n")),(0,o.kt)("p",null,"\u786e\u8ba4\u6743\u9650\u3002onesopenwiki \u5de5\u5177\u8981\u6709\u53ef\u6267\u884c\u6743\u9650\u3002\u6267\u884c\u7684\u7528\u6237\uff08\u5982\u4e0b\u56fe root\uff09\uff0c\u8981\u6709 docker \u547d\u4ee4\u7b49\u6743\u9650\u3002\n",(0,o.kt)("img",{src:t(93124).Z,width:"1066",height:"222"})),(0,o.kt)("h4",{id:"\u90e8\u7f72\u6b65\u9aa4"},"\u90e8\u7f72\u6b65\u9aa4"),(0,o.kt)("h5",{id:"\u6267\u884c-onesopenwiki-\u5de5\u5177\u751f\u6210-ones-release-\u65b0\u955c\u50cf"},"\u6267\u884c onesopenwiki \u5de5\u5177\uff0c\u751f\u6210 ones-release \u65b0\u955c\u50cf"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cd ${\u90e8\u7f72\u5305\u76ee\u5f55\u4e0b}\n./onesopenwiki rebuild --wiki_web_tar=xxx --ones_release_tag=xxx --ones_release_out_tag=x.x.x.sp-x.x.x\nor\n./onesopenwiki rebuild --wiki_web_tar=xxx --ones_release_tag=xxx --ones_release_out_tag_major_version=x.x\n")),(0,o.kt)("p",null,"\u2022 \u60a8\u53ef\u4ee5\u901a\u8fc7\u6267\u884c\u547d\u4ee4 ./onesopenwiki rebuild --help \u83b7\u53d6\u5e2e\u52a9\u4fe1\u606f\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"[root@auto-test zhangyuan]# ./onesopenwiki rebuild --help\nRebuild the new ones-release image based on the customer Wiki Web tar package\n\nUsage:\n  onesopenwiki rebuild [flags]\n\nFlags:\n      --ones_release_out_tag string   [option]Tag of output ones-release image, format\uff1a${currentVersion}.sp-${ones_release_out_tag_major_version}.${number}\n      --ones_release_tag string       [require]Tag of input ones-release image\n      --wiki_web_tar string           [require]Tar package of ONES.AI Wiki Web\uff0csuffix:.tar.gz\n      --ones_release_out_tag_major_version string [require]Tag of output ones-release image tag major_version format: x.x\n")),(0,o.kt)("p",null,"\u2022 wiki_web_tar\uff0c\u5fc5\u586b\u9879\uff0c\u540e\u7f00\u683c\u5f0f\u8981\u6c42\uff1a.tar.gz\u3002\u8be5\u53c2\u6570\u6307\u5b9a\u524d\u7aef\u5b9a\u5236 tar \u5305\u3002"),(0,o.kt)("p",null,"\u2022 ones_release_tag \u53c2\u6570\uff0c\u5fc5\u586b\u9879\u3002\u79c1\u6709\u90e8\u7f72\u73af\u5883\u6240\u4f7f\u7528\u955c\u50cf ones-release \u7684 tag\u3002"),(0,o.kt)("p",null,"\u901a\u8fc7 deploy dir \u67e5\u770b ones-release \u7684 tag\u3002\n",(0,o.kt)("img",{src:t(12563).Z,width:"1992",height:"454"}),"\n\u901a\u8fc7 docker \u547d\u4ee4\u67e5\u770b\n",(0,o.kt)("img",{src:t(66319).Z,width:"1998",height:"356"}),"\n\u2022 ones_release_out_tag \u53c2\u6570\uff0c\u975e\u5fc5\u586b\u9879\u3002\u96c6\u6210\u524d\u7aef tar \u5305\u540e\u7684 ones-release \u65b0\u955c\u50cf\u7684 tag\u3002"),(0,o.kt)("p",null,"\u7528\u6237\u53ef\u4ee5\u81ea\u5b9a\u4e49\uff0c\u683c\u5f0f\u8981\u6c42\uff1a${\u5f53\u524d\u7248\u672c}.sp-${\u81ea\u5b9a\u4e49\u7248\u672c}(3.6.6.sp-1.0.0|3.6.7.8.sp-1.0.1)\uff0c\u5e76\u4e14\u4e0d\u80fd\u548c\u73b0\u6709\u7684 ones-release \u955c\u50cf tag \u91cd\u540d\u3002"),(0,o.kt)("p",null,"\u6267\u884c\u65e5\u5fd7\u5982\u4e0b\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"#\u793a\u4f8b\n[root@auto-test ones-test-0.1.15420]# ./onesopenwiki rebuild --wiki_web_tar=ones-wiki-web.tar.gz  --ones_release_tag=0.1.15420 --ones_release_out_tag_major_version=1.0\n===================================================================================================================\n2022-11-11 12:06:45\nlog: /tmp/ones_open_web.log\ncmd.checkRedeploy:101 enter\ninput params:{OnesReleaseTag:0.1.15420 ProjectWebTar:ones-wiki-web.tar.gz OnesReleaseOutTag: }\nAuto generate params...\ngenerate params:{OnesReleaseTag:0.1.15420 ProjectWebTar:ones-wiki-web.tar.gz OnesReleaseOutTag: OnesReleaseOutTagMajorVersion:1.0 }\ncmd.checkRedeploy:153 success\nworkdir:/tmp/ones1336995671\ncmd.renderRedeployDockerfile:157 enter\ncmd.renderRedeployDockerfile:170 success\ncmd.buildRedeployImage:174 enter\nBuilding image ones-release:0.1.15420.sp-1.0.1\nBuilding image will take several minutes,Please wait a moment...\ncmd.buildRedeployImage:186 success\nPlease continue to execute the following command to deploy the new image:\n        docker images | grep 0.1.15420.sp-1.0.1\n        enter deployment path(cd /data/ones/...)\n        rm -rf *.sp-*.tar && touch 0.1.15420.sp-1.0.1.tar && sh upgrade.sh && rm -rf 0.1.15420.sp-1.0.1.tar\nTo rollback the deployment image, execute the following command:\n        enter deployment path(cd /data/ones/...)\n        view the port (config.json 'port'|'https_port' field)\n        docker ps | grep (port) //get CONTAINER ID\n        docker rm -f (CONTAINER ID)\n        view the volume name (config.json 'volume' field)\n        docker volume rm (volume name), may be wrong please check the documentation(https://docs.partner.ones.cn/) or contact us.\n        ./onesconfigure regain --p backup package(.tar)\nIf you encounter any problems, please check the documentation(https://docs.partner.ones.cn/) or contact us.\n===================================================================================================================\n")),(0,o.kt)("h5",{id:"\u90e8\u7f72\u65b0\u955c\u50cf"},"\u90e8\u7f72\u65b0\u955c\u50cf"),(0,o.kt)("p",null,"\u5206\u4e3a\u4e24\u7c7b\uff1a\u6d4b\u8bd5\u73af\u5883\u90e8\u7f72\uff0c\u751f\u4ea7\u73af\u5883\u90e8\u7f72\u3002\u4e8c\u8005\uff0c\u6d41\u7a0b\u662f\u4e00\u6837\u7684\uff0c\u4ec5\u4ec5\u662f\u5bf9 tag \u53f7\u7684\u6709\u4e0d\u540c\u7684\u8981\u6c42\u3002"),(0,o.kt)("p",null,"\u6839\u636e\u6b65\u9aa4 2 \u7684\u63d0\u793a\uff0c\u8fdb\u884c\u65b0\u955c\u50cf\u90e8\u7f72\u3002\u9996\u5148 cd \u8fdb\u5165\u90e8\u7f72\u8def\u5f84\uff0c\u7136\u540e\u4f7f\u7528 upgrade.sh \u8fdb\u884c\u65b0\u955c\u50cf\u90e8\u7f72\u3002"),(0,o.kt)("p",null,"\u793a\u4f8b\u6267\u884c\u5982\u4e0b\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"#\u793a\u4f8b\n[root@auto-test ~]# docker images | grep 0.1.15420.sp-1.0.1\nones-release                     0.1.15420.sp-1.0.1            269507c43b62   5 minutes ago   11.6GB\n[root@auto-test ~]# cd /data/ones/pkg/69test_8fa28d\n[root@auto-test 69test_8fa28d]# ls\nones-test-0.1.14476  ones-test-0.1.14476.tar.gz\n[root@auto-test 69test_8fa28d]# cd ones-test-0.1.14476\n[root@auto-test ones-test-0.1.14476]# ls *.sh\nenv.sh  ones-deploy.sh  private_check.sh  upgrade.sh\n[root@auto-test ones-test-0.1.14476]# rm -rf *.sp-*.tar && touch 0.1.15420.sp-1.0.1.tar && sh upgrade.sh && rm -rf 0.1.15420.sp-1.0.1.tar\nCheck version\n Umask is 0022, is ok\nDisk space is ok\n1\n1\n1\n1\nLocal version: 0.1.15420  online version: 0.1.15420.sp-1.0.1\nNew version found, confirm upgrade: Y/N\ny\nStart upgrade...\n[INFO] 2022/10/11 12:07:50 image exists [ones-release:0.1.15420.sp-1.0.1]\n[INFO] 2022/10/11 12:07:54 get options from volume\n[INFO] 2022/10/11 12:07:55 upgrade options\n[INFO] 2022/10/11 12:07:55  check param enable_host_name_leak !!!!!!!!!!!\n[INFO] 2022/10/11 12:07:55  end check param enable_host_name_leak !!!!!!!!!!!\n[WARN] 2022/10/11 12:07:55 You are going to update from version 0.1.15420 to version 0.1.15420.sp-1.0.1 .\nIn version 3.6 you need to export audit log.\nHave you export the audit log?(enter Y/N)\nn\nAre you sure update ONES?(enter Y/N)\ny\n[INFO] 2022/10/11 12:07:57 stop openresty, ones-ai-audit-log-sync, ones-ai-binlog-event-sync, ones-ai-project-api, ones-ai-wiki-api...\n[INFO] 2022/10/11 12:07:58 backup audit-log-sync offset ...\n[INFO] 2022/10/11 12:07:58 Backup volume data\n[INFO] 2022/10/11 12:08:17 waiting for mysql up ...\n")),(0,o.kt)("p",null,(0,o.kt)("img",{src:t(31173).Z,width:"1238",height:"963"})),(0,o.kt)("h5",{id:"\u9a8c\u8bc1\u6548\u679c"},"\u9a8c\u8bc1\u6548\u679c"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u524d\u7aef\u6548\u679c\u9a8c\u8bc1\u3002\u9a8c\u8bc1\u5ba2\u6237\u7684\u5b9a\u5236\u6539\u52a8\u6548\u679c\u3002"),(0,o.kt)("li",{parentName:"ul"},"docker \u547d\u4ee4\u67e5\u770b\u3002")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"docker ps |grep 443\n")),(0,o.kt)("h5",{id:"\u56de\u9000"},"\u56de\u9000"),(0,o.kt)("p",null,"\u5982\u679c\u9700\u8981\u56de\u9000\u5230\u4e4b\u524d\u7684\u73af\u5883\uff0c\u90a3\u4e48\u6839\u636e\u6b65\u9aa4 2 \u7684\u63d0\u793a\u6216\u8005\u67e5\u770b/tmp/ones_open.log \u65e5\u5fd7\u5185\u5bb9\uff0c\u6267\u884c\u76f8\u5173\u547d\u4ee4\u6765\u5b9e\u73b0\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"1\u3001\u8fdb\u5165\u5230\u90e8\u7f72\u5305\u76ee\u5f55\u4e0b\n2\u3001\u67e5\u770b\u90e8\u7f72\u73af\u5883\u7aef\u53e3\u53f7port // cat config.json | grep port\n3\u3001\u6267\u884c docker ps | grep (port) //\u83b7\u53d6CONTAINER ID\n4\u3001\u6267\u884c docker rm -f (CONTAINER ID) //\u5220\u9664\u5bb9\u5668\n5\u3001\u67e5\u770b\u90e8\u7f72\u73af\u5883\u5bb9\u5668\u7684volume name // cat config.json | grep volume\n6\u3001\u6267\u884c docker volume rm (volume name) //\u5220\u9664\u5bb9\u5668\u5377 \u8be5\u6b65\u9aa4\u53ef\u80fd\u4f1a\u62a5\u9519\uff0c\u8bf7\u67e5\u770b\u4e0b\u9762\u7684\u64cd\u4f5c\u793a\u4f8b\u56fe\n7\u3001\u6267\u884c ./onesconfigure regain --p (backup package) //backup package:\u90e8\u7f72\u5305\u76ee\u5f55\u4e0b\u7684\u5907\u4efd\u5305 \u56de\u6eda\u64cd\u4f5c\n")),(0,o.kt)("p",null,(0,o.kt)("img",{src:t(53669).Z,width:"1518",height:"431"})),(0,o.kt)("h3",{id:"\u9ad8\u53ef\u7528\u73af\u5883"},"\u9ad8\u53ef\u7528\u73af\u5883"),(0,o.kt)("h4",{id:"\u524d\u7f6e\u6761\u4ef6-1"},"\u524d\u7f6e\u6761\u4ef6"),(0,o.kt)("p",null,"\u5728\u5f00\u59cb\u4e4b\u524d\uff0c\u8bf7\u8fdb\u884c\u4ee5\u4e0b\u51c6\u5907\u5de5\u4f5c\uff1a"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u9ad8\u53ef\u7528\u73af\u5883\u8bbe\u5907\uff1ak8s \u64cd\u4f5c\u673a\u5668\uff0c\u5b9e\u73b0\u9ad8\u53ef\u7528\u7684\u66f4\u65b0\u90e8\u7f72\uff08\u5982 192.168.100.10\uff09\u3002"),(0,o.kt)("li",{parentName:"ul"},"\u524d\u7aef\u5b9a\u5236 tar \u5305\uff1a\u672c\u5730\u6784\u5efa&\u751f\u6210\u5ba2\u6237\u5b9a\u5236\u7684 tar \u5305\uff0c\u5982 ones-wiki-web.tar.gz\u3002"),(0,o.kt)("li",{parentName:"ul"},"\u8fd0\u7ef4\u5de5\u5177\uff1a",(0,o.kt)("a",{parentName:"li",href:"https://www.docker.com/products/docker-desktop/"},"docker")," \u3001onesopenwiki\u3002")),(0,o.kt)("p",null,"\u672c\u5730\u5b89\u88c5\u5e76\u914d\u7f6e\u597d dokcer \u73af\u5883\u3002\u5efa\u8bae\u60a8\u901a\u8fc7 google \u641c\u7d22 docker\uff0c\u4e0b\u8f7d\u5e76\u5b89\u88c5\u3002"),(0,o.kt)("p",null,"\u786e\u8ba4\u6743\u9650\u3002onesopenwiki \u5de5\u5177\u8981\u6709\u53ef\u6267\u884c\u6743\u9650\u3002"),(0,o.kt)("h4",{id:"\u90e8\u7f72\u6b65\u9aa4-1"},"\u90e8\u7f72\u6b65\u9aa4"),(0,o.kt)("h5",{id:"\u6267\u884c-onesopenwiki-\u5de5\u5177\u751f\u6210\u672c\u5730\u955c\u50cf\u6587\u4ef6"},"\u6267\u884c onesopenwiki \u5de5\u5177\uff0c\u751f\u6210\u672c\u5730\u955c\u50cf\u6587\u4ef6"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"./onesopenwiki webimage --wiki_web_out_tag=xxx --wiki_web_tar=xxx\n")),(0,o.kt)("p",null,"\u2022 \u60a8\u53ef\u4ee5\u901a\u8fc7\u6267\u884c\u547d\u4ee4 ./onesopenwiki webimage --help \u83b7\u53d6\u5e2e\u52a9\u4fe1\u606f\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"[root@auto-test zhangyuan]# ./onesopenwiki webimage --help\nBuild wiki_web image based on the customer Wiki Web tar package\n\nUsage:\n  onesopenwiki webimage [flags]\n\nFlags:\n      --wiki_web_out_tag string   [option]Tag of output wiki_web image, format\uff1a9.0.yyyymmddxx\n      --wiki_web_tar string       [require]Tar package of ONES.AI Wiki Web\uff0csuffix:.tar.gz\n")),(0,o.kt)("p",null,"\u2022 wiki_web_tar \u53c2\u6570\uff0c\u5fc5\u586b\u9879\uff0c\u540e\u7f00\u683c\u5f0f\u8981\u6c42\uff1a.tar.gz\u3002\u8be5\u53c2\u6570\u6307\u5b9a\u524d\u7aef\u5b9a\u5236 tar \u5305\u3002"),(0,o.kt)("p",null,"\u8be5\u53c2\u6570\u7684\u83b7\u53d6\uff0c\u53c2\u8003\u79c1\u6709\u90e8\u7f72\uff0c"),(0,o.kt)("p",null,"\u2022 wiki_web_out_tag \u53c2\u6570\uff0c\u975e\u5fc5\u586b\u9879\u3002\u6839\u636e\u524d\u7aef tar \u5305\uff0c\u751f\u6210\u955c\u50cf wiki-web \u7684 tag\u3002"),(0,o.kt)("p",null,"\u7528\u6237\u53ef\u4ee5\u81ea\u5b9a\u4e49\uff0c\u683c\u5f0f\u8981\u6c42\uff1a9.0.yyyymmddxx\uff0c\u5747\u4e3a\u6570\u5b57\uff0c\u5e76\u4e14\u4e0d\u80fd\u548c\u73b0\u6709\u7684 wiki-web \u955c\u50cf tag \u91cd\u540d\u3002"),(0,o.kt)("p",null,"\u2022 \u6267\u884c\u8be5\u547d\u4ee4\u4f1a\u751f\u6210\u751f\u6210\u672c\u5730\u955c\u50cf\u6587\u4ef6\uff0c\u53ef\u901a\u8fc7 docker images |grep xxx \u67e5\u770b"),(0,o.kt)("p",null,"\u793a\u4f8b\u65e5\u5fd7\u5982\u4e0b\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"[root@auto-test zhangyuan]# ./onesopenwiki webimage --wiki_web_tar=ones-wiki-web.tar.gz\n===================================================================================================================\n2022-09-11 11:11:22\nlog: /tmp/ones_open_wiki.log\ncmd.checkWebImage:51 enter\ninput params:{WikiWebTar:ones-wiki-web.tar.gz WikiWebOutTag:}\nAuto generate params...\ngenerate params:{WikiWebTar:ones-wiki-web.tar.gz WikiWebOutTag:9.0.2022081100}\ncmd.checkWebImage:91  success\nworkdir:/tmp/ones685568270\ncmd.renderWebImageDockerfile:126 enter\ncmd.renderWebImageDockerfile:138 success\ncmd.buildWebImageImage:142 enter\nBuilding image wiki-web:9.0.2022081100\nBuilding image will take several minutes,Please wait a moment...\ncmd.buildWebImageImage:154 success\nShow the generated image:\n    docker images | grep 9.0.2022081100\n===================================================================================================================\n\n")),(0,o.kt)("h5",{id:"\u5c06\u955c\u50cf\u63a8\u9001\u5230\u516c\u5171\u79c1\u6709\u4ed3\u5e93"},"\u5c06\u955c\u50cf\u63a8\u9001\u5230\u516c\u5171|\u79c1\u6709\u4ed3\u5e93"),(0,o.kt)("p",null,"\u5982\u679c\u955c\u50cf\u6258\u7ba1\u5230\u516c\u5171\u4ed3\u5e93 Dockerhub\uff0c\u90a3\u4e48\u53c2\u8003\u65b9\u5f0f a \u63a8\u9001\u5230\u516c\u5171\u4ed3\u5e93\uff1b\u5982\u679c\u662f\u5ba2\u6237\u79c1\u6709\u4ed3\u5e93\uff0c\u53c2\u8003\u65b9\u5f0f b \u63a8\u9001\u5230\u79c1\u6709\u4ed3\u5e93\u3002"),(0,o.kt)("p",null,"\u2022 \u63a8\u9001\u5230\u516c\u5171\u4ed3\u5e93"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"docker tag wiki-web:9.0.2022080201 onestest/wiki-web:v9.0.0\ndocker push onestest/wiki-web:v9.0.0\n")),(0,o.kt)("p",null,(0,o.kt)("img",{src:t(76213).Z,width:"1634",height:"338"})),(0,o.kt)("p",null,"\u2022 \u63a8\u9001\u5230\u79c1\u6709\u4ed3\u5e93"),(0,o.kt)("p",null,"\u4ee5\u79c1\u6709\u4ed3\u5e93 192.168.1.100 \u4e3a\u4f8b"),(0,o.kt)("p",null,"\u2022 \u914d\u7f6e\u4fe1\u4efb\u79c1\u6709\u4ed3(\u53ef\u9009)"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'#\u6ce8\u610f\u5982\u679c\u60a8\u7684\u79c1\u6709\u4ed3\u5e93\u5e26\u53d7\u4fe1\u4efbhttps\u8bc1\u4e66\uff0c\u5219\u4e0d\u9700\u8981\u4fee\u6539 /etc/docker/daemon.json\nvim /etc/docker/daemon.json\n{\n    "insecure-registers":[\n        "192.168.1.100"\n    ]\n}\n\nsystemctl restart docker\n')),(0,o.kt)("p",null,"\u2022 \u767b\u5f55\u79c1\u6709\u4ed3\u5e93"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"#u \u4e3a\u767b\u5f55\u7684\u7528\u6237\u8d26\u53f7;p \u4e3a\u8be5\u7528\u6237\u5bc6\u7801\u3002\u8981\u6c42\u767b\u5f55\u7684\u8d26\u53f7\u5177\u6709\u955c\u50cf\u63a8\u9001\u7684\u6743\u9650\u3002\ndocker login 192.168.1.100 -u xxx -p xxx\n")),(0,o.kt)("p",null,"\u2022 \u63a8\u9001\u5230\u79c1\u6709\u4ed3\u5e93"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"docker tag wiki-web:9.0.2022080201  192.168.1.100/\u9879\u76ee/wiki-web:v9.0.2\ndocker push 192.168.1.100/\u9879\u76ee/wiki-web:v9.0.2\n")),(0,o.kt)("p",null,"\u767b\u5f55 ",(0,o.kt)("a",{parentName:"p",href:"https://192.168.1.100/"},"\u9879\u76ee\u7684\u4ed3\u5e93")," \uff0c\u67e5\u770b\u521a\u624d\u4e0a\u4f20\u7684\u955c\u50cf\u6587\u4ef6\n",(0,o.kt)("img",{src:t(11417).Z,width:"1160",height:"251"})),(0,o.kt)("h5",{id:"\u9ad8\u53ef\u7528\u90e8\u7f72"},"\u9ad8\u53ef\u7528\u90e8\u7f72"),(0,o.kt)("p",null,"\u767b\u5f55\u5230 k8s \u64cd\u4f5c\u673a\uff0c\u6267\u884c\u4ee5\u4e0b\u6b65\u9aa4\uff0c\u5b9e\u73b0\u6eda\u52a8\u66f4\u65b0\u64cd\u4f5c\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"#\u914d\u7f6e\u6587\u4ef6\u4f18\u5148\u7ea7\u8bf4\u660e: config/private.yaml > config/public.yaml > default/config.yaml\n#\u4fee\u6539config/private.yaml\u3002\u6dfb\u52a0or\u4fee\u6539 wikiWebImage\n# wikiWebImage: 192.168.1.100/\u9879\u76ee/wiki-web:v9.0.2\nvi /data/ones/ones-ai-k8s/config/private.yaml\n# \u91cd\u65b0\u90e8\u7f72\u9ad8\u53ef\u7528\u73af\u5883\nmake setup-ones\n")),(0,o.kt)("h5",{id:"\u9a8c\u8bc1\u6548\u679c-1"},"\u9a8c\u8bc1\u6548\u679c"),(0,o.kt)("p",null,"\u2022 \u67e5\u770b wiki-web \u955c\u50cf\u7684\u7248\u672c\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl -n ones-namespace  get pods -o yaml |grep image |grep wiki-web\n")),(0,o.kt)("p",null,"\u2022 \u524d\u7aef\u6548\u679c\u9a8c\u8bc1"),(0,o.kt)("h5",{id:"\u56de\u9000-1"},"\u56de\u9000"),(0,o.kt)("p",null,"\u5982\u679c\u9700\u8981\u56de\u9000\u6b64\u6b21\u90e8\u7f72\uff0c\u53ef\u901a\u8fc7\u6eda\u52a8\u66f4\u65b0\u64cd\u4f5c\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"#\u5c063\u6539\u52a8\u8fd8\u539f\u56de\u53bb\nvi /data/ones/ones-ai-k8s/config/private.yaml\n# \u66f4\u65b0\u64cd\u4f5c\nmake setup-ones\n")),(0,o.kt)("h2",{id:"\u90e8\u7f72-ones-project-web"},"\u90e8\u7f72 ones-project-web"),(0,o.kt)("p",null,"\u60a8\u53ea\u9700\u5c06 ones-wiki-web.tar.gz \u66ff\u6362\u6210 ones-ai-web.tar.gz\uff0c\u8fd0\u7ef4\u5de5\u5177 \u4ece onesopenwiki \u6539\u4e3a onesopenproject\u3002"),(0,o.kt)("p",null,"\u9ad8\u53ef\u7528\u73af\u5883\uff0c\u914d\u7f6e\u9879 wikiWebImage \u6539\u4e3a projectWebImage\u3002"),(0,o.kt)("p",null,"\u5176\u4ed6\u6d41\u7a0b\u6309\u7167\u4e0a\u8ff0\u6587\u6863\u64cd\u4f5c\u5373\u53ef\u3002"))}k.isMDXComponent=!0},31173:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/deploy-90a6144736c7ca43a681cd77fa5c164a.png"},12563:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/ones-release-tag-01-1a01113aacf4217404d55ef3cc059288.png"},66319:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/ones-release-tag-02-85aa812c7ff6d76918e6562ca4931412.png"},11417:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/onesproject_private-bd3c3e263bd94a4e75d06a392ead9626.png"},76213:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/onesproject_public-8a2a99962a1f9304ca18a87df271b8cb.png"},93124:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/oneswiki_permission-1309f88d35f4442c2d26f375e0351ce2.png"},53669:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/rollback-8ff635f7826663b6f083afd3e0367839.png"}}]);