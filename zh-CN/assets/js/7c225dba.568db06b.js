(self.webpackChunkopen_docs=self.webpackChunkopen_docs||[]).push([[96067],{23579:(e,t,a)=>{e.exports={src:{srcSet:a.p+"assets/ideal-img/code-repo-example-add-repo.b1269ad.518.png 518w",images:[{path:a.p+"assets/ideal-img/code-repo-example-add-repo.b1269ad.518.png",width:518,height:574}],src:a.p+"assets/ideal-img/code-repo-example-add-repo.b1269ad.518.png",toString:function(){return a.p+"assets/ideal-img/code-repo-example-add-repo.b1269ad.518.png"},placeholder:void 0,width:518,height:574},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAALCAYAAABGbhwYAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAqklEQVQYlYWRzQrDIBCEff+36QP00HuPvfSQUyk0Cf5EIopxd8pKUpCQdGGQXT7dYVTeewzDgGmaIMXMO5VSoOZ5hsDSyJCIGojWXoUQkFKqgzMpAXPOv9uHoPcezjksy3IIs6wWj6K/q421+PQ9rLXQWsMYU89NMo8xQl0eAfdXqtEQ7aPZpN79iFHbFWyjaUCmAj7xJvlWj8zyG/XBpkgSyAnXZ8Cti/gCFbmu6t1DzD4AAAAASUVORK5CYII="}},645:(e,t,a)=>{e.exports={src:{srcSet:a.p+"assets/ideal-img/code-repo-example-connector.e08c23b.648.png 648w",images:[{path:a.p+"assets/ideal-img/code-repo-example-connector.e08c23b.648.png",width:648,height:662}],src:a.p+"assets/ideal-img/code-repo-example-connector.e08c23b.648.png",toString:function(){return a.p+"assets/ideal-img/code-repo-example-connector.e08c23b.648.png"},placeholder:void 0,width:648,height:662},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAy0lEQVQYlWWPXU7EMAyEc/9DcQ8WIV54ALHQbtP4J3E8yC5dkIj0aWRrMrZLI0KtFWMMxHP3f8w5UZwqxn5DIwYzQ0TyU+89UdXUMqMpgr21e/NMmT+k0WmD1gXLestEIkptrd3rmFJEB4gVqsdIM0sNIu1co2gfEOmZEL+jGeYgjKFpXBn43DrWr2uaI1nkOEqD85hlI3ysDZU7WAIFiYL1qClRlLeXC16fH3Elxy4Du9ovYqA+0VhRdDi6OSwWt784pg1c3gkPT4RvaJyGPlNXsOAAAAAASUVORK5CYII="}},83912:(e,t,a)=>{"use strict";a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>p,default:()=>c,frontMatter:()=>o,metadata:()=>r,toc:()=>u});var n=a(87462),l=(a(67294),a(3905)),i=a(15944);const o={},p="\u573a\u666f\uff1a\u96c6\u6210\u6307\u5b9a\u7248\u672c\u79c1\u6709 Gitlab \u4ee3\u7801\u4ed3",r={unversionedId:"abilities/business/custom-code-repository/custom-code-repository-private-gitlab",id:"abilities/business/custom-code-repository/custom-code-repository-private-gitlab",title:"\u573a\u666f\uff1a\u96c6\u6210\u6307\u5b9a\u7248\u672c\u79c1\u6709 Gitlab \u4ee3\u7801\u4ed3",description:"\u573a\u666f\u63cf\u8ff0",source:"@site/i18n/zh-CN/docusaurus-plugin-content-docs/current/abilities/business/custom-code-repository/custom-code-repository-private-gitlab.mdx",sourceDirName:"abilities/business/custom-code-repository",slug:"/abilities/business/custom-code-repository/custom-code-repository-private-gitlab",permalink:"/zh-CN/docs/next/abilities/business/custom-code-repository/custom-code-repository-private-gitlab",draft:!1,tags:[],version:"current",lastUpdatedBy:"liupengfei",lastUpdatedAt:1690791943,formattedLastUpdatedAt:"2023\u5e747\u670831\u65e5",frontMatter:{},sidebar:"abilities",previous:{title:"\u96c6\u6210\u4ee3\u7801\u4ed3",permalink:"/zh-CN/docs/next/abilities/business/custom-code-repository/"},next:{title:"Item \u5904\u7406\u5668",permalink:"/zh-CN/docs/next/abilities/business/item-handler/"}},s={},u=[{value:"\u573a\u666f\u63cf\u8ff0",id:"\u573a\u666f\u63cf\u8ff0",level:2},{value:"\u5b9e\u73b0\u6548\u679c",id:"\u5b9e\u73b0\u6548\u679c",level:2},{value:"\u89e3\u51b3\u65b9\u6848",id:"\u89e3\u51b3\u65b9\u6848",level:2},{value:"\u5b9e\u73b0\u601d\u8def",id:"\u5b9e\u73b0\u601d\u8def",level:3},{value:"\u63d2\u4ef6\u5f00\u53d1",id:"\u63d2\u4ef6\u5f00\u53d1",level:3},{value:"\u7b2c\u4e00\u6b65\uff1a\u6dfb\u52a0\u80fd\u529b\u548c\u63d2\u69fd",id:"\u7b2c\u4e00\u6b65\u6dfb\u52a0\u80fd\u529b\u548c\u63d2\u69fd",level:4},{value:"\u7b2c\u4e8c\u6b65\uff1a\u5b9e\u73b0 OAuth \u8ba4\u8bc1",id:"\u7b2c\u4e8c\u6b65\u5b9e\u73b0-oauth-\u8ba4\u8bc1",level:4},{value:"\u7b2c\u4e09\u6b65\uff1a\u65b0\u589e\u5173\u8054\u4ee3\u7801\u4ed3",id:"\u7b2c\u4e09\u6b65\u65b0\u589e\u5173\u8054\u4ee3\u7801\u4ed3",level:4},{value:"\u7b2c\u56db\u6b65\uff1a\u65b0\u589e\u4ee3\u7801\u4ed3\u63d0\u4ea4\uff08Commit\uff09\u548c\u5408\u5e76\u8bf7\u6c42\uff08Pull Request\uff09",id:"\u7b2c\u56db\u6b65\u65b0\u589e\u4ee3\u7801\u4ed3\u63d0\u4ea4commit\u548c\u5408\u5e76\u8bf7\u6c42pull-request",level:4}],d={toc:u};function c(e){let{components:t,...o}=e;return(0,l.kt)("wrapper",(0,n.Z)({},d,o,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"\u573a\u666f\u96c6\u6210\u6307\u5b9a\u7248\u672c\u79c1\u6709-gitlab-\u4ee3\u7801\u4ed3"},"\u573a\u666f\uff1a\u96c6\u6210\u6307\u5b9a\u7248\u672c\u79c1\u6709 Gitlab \u4ee3\u7801\u4ed3"),(0,l.kt)("h2",{id:"\u573a\u666f\u63cf\u8ff0"},"\u573a\u666f\u63cf\u8ff0"),(0,l.kt)("p",null,"\u7528\u6237\u5e0c\u671b\u96c6\u6210\u96c6\u6210\u6307\u5b9a\u7248\u672c\u79c1\u6709 Gitlab \u4ee3\u7801\u4ed3\uff0c\u6b64\u65f6\u53ef\u4ee5\u5728\u63d2\u4ef6\u4e2d\u4f7f\u7528 \u201c\u81ea\u5b9a\u4e49\u96c6\u6210\u4ee3\u7801\u4ed3\u80fd\u529b\u201d \u6765\u5b9e\u73b0\uff0c\u8fd9\u91cc\u6211\u4eec\u4ee5 Gitlab15.4 \u7248\u672c\u4e3a\u4f8b\u3002"),(0,l.kt)("h2",{id:"\u5b9e\u73b0\u6548\u679c"},"\u5b9e\u73b0\u6548\u679c"),(0,l.kt)("p",null,"\u7cfb\u7edf\u5b89\u88c5\u5b8c\u63d2\u4ef6\u540e\uff0c\u5373\u53ef\u5728\u5173\u8054\u4ee3\u7801\u4ed3\u65b9\u5f0f\u5217\u8868\u67e5\u770b\u5230\u65b0\u589e\u7684\u81ea\u5b9a\u4e49\u7684 Gitlab15.4 \u5173\u8054\u65b9\u5f0f\u3002"),(0,l.kt)(i.Z,{img:a(645),style:{maxWidth:700},mdxType:"Image"}),(0,l.kt)("p",null,"\u5f00\u53d1\u8005\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539 ",(0,l.kt)("a",{parentName:"p",href:"/zh-CN/docs/next/abilities/slot/module/configuration/code-integration/default/code-repository/#onessettingspipelinedefaultrepolink"},"ones:settings:pipeline:default:repo:link")," \u63d2\u69fd\uff0c\u81ea\u5b9a\u4e49\u5982\u4e0b\u5173\u8054\u4ee3\u7801\u4ed3\u9875\u9762\uff0c\u5b9e\u73b0 Gitlab \u8ba4\u8bc1\u903b\u8f91\u548c\u6dfb\u52a0\u4ee3\u7801\u4ed3\u903b\u8f91\u3002"),(0,l.kt)(i.Z,{img:a(23579),style:{maxWidth:700},mdxType:"Image"}),(0,l.kt)("p",null,"\u65b0\u589e\u5173\u8054\u4ee3\u7801\u4ed3\u6210\u529f\u540e\uff0c\u5373\u53ef\u5728\u4ee3\u7801\u4ed3\u7ba1\u7406\u9875\u9762\u67e5\u770b\u3002\u5f53\u4ee3\u7801\u4ed3\u65b0\u589e\u63d0\u4ea4\uff08Commit\uff09\u548c\u5408\u5e76\u8bf7\u6c42\uff08Pull Request\uff09\u65f6\u5982\u679c\u5173\u8054\u4e86\u5de5\u4f5c\u9879 ID\uff0c\u53ef\u4ee5\u5728\u8fed\u4ee3\u548c\u5de5\u4f5c\u9879\u4e0b\u67e5\u770b\u5230\u5173\u8054\u7684\u8bb0\u5f55\u3002"),(0,l.kt)("h2",{id:"\u89e3\u51b3\u65b9\u6848"},"\u89e3\u51b3\u65b9\u6848"),(0,l.kt)("h3",{id:"\u5b9e\u73b0\u601d\u8def"},"\u5b9e\u73b0\u601d\u8def"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u901a\u8fc7 OAuth \u8ba4\u8bc1 Gitlab\uff0c\u83b7\u53d6 Gitlab \u7684 access_token\uff1b"),(0,l.kt)("li",{parentName:"ol"},"\u4f7f\u7528\u83b7\u53d6\u7684 Gitlab access_token\uff0c\u4ece Gitlab \u67e5\u8be2\u4ee3\u7801\u4ed3\u8fdb\u884c\u5173\u8054\uff1b"),(0,l.kt)("li",{parentName:"ol"},"\u5173\u8054\u4ee3\u7801\u4ed3\u524d\u8c03\u7528 Gitlab api \u521b\u5efa webhook\uff0c\u540c\u6b65\u5173\u8054\u4ee3\u7801\u4ed3\u7684\u63d0\u4ea4\uff08Commit\uff09\u548c\u5408\u5e76\u8bf7\u6c42\uff08Pull Request\uff09\u6570\u636e\u5230 ONES \u7cfb\u7edf\u4e2d\uff0c\u6b64\u65f6\u63d2\u4ef6\u9700\u5b9a\u4e49\u53ef\u7528\u4e8e Gitlab \u8bbf\u95ee\u7684\u63a5\u53e3\u3002")),(0,l.kt)("h3",{id:"\u63d2\u4ef6\u5f00\u53d1"},"\u63d2\u4ef6\u5f00\u53d1"),(0,l.kt)("h4",{id:"\u7b2c\u4e00\u6b65\u6dfb\u52a0\u80fd\u529b\u548c\u63d2\u69fd"},"\u7b2c\u4e00\u6b65\uff1a\u6dfb\u52a0\u80fd\u529b\u548c\u63d2\u69fd"),(0,l.kt)("p",null,"\u53c2\u8003 ",(0,l.kt)("a",{parentName:"p",href:"/zh-CN/docs/next/abilities/business/custom-code-repository/#%E7%AC%AC%E4%B8%80%E6%AD%A5%E5%9C%A8%E6%8F%92%E4%BB%B6%E9%A1%B9%E7%9B%AE%E4%B8%AD%E6%B7%BB%E5%8A%A0%E8%83%BD%E5%8A%9B%E5%92%8C%E6%8F%92%E6%A7%BD%E9%85%8D%E7%BD%AE"},"\u81ea\u5b9a\u4e49\u96c6\u6210\u4ee3\u7801\u4ed3-\u6dfb\u52a0\u80fd\u529b\u548c\u63d2\u69fd\u914d\u7f6e"),"\uff0c\u4e3a\u63d2\u4ef6\u6dfb\u52a0\u80fd\u529b\u548c\u63d2\u69fd\u914d\u7f6e\uff0c\u6dfb\u52a0\u5b8c\u914d\u7f6e\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"service: ...\napis: ...\nabilities:\n  - id: CkrqExqC\n    name: \u81ea\u5b9a\u4e49\u4ee3\u7801\u4ed3\u5e93\n    version: 1.0.0\n    abilityType: CustomCodeRepository\n    relateModule:\n      addRepoPage: 'ones-settings-pipeline-default-repo-link-R5w-'\n    function:\n      removeRepoFunc: removeRepo\n    config:\n      - key: repoToolName\n        label: \u5173\u8054\u4ee3\u7801\u4ed3\u5de5\u5177\u540d\u79f0\n        value: \u81ea\u5b9a\u4e49\u5173\u8054\u4ee3\u7801\u4ed3\u5de5\u5177\n        fieldType: Input\n        show: true\n      - key: repoToolDesc\n        label: \u5173\u8054\u4ee3\u7801\u4ed3\u5de5\u5177\u63cf\u8ff0\n        value: \u81ea\u5b9a\u4e49\u5173\u8054\u4ee3\u7801\u4ed3\u5de5\u5177\n        fieldType: Input\n        show: true\n      - key: repoToolIcon\n        label: \u5173\u8054\u4ee3\u7801\u4ed3\u5de5\u5177\u56fe\u6807\n        value: logo.svg\n        fieldType: Input\n        show: false\nmodules:\n  - id: ones-settings-pipeline-default-repo-link-R5w-\n    title: \u5173\u8054\u4ee3\u7801\u4ed3\u9875\u9762\n    moduleType: ones:settings:pipeline:default:repo:link\n    entry: modules/ones-settings-pipeline-default-repo-link-R5w-/index.html\n")),(0,l.kt)("h4",{id:"\u7b2c\u4e8c\u6b65\u5b9e\u73b0-oauth-\u8ba4\u8bc1"},"\u7b2c\u4e8c\u6b65\uff1a\u5b9e\u73b0 OAuth \u8ba4\u8bc1"),(0,l.kt)("p",null,"Gitlab Oauth \u8ba4\u8bc1\u7684\u4e3b\u8981\u6b65\u9aa4\u5305\u62ec\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u51c6\u5907 Gitlab \u8ba4\u8bc1\u6210\u529f\u7684\u56de\u8c03\u9875\u9762\u5730\u5740 redirect url\uff1b"),(0,l.kt)("li",{parentName:"ul"},"\u5728 Gitlab \u4e2d\u521b\u5efa\u5e94\u7528\uff0c\u4f7f\u7528\u4e0a\u4e00\u6b65\u7684 redirect url\uff0c\u83b7\u53d6\u5230 app ID\u3001secret\uff1b"),(0,l.kt)("li",{parentName:"ul"},"\u4f7f\u7528 app ID \u548c redirect url \u62fc\u63a5 Gitlab \u8ba4\u8bc1\u9875\u9762\u5730\u5740\uff0c\u7528\u6237\u8ba4\u8bc1\u9875\u9762\u6388\u6743\u6210\u529f\u81ea\u52a8\u8df3\u8f6c\u5230 redirect url\uff0c\u6388\u6743\u7801 code \u62fc\u5728 redirect url \u53c2\u6570\u4e2d\uff1b"),(0,l.kt)("li",{parentName:"ul"},"\u4f7f\u7528 app ID\u3001secret\u3001redirect url \u548c\u4e0a\u4e00\u6b65\u83b7\u53d6\u7684 code\uff0c\u8c03\u7528 Gitlab api \u83b7\u53d6\u5230 access_token\uff0c\u6b64\u540e\u53ef\u4ee5\u4f7f\u7528\u8be5 access_token \u8bbf\u95ee Gitlab \u7684\u8d44\u6e90\u3002")),(0,l.kt)("p",null,"Gitlab OAuth \u53ef\u53c2\u8003\u5b98\u65b9\u6587\u6863 ",(0,l.kt)("a",{parentName:"p",href:"https://docs.gitlab.com/ee/api/oauth2.html"},"Gitlab OAuth")," \u3002"),(0,l.kt)("admonition",{title:"\u6ce8\u610f",type:"caution"},(0,l.kt)("p",{parentName:"admonition"},"Gitlab 15.4 \u53ca\u4e4b\u540e\u7684\u7248\u672c\uff0caccess_token \u4e0d\u662f\u6c38\u4e45\u6709\u6548\u7684\uff0c\u6709\u6548\u65f6\u95f4\u4e00\u822c\u4e3a 2 \u4e2a\u5c0f\u65f6\u3002\u6b64\u65f6\u9700\u8981\u4f7f\u7528\u8fd4\u56de\u7684 refresh_token\uff0c\u8c03\u7528 Gitlab api \u83b7\u53d6\u65b0\u7684 access_token\u3002")),(0,l.kt)("p",null,"\u8fd9\u91cc\u4e3a\u5b9e\u73b0 Gitlab \u7684 OAuth \u8ba4\u8bc1\uff0c\u9700\u8981\u914d\u7f6e\u5982\u4e0b\u53c2\u6570\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"app ID"),(0,l.kt)("li",{parentName:"ul"},"secret"),(0,l.kt)("li",{parentName:"ul"},"gitlab url"),(0,l.kt)("li",{parentName:"ul"},"redirect url")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"1. \u51c6\u5907 redirect url")),(0,l.kt)("p",null,"\u5bf9\u4e8e Gitlab \u6388\u6743\u6210\u529f\u56de\u8c03\u9875\u9762 redirect url\uff0c\u53ef\u4ee5\u901a\u8fc7\u5728\u63d2\u4ef6\u4e2d\u65b0\u589e ",(0,l.kt)("inlineCode",{parentName:"p"},"about-blank")," \u7c7b\u578b\u63d2\u69fd\u6765\u5b9e\u73b0\u3002"),(0,l.kt)("p",null,"\u5047\u8bbe ",(0,l.kt)("inlineCode",{parentName:"p"},"about-blank")," \u63d2\u69fd\u914d\u7f6e\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"modules:\n  - id: about-blank-BE8t\n    title: gitlab\n    moduleType: about:blank\n    entry: modules/about-blank-BE8t/index.html\n")),(0,l.kt)("p",null,"\u90a3\u4e48\u6b64\u65f6 ",(0,l.kt)("inlineCode",{parentName:"p"},"aboud-blank")," \u63d2\u69fd\u9875\u9762\u7684\u8bbf\u95ee\u89c4\u5219\u4e3a\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u56e2\u961f\u7ea7\u522b\u63d2\u4ef6\uff1a",(0,l.kt)("inlineCode",{parentName:"li"},"{{host}}/plugin/{{org_UUID}}/{{team_UUID}}/{{app_ID}}/1.0.0/modules/about-blank-BE8t/index.html")),(0,l.kt)("li",{parentName:"ul"},"\u7ec4\u7ec7\u7ea7\u522b\u63d2\u4ef6: ",(0,l.kt)("inlineCode",{parentName:"li"},"{{host}}/plugin/{{org_UUID}}/{{app_ID}}/1.0.0/modules/about-blank-BE8t/index.html"))),(0,l.kt)("p",null,"\u7136\u540e\u5728 ",(0,l.kt)("a",{parentName:"p",href:"/zh-CN/docs/next/abilities/slot/module/configuration/code-integration/default/code-repository/#onessettingspipelinedefaultrepolink"},"ones:settings:pipeline:default:repo:link")," \u63d2\u69fd\u9875\u9762\uff0c\u6309\u4e0a\u9762\u89c4\u5219\u62fc\u63a5\u597d redirect url\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"2. Gitlab \u521b\u5efa\u5e94\u7528")),(0,l.kt)("p",null,"\u7528\u6237\u5728 Gitlab \u4e2d\u4f7f\u7528 redirect url \u521b\u5efa\u5e94\u7528\uff0c\u521b\u5efa\u6210\u529f\u540e\u53ef\u4ee5\u83b7\u53d6\u5230 app ID\u3001secret\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"3. \u5b9e\u73b0 Gitlab \u8ba4\u8bc1")),(0,l.kt)("p",null,"Gitlab \u8ba4\u8bc1\u6d41\u7a0b\u56fe\u5982\u4e0b\uff1a"),(0,l.kt)("mermaid",{value:"sequenceDiagram\n    participant plugin-oauth-page as \u63d2\u4ef6\u8ba4\u8bc1\u9875\u9762\n    participant plugin-redirect-page as \u63d2\u4ef6\u91cd\u5b9a\u5411\u9875\u9762\n    participant plugin-backend as \u63d2\u4ef6\u540e\u7aef\n    participant gitlab as \u79c1\u6709Gitlab\n    plugin-oauth-page->>plugin-oauth-page: \u4f7f\u7528 app ID\u3001gitlab url \u548c redirect url \u62fc\u63a5 Gitlab \u6388\u6743\u9875\u9762\u5730\u5740\n    plugin-oauth-page->>gitlab: \u8df3\u8f6c Gitlab \u6388\u6743\u9875\u9762\n    gitlab->>plugin-redirect-page: \u7528\u6237\u6388\u6743\u6210\u529f\uff0c\u6dfb\u52a0\u6388\u6743\u7801 code \u53c2\u6570\u5e76\u91cd\u5b9a\u5411\u81f3 redirect url\n    plugin-redirect-page->>plugin-oauth-page: \u6388\u6743\u6210\u529f\uff0c\u540c\u6b65 code\n    plugin-oauth-page->>plugin-backend: \u8bf7\u6c42\u8ba4\u8bc1\uff0c\u4f20\u53c2 code\u3001app ID\u3001secret\u3001redirect url\n    plugin-backend->>gitlab: \u5411 Gitlab \u7533\u8bf7\u83b7\u53d6 access_token\n    gitlab->>plugin-backend: \u83b7\u53d6\u6210\u529f\uff0c\u8fd4\u56de access_token\n    plugin-backend->>plugin-backend: \u8ba4\u8bc1\u6210\u529f\uff0c\u8bb0\u5f55 app ID\u3001secret\u3001access_token \u7b49\u8ba4\u8bc1\u4fe1\u606f\n    plugin-backend->>plugin-oauth-page: \u8fd4\u56de\u8ba4\u8bc1\u6210\u529f"}),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u63d2\u4ef6\u8ba4\u8bc1\u9875\u9762\uff1a\u5bf9\u5e94 ",(0,l.kt)("inlineCode",{parentName:"li"},"ones:settings:pipeline:default:repo:link")," \u63d2\u69fd\uff1b"),(0,l.kt)("li",{parentName:"ul"},"\u63d2\u4ef6\u91cd\u5b9a\u5411\u9875\u9762\uff1a\u5bf9\u5e94 ",(0,l.kt)("inlineCode",{parentName:"li"},"about-blank")," \u63d2\u69fd\u3002")),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"about-blank")," \u63d2\u69fd\u63a5\u6536\u6388\u6743\u7801 code \u5e76\u540c\u6b65\u5230 ",(0,l.kt)("inlineCode",{parentName:"p"},"ones:settings:pipeline:default:repo:link")," \u63d2\u69fd\u7684\u5b9e\u73b0\uff0c\u53ef\u4ee5\u53c2\u8003 ",(0,l.kt)("a",{parentName:"p",href:"/zh-CN/docs/next/abilities/slot/module/configuration/code-integration/default/code-repository/#%E7%AC%AC%E4%B8%89%E6%96%B9%E8%AE%A4%E8%AF%81"},"\u4ee3\u7801\u4ed3\u7ba1\u7406-\u7b2c\u4e09\u65b9\u8ba4\u8bc1"),"\u3002"),(0,l.kt)("h4",{id:"\u7b2c\u4e09\u6b65\u65b0\u589e\u5173\u8054\u4ee3\u7801\u4ed3"},"\u7b2c\u4e09\u6b65\uff1a\u65b0\u589e\u5173\u8054\u4ee3\u7801\u4ed3"),(0,l.kt)("p",null,"\u65b0\u589e\u5173\u8054\u4ee3\u7801\u4ed3\u4e3b\u8981\u5305\u62ec\u4e24\u90e8\u5206\u5de5\u4f5c\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u4ece Gitlab \u67e5\u8be2\u4ee3\u7801\u4ed3\uff1b"),(0,l.kt)("li",{parentName:"ul"},"\u65b0\u589e\u4ee3\u7801\u4ed3\u5230 ONES \u7cfb\u7edf\u3002")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"1. \u4ece Gitlab \u67e5\u8be2\u4ee3\u7801\u4ed3")),(0,l.kt)("p",null,"\u6309\u5982\u4e0b\u903b\u8f91\u53ef\u4ee5\u4ece Gitlab \u67e5\u8be2\u6240\u6709\u4ee3\u7801\u4ed3\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"import { fetchHttp } from '@ones-op/node-fetch'\n\nexport interface GitlabRepo {\n  id: number\n  uri: string\n  namespace: string\n  name: string\n}\n\nexport async function listGitlabRepo(): Promise<GitlabRepo[]> {\n  const result: GitlabRepo[] = []\n\n  const gitlabUrl = 'xxx'\n  const accessToken = 'xxx'\n  const url = `${gitlabUrl}/api/v4/projects`\n  const response = await fetchHttp({\n    method: 'get',\n    url: url,\n    headers: {\n      accept: 'application/json',\n      Authorization: `Bearer ${accessToken}`,\n    },\n  })\n  const body = response?.body as any\n  if (response?.statusCode !== 200) {\n    throw new Error('gitlab request failed')\n  }\n\n  for (let i = 0; i < body.length; i++) {\n    const repo: GitlabRepo = {\n      id: body[i].id,\n      uri: gitlabUrl,\n      namespace: body[i].namespace.full_path,\n      name: body[i].path,\n    }\n    result.push(repo)\n  }\n  return result\n}\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"2. \u65b0\u589e\u4ee3\u7801\u4ed3\u5230 ONES \u7cfb\u7edf")),(0,l.kt)("p",null,"\u5f53\u83b7\u53d6\u5230\u53ef\u6dfb\u52a0\u7684\u4ee3\u7801\u4ed3\u5217\u8868\u540e\uff0c\u53ef\u4ee5\u8c03\u7528 ",(0,l.kt)("a",{parentName:"p",href:"/zh-CN/docs/next/reference/packages/node-ability/#addrepos"},"\u6dfb\u52a0\u4ee3\u7801\u4ed3")," \u65b9\u6cd5\u8fdb\u884c\u6dfb\u52a0\uff0c\u9700\u8981\u6ce8\u610f\u4ee3\u7801\u4ed3\u6dfb\u52a0\u6210\u529f\u4e0e\u5426\u7684\u7ed3\u679c\u505a\u6587\u6848\u63d0\u793a\u3002\u540c\u65f6\u4e3a\u4e86\u907f\u514d\u91cd\u590d\u5173\u8054\u4ee3\u7801\u4ed3\uff0c\u5f00\u53d1\u8005\u53ef\u4ee5\u8c03\u7528 ",(0,l.kt)("a",{parentName:"p",href:"/zh-CN/docs/next/reference/packages/node-ability/#queryrepos"},"\u67e5\u8be2\u5df2\u5173\u8054\u6240\u6709\u4ee3\u7801\u4ed3")," \u65b9\u6cd5\u6765\u67e5\u8be2\u5e76\u8fc7\u6ee4\u3002"),(0,l.kt)("h4",{id:"\u7b2c\u56db\u6b65\u65b0\u589e\u4ee3\u7801\u4ed3\u63d0\u4ea4commit\u548c\u5408\u5e76\u8bf7\u6c42pull-request"},"\u7b2c\u56db\u6b65\uff1a\u65b0\u589e\u4ee3\u7801\u4ed3\u63d0\u4ea4\uff08Commit\uff09\u548c\u5408\u5e76\u8bf7\u6c42\uff08Pull Request\uff09"),(0,l.kt)("p",null,"\u5bf9\u4e8e Gitlab \u8981\u60f3\u83b7\u53d6\u4ee3\u7801\u4ed3\u63d0\u4ea4\uff08Commit\uff09\u548c\u5408\u5e76\u8bf7\u6c42\uff08Pull Request\uff09\u6570\u636e\uff0c\u53ef\u4ee5\u5728\u901a\u8fc7\u521b\u5efa webhook \u8ba2\u9605\u6765\u83b7\u53d6\uff0c\u6b64\u65f6\u63d2\u4ef6\u9700\u8981\u65b0\u589e\u5bf9\u5e94\u7684 webhook \u63a5\u53e3\u3002\u5982\u4f55\u5728 Gitlab \u521b\u5efa webhook \u53ef\u4ee5\u53c2\u8003 ",(0,l.kt)("a",{parentName:"p",href:"https://docs.gitlab.com/ee/api/projects.html#add-project-hook"},"Gitlab add hook")," \u6587\u6863\u3002"),(0,l.kt)("p",null,"\u5982\u679c\u63d2\u4ef6\u65b0\u589e webhook \u63a5\u53e3\u6309\u5982\u4e0b\u914d\u7f6e\uff0c\u5219\u63d0\u4f9b\u7ed9 Gitlab \u7684 webhook url \u4e3a ",(0,l.kt)("inlineCode",{parentName:"p"},"{{host}}/project/api/project/team/{{team_UUID}}/gitlabWebhook"),"\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"apis:\n  - type: external\n    methods:\n      - POST\n    url: /team/:teamUUID/gitlab/webhook\n    function: gitlabWebhook\n")),(0,l.kt)("p",null,"Gitlab \u7684\u4ee3\u7801\u4ed3\u63d0\u4ea4\uff08Commit\uff09\u5bf9\u5e94 webhook \u7684 ",(0,l.kt)("a",{parentName:"p",href:"https://docs.gitlab.com/ee/user/project/integrations/webhook_events.html#push-events"},"push_events")," \u4e8b\u4ef6\uff0c\u5408\u5e76\u8bf7\u6c42\uff08Pull Request\uff09\u5bf9\u5e94\u4e8e ",(0,l.kt)("a",{parentName:"p",href:"https://docs.gitlab.com/ee/user/project/integrations/webhook_events.html#merge-request-events"},"merge_requests_events")," \u4e8b\u4ef6\uff0c\u4e24\u8005\u53ef\u4ee5\u901a\u8fc7\u8bf7\u6c42\u5934 ",(0,l.kt)("inlineCode",{parentName:"p"},"X-Gitlab-Event")," \u533a\u5206\u3002Gitlab webhook \u4e8b\u4ef6\u7684\u6570\u636e\u683c\u5f0f\u53ef\u4ee5\u53c2\u8003 ",(0,l.kt)("a",{parentName:"p",href:"https://docs.gitlab.com/ee/user/project/integrations/webhook_events.html#webhook-events"},"Gitlab webhook events")," \u6587\u6863\u3002"),(0,l.kt)("admonition",{title:"\u6ce8\u610f",type:"caution"},(0,l.kt)("p",{parentName:"admonition"},"\u5bf9\u4e8e\u4f7f\u7528 webhook \u83b7\u53d6\u4ee3\u7801\u4ed3\u63d0\u4ea4\uff08Commit\uff09\u548c\u5408\u5e76\u8bf7\u6c42\uff08Pull Request\uff09\u6570\u636e\u65b9\u5f0f\uff0c\u9700\u8981\u6ce8\u610f\u4ee3\u7801\u4ed3\u5728 ONES \u7cfb\u7edf\u88ab\u79fb\u9664\u548c\u63d2\u4ef6\u542f\u7528\u3001\u505c\u7528\u4e24\u79cd\u573a\u666f\uff1a"),(0,l.kt)("ul",{parentName:"admonition"},(0,l.kt)("li",{parentName:"ul"},"\u5bf9\u4e8e\u4ee3\u7801\u4ed3\u5728 ONES \u7cfb\u7edf\u88ab\u79fb\u9664\u573a\u666f\uff0c\u5f00\u53d1\u8005\u53ef\u4ee5\u5728\u80fd\u529b\u6dfb\u52a0\u7684 ",(0,l.kt)("inlineCode",{parentName:"li"},"removeRepo")," \u65b9\u6cd5\u65b0\u589e\u5220\u9664 webhook \u903b\u8f91\uff1b"),(0,l.kt)("li",{parentName:"ul"},"\u5bf9\u4e8e\u63d2\u4ef6\u542f\u7528\u3001\u505c\u7528\u573a\u666f\uff0c\u7531\u4e8e\u6b64\u65f6\u63d2\u4ef6\u5b9a\u4e49\u7684\u63a5\u53e3\u5c06\u65e0\u6cd5\u8bbf\u95ee\uff0c\u5e76\u4e14\u65b0\u589e\u4ee3\u7801\u4ed3\u63d0\u4ea4\uff08Commit\uff09\u548c\u5408\u5e76\u8bf7\u6c42\uff08Pull Request\uff09\u7684 SDK \u65b9\u6cd5\u5c06\u65e0\u6cd5\u8c03\u7528\uff0c\u5f00\u53d1\u8005\u53ef\u4ee5\u5728\u63d2\u4ef6\u542f\u7528\u65f6\u6062\u590d\u4ee3\u7801\u4ed3\u7684 webhook\uff0c\u5728\u63d2\u4ef6\u505c\u7528\u65f6\u5220\u9664\u4ee3\u7801\u4ed3\u7684 webhook\u3002"))))}c.isMDXComponent=!0}}]);