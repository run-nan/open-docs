---
sidebar_position: 10
---

import Image from '@theme/IdealImage'
import actionAdd from './plugin-quick-action-add-en.jpg'
import actionModify from './plugin-quick-action-modify-en.jpg'
import actionShow from './plugin-quick-action-show-en.jpg'

# Custom Layout Shortcut

## Requirements

|   ONES    |
| :-------: |
| v3.11.40+ |

## Overview

### Description of ability

The open platform provides the ability to customize shortcut buttons for task items. After use, you can add custom shortcut buttons in the global view configuration, which supports custom button functions and sequence adjustments. After applying to any type of task item, you can Use custom shortcuts in the corresponding task items. By using this capability, you can achieve more personalized functions, such as the following scenes:

1. When you want to customize a shortcut operation of a task item, such as exporting comments, associating with related code repos, pushing official accounts and other non-preset shortcut operations.

### Performance of ability

#### Add plugin shortcut

After enabled the plugin which using this capability, you can add a custom "plugin shortcut" on the layout configuration page of the issue type.

<Image img={actionAdd} />

#### Adjust the plugin shortcut position

After added you can check the "plugin shortcut" in the "Overview widget configuration", which can adjust the position and whether it is displayed on the outside like other shortcuts.

<Image img={actionModify} />

#### Release global layout

After released the global layout, you can check the added "plugin shortcut" in the upper right corner of the task item details form, and the corresponding function is defined by the plugin.

<Image img={actionShow} />

## Ability Use

### Dependence requirements

Locate `/web` directory, use the following cmd to install @ones-op/store.

```
  npm install @ones-op/store
```

### Steps for usage

#### Add module

Execute the following command, select the `ones:global:modal`.

```
  npx op add module
```

#### Add ability

Execute the following command, select the `layout-custom-quick-action@1.0.0`.

```
  npx op add ability
```

#### Ability declare

Declare use ability in `plugin.yaml`:

```yaml
service:
  app_id: MS6wAcF0
  ...
modules:
  - id: ones-global-modal-F3qL
    entry: modules/ones-global-modal-F3qL/index.html
    moduleType: ones:global:modal
    title: 'Plugin shortcut' # plugin's title as well as button's title
    icon: logo.svg # plugin's icon as well as button's icon, getting from project directory web/public/logo.svg, default is plugin of @ones-design/icon, you'd better use pure color svg to correspond with the origin quickActions's button
    preload: true # require
    manual: true # require
abilities:
  - id: QayeaBmz
    name: 'custom layout shortcut'
    version: 1.0.0
    abilityType: LayoutCustomQuickAction
    relateModule:
      quickActionMenu: ones-project-settings-issueType-F3HS # the initial value is empty, here you need to manually fill in the corresponding slot moduleID.
```

:::caution Attention

1. The value of the ability parameter `quickActionMenu` is the corresponding custom module `id`;
2. The module must be [ones:global:modal](../../api/slot/global.md#onesglobalmodal) type, and the name of the custom shortcut is the parameter value of the associated module `title`;
3. One ability can only be associated with one module, and no multiple capabilities are allowed to associate the same module.
4. `preload` and `manual` in `modules` is required to set to `true` manually! Otherwise, button will be activated automatically, causing unexpected problems.

:::

#### Custom the button's behavior

Front-end plugin's demo

##### Popover type

```tsx
import React, { useEffect } from 'react'
import ReactDOM from 'react-dom'
import { ConfigProvider } from '@ones-design/core'
import { useTaskInfo, destroyCurrentModule } from '@ones-op/store'
import './index.css'

function App() {
  // current task's uuid
  const { uuid } = useTaskInfo()

  return (
    <>
      <Modal
        onCancel={function noRefCheck() {
          // click cancel, betterr to destroy the modal
          destroyCurrentModule()
        }}
        onOk={function noRefCheck() {
          // click ok, betterr to destroy the modal
          destroyCurrentModule()
        }}
        title="custom quick action"
        closable
        visible
        width={520}
      >
        custom quick action
      </Modal>
    </>
  )
}

ReactDOM.render(
  <ConfigProvider>
    <App />
  </ConfigProvider>,
  document.getElementById('ones-mf-root')
)
```

##### Pure logic without render

```tsx
  import React, { useEffect } from 'react'
  import ReactDOM from 'react-dom'
  import { ConfigProvider } from '@ones-design/core'
  import { useTaskInfo, destroyCurrentModule } from '@ones-op/store'
  import './index.css'

  function App() {
    // current task's uuid
    const { uuid } = useTaskInfo()

    useEffect(() => {
      // dosomething
      ...
      // you have to call the function to destory current module, otherwise, the button won't work out anymore!
      destroyCurrentModule()
    })

    // no render
    return <></>
  }

  ReactDOM.render(<ConfigProvider><App/></ConfigProvider>, document.getElementById('ones-mf-root'))
```

## Example

### Scene: custom shortcut button 'Push Official Account' to push key information to WeChat official account

#### Scene Description

The user wants to add a custom shortcut operation push official account to the task item, so as to realize the requirement of synchronously pushing the status of a certain task item to the WeChat official account.

#### Implementation Ideas

Use the quick operation ability of custom task items, use `useTaskInfo` in the front-end plug-in to obtain the `uuid` of the current operation task item, use the ONES interface to obtain the detailed information of the current task item, and call the WeChat official account push interface after getting the information, In order to realize the function of pushing the official account.

#### Plug-in development

Front-end plugin's demo

```tsx
import React, { useEffect } from 'react'
import ReactDOM from 'react-dom'
import { ConfigProvider, toast } from '@ones-design/core';
import { useTaskInfo, destroyCurrentModule } from '@ones-op/store'
import { OPFetch } from '@ones-op/fetch';
import './index.css'
function App() {
  const { uuid } = useTaskInfo()
  const teamUUID = localStorage.getItem('teamUUID')
  // get taskInfo's detail
  const getTaskInfo = () => {
    return OPFetch(`/project/P8091/api/project/team/${teamUUID}/task/${uuid}/info`)
  }
  // push to WeChat official account
  const wxPublicAccountPush = (taskInfo) => {
    try {
      // call wechat push interface
      ...
      toast.success('Push Success')
    } catch (e) {
      toast.error('Push Failed')
    }
  }
  const initialDeal = async () => {
    try {
      const { data } = await getTaskInfo()
      wxPublicAccountPush(data)
    } catch (e) {
      toast.error(e)
    }
  }
  useEffect(() => {
    initialDeal()
    // destroy current module
    setTimeout(() => {
      destroyCurrentModule()
    }, 0);
  }, [])
  return <></>
}
ReactDOM.render(<ConfigProvider><App/></ConfigProvider>, document.getElementById('ones-mf-root'))
```

## FAQ

### How to bind the custom layout shortcut ability and module?

The configuration parameters `quickActionMenu` of the file `plugin.yaml`, used to bind the relationship with the correlation between the custom layout shortcut ability and the frontend module.

### What should I do if I need to add multiple plugin shortcut?

Custom layout shortcut ability and module are one-to-one relationship. At the same time, based on the principle of functional independence, it is recommended that developers a plugin only define one custom plugin shortcut ability.

### The impact of the plugin enable, stop, and uninstall on the overall layout of the issue type?

1. Plugin enable:

   - You can add "plugin shortcut" to all issue type global layout;
   - If the "plugin shortcut" has been configured to the global layout, and will be displayed again after it is enabled again.

2. Plugin disable:

   - You can not add "plugin shortcut" to all issue type global layout;
   - The "plugin shortcut" that has been configured to the global layout, will not be displayed;
   - The draft of the global layout of the configured "plugin shortcut". At this time, the data is illegal and cannot be edited. You can cancel the release and exit and reenter.

3. Plugin uninstall:
   - You can not add "plugin shortcut" to all issue type global layout;
   - The previously configured "plugin quick action" will be deleted, and if you want restore previously configured records, you need to be reconfigure;
   - The draft of the global layout of the configured "plugin shortcut". At this time, the data is illegal and cannot be edited. You can cancel the release and exit and reenter.
