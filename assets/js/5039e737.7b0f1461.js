(self.webpackChunkopen_docs=self.webpackChunkopen_docs||[]).push([[77235],{5404:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/editor.4c87a22.1024.png 1024w,"+n.p+"assets/ideal-img/editor.d7d0ffd.2560.png 2560w",images:[{path:n.p+"assets/ideal-img/editor.4c87a22.1024.png",width:1024,height:584},{path:n.p+"assets/ideal-img/editor.d7d0ffd.2560.png",width:2560,height:1459}],src:n.p+"assets/ideal-img/editor.4c87a22.1024.png",toString:function(){return n.p+"assets/ideal-img/editor.4c87a22.1024.png"},placeholder:void 0,width:1024,height:584},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAbklEQVQImWWN2QrCQBAE9/+/05gnE49kkzlLZn1RHCi6GwqmPZ4b+2n0LvR+4JGYB2o+cnQ12tYFC1BL5jW5rsm0BJebM99hWuB1JK3sushkOwvYC2HskkppqvoRIxB1MhzIP5qJDDEzf6gP3/sNU5DEcJu7skMAAAAASUVORK5CYII="}},18679:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var a=n(67294),i=n(34334);const o="tabItem_Ymn6";function l(e){let{children:t,hidden:n,className:l}=e;return a.createElement("div",{role:"tabpanel",className:(0,i.Z)(o,l),hidden:n},t)}},34259:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var a=n(87462),i=n(67294),o=n(34334),l=n(51048),r=n(33609),s=n(1943),u=n(72957);const d="tabList__CuJ",p="tabItem_LNqP";function m(e){var t,n;const{lazy:l,block:m,defaultValue:c,values:h,groupId:k,className:b}=e,f=i.Children.map(e.children,(e=>{if((0,i.isValidElement)(e)&&"value"in e.props)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),g=null!=h?h:f.map((e=>{let{props:{value:t,label:n,attributes:a}}=e;return{value:t,label:n,attributes:a}})),N=(0,r.l)(g,((e,t)=>e.value===t.value));if(N.length>0)throw new Error('Docusaurus error: Duplicate values "'+N.map((e=>e.value)).join(", ")+'" found in <Tabs>. Every value needs to be unique.');const v=null===c?c:null!=(t=null!=c?c:null==(n=f.find((e=>e.props.default)))?void 0:n.props.value)?t:f[0].props.value;if(null!==v&&!g.some((e=>e.value===v)))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+v+'" but none of its children has the corresponding value. Available values are: '+g.map((e=>e.value)).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");const{tabGroupChoices:w,setTabGroupChoices:y}=(0,s.U)(),[A,I]=(0,i.useState)(v),C=[],{blockElementScrollPositionUntilNextRender:T}=(0,u.o5)();if(null!=k){const e=w[k];null!=e&&e!==A&&g.some((t=>t.value===e))&&I(e)}const x=e=>{const t=e.currentTarget,n=C.indexOf(t),a=g[n].value;a!==A&&(T(t),I(a),null!=k&&y(k,String(a)))},D=e=>{var t;let n=null;switch(e.key){case"Enter":x(e);break;case"ArrowRight":{var a;const t=C.indexOf(e.currentTarget)+1;n=null!=(a=C[t])?a:C[0];break}case"ArrowLeft":{var i;const t=C.indexOf(e.currentTarget)-1;n=null!=(i=C[t])?i:C[C.length-1];break}}null==(t=n)||t.focus()};return i.createElement("div",{className:(0,o.Z)("tabs-container",d)},i.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":m},b)},g.map((e=>{let{value:t,label:n,attributes:l}=e;return i.createElement("li",(0,a.Z)({role:"tab",tabIndex:A===t?0:-1,"aria-selected":A===t,key:t,ref:e=>C.push(e),onKeyDown:D,onClick:x},l,{className:(0,o.Z)("tabs__item",p,null==l?void 0:l.className,{"tabs__item--active":A===t})}),null!=n?n:t)}))),l?(0,i.cloneElement)(f.filter((e=>e.props.value===A))[0],{className:"margin-top--md"}):i.createElement("div",{className:"margin-top--md"},f.map(((e,t)=>(0,i.cloneElement)(e,{key:t,hidden:e.props.value!==A})))))}function c(e){const t=(0,l.Z)();return i.createElement(m,(0,a.Z)({key:String(t)},e))}},46931:(e,t,n)=>{"use strict";n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>u,default:()=>h,frontMatter:()=>s,metadata:()=>d,toc:()=>m});var a=n(87462),i=(n(67294),n(3905)),o=n(15944),l=n(34259),r=n(18679);const s={},u="Wiki collaborative page",d={unversionedId:"abilities/slot/module/wiki/editor/index",id:"abilities/slot/module/wiki/editor/index",title:"Wiki collaborative page",description:"Requirements",source:"@site/docs/abilities/slot/module/wiki/editor/index.mdx",sourceDirName:"abilities/slot/module/wiki/editor",slug:"/abilities/slot/module/wiki/editor/",permalink:"/docs/next/abilities/slot/module/wiki/editor/",draft:!1,tags:[],version:"current",lastUpdatedBy:"liupengfei",lastUpdatedAt:1690791943,formattedLastUpdatedAt:"Jul 31, 2023",frontMatter:{},sidebar:"abilities",previous:{title:"ONES Wiki",permalink:"/docs/next/abilities/slot/module/wiki/"},next:{title:"Wiki page",permalink:"/docs/next/abilities/slot/module/wiki/page/"}},p={},m=[{value:"Requirements",id:"requirements",level:2},{value:"Overview",id:"overview",level:2},{value:"Slots",id:"slots",level:2},{value:"ones:wiki:editor:embed",id:"oneswikieditorembed",level:4},{value:"Usage",id:"usage",level:2},{value:"Available Hook API",id:"available-hook-api",level:3},{value:"Open The editable interface Actively",id:"open-the-editable-interface-actively",level:3},{value:"Save The Data",id:"save-the-data",level:3},{value:"Plugin Runtime Status",id:"plugin-runtime-status",level:3}],c={toc:m};function h(e){let{components:t,...s}=e;return(0,i.kt)("wrapper",(0,a.Z)({},c,s,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"wiki-collaborative-page"},"Wiki collaborative page"),(0,i.kt)("h2",{id:"requirements"},"Requirements"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"center"},"ONES"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},"v3.11.30+")))),(0,i.kt)("h2",{id:"overview"},"Overview"),(0,i.kt)(o.Z,{img:n(5404),mdxType:"Image"}),(0,i.kt)("p",null,'We have provided slots for "ONES Wiki" - "Spaces" - "select a space" - "Wiki collaborative page" to customize the page module for the application.'),(0,i.kt)("p",null,"There are two ways to insert the plugin into document: In the editable page, click the menu on the left or type the shortcut. You can config it in the ",(0,i.kt)("inlineCode",{parentName:"p"},"plugin.yaml"),"."),(0,i.kt)("p",null,"The slots currently supported are as follows:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#oneswikieditorembed"},"ones:wiki:editor:embed"))),(0,i.kt)("h2",{id:"slots"},"Slots"),(0,i.kt)("h4",{id:"oneswikieditorembed"},"ones:wiki:editor:embed"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Module path\uff1a")," ONES Wiki / Spaces / select a space / Wiki collaborative page / block element"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Number limit\uff1a")," Declare a maximum of ",(0,i.kt)("strong",{parentName:"p"},"10")," slots in each plugin, and up to ",(0,i.kt)("strong",{parentName:"p"},"100")," slots in the system."),(0,i.kt)("h2",{id:"usage"},"Usage"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"modules:\n  - id: ones-wiki-editor-embed-Pl6y\n    title: issue\n    moduleType: ones:wiki:editor:embed\n    macroShortcut: issue\n    description: Insert the issue\n    # Icon of macro\n    icon: macro-icon.svg\n    modules:\n      - id: ones-wiki-editor-embed-syM2\n        title: show\n        # Scene of slot,\n        # `render` used to render the display interface\n        # `toolbar` used to render the editable interface\n        scene: render\n        entry: modules/ones-wiki-editor-embed-Pl6y/ones-wiki-editor-embed-syM2/index.html\n      - id: ones-wiki-editor-embed-BUmK\n        # The title and icon will render when the user hovers over the block element of macro\n        title: edit\n        icon: edit.svg # Required\n        scene: toolbar\n        preload: true # Required\n        manual: true # Required\n        entry: modules/ones-wiki-editor-embed-Pl6y/ones-wiki-editor-embed-BUmK/index.html\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Supported config options\uff1a")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"../../../../../reference/config/plugin.yaml#icon"},"icon"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"macroShortcut"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"type: ",(0,i.kt)("inlineCode",{parentName:"p"},"string")),(0,i.kt)("p",{parentName:"li"},"Shortcut for the plugin"),(0,i.kt)("p",{parentName:"li"},"For example: ",(0,i.kt)("inlineCode",{parentName:"p"},"macroShortcut: issue"),", when the user is editing the document, the user can insert the plugin into the current document by just typing ",(0,i.kt)("inlineCode",{parentName:"p"},"/issue"),".")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"../../../../../reference/config/plugin.yaml#moduleDescription"},"description"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"enableCollaborative"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"ONES Requirement: ",(0,i.kt)("inlineCode",{parentName:"p"},"v3.13.36+"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"type: ",(0,i.kt)("inlineCode",{parentName:"p"},"boolean")),(0,i.kt)("p",{parentName:"li"},"Enable multiple users to edit the same document data at the same time. By default, the other users can't edit the block when one user clicks the toolbar.")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"../../../../../reference/config/plugin.yaml#subModule"},"modules(required)"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"modules","[*]",".scene(required)"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"type: ",(0,i.kt)("inlineCode",{parentName:"p"},'"toolbar"|"render"')),(0,i.kt)("p",{parentName:"li"},"Scene of the plugin,"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"render")," used to render the display interface"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"toolbar")," used to render the editable interface"),(0,i.kt)("p",{parentName:"li"},"A macro plugin consists of two parts:"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Display Interface(",(0,i.kt)("inlineCode",{parentName:"li"},"scene: render"),"), Required, used to render the data in the wiki. When one user is editing the element, this element for another user will be disabled.")),(0,i.kt)("admonition",{parentName:"li",title:"caution",type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"The element used to accept data from the user(e.g. ",(0,i.kt)("inlineCode",{parentName:"p"},"<input>"),") cannot be used in the block element(which intercept lots of DOM event, so the edit element cannot respond to\nthe input from the user). These editing operations must be placed in the editable interface which triggers by the ",(0,i.kt)("inlineCode",{parentName:"p"},"toolbar"),".")),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Editable interface(",(0,i.kt)("inlineCode",{parentName:"li"},"scene: toolbar"),"), Required, Triggered by the toolbar. Each time it is opened, the editable interface will be reinitialized,\nand when it is closed, the instance of the editable interface will be destroyed."))))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"../../../../../reference/config/plugin.yaml#icon"},"modules[","*","].icon")),(0,i.kt)("p",{parentName:"li"},"If ",(0,i.kt)("inlineCode",{parentName:"p"},"modules[*].scene === 'toolbar'"),", This is used to render the icon of the ",(0,i.kt)("inlineCode",{parentName:"p"},"toolbar"),".")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"../../../../../reference/config/plugin.yaml#manual"},"modules[","*","].manual")),(0,i.kt)("p",{parentName:"li"},"This option must be set to ",(0,i.kt)("inlineCode",{parentName:"p"},"true")," if ",(0,i.kt)("inlineCode",{parentName:"p"},"modules[*].scene === 'toolbar'"),".")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"../../../../../reference/config/plugin.yaml#manual"},"modules[","*","].preload")),(0,i.kt)("p",{parentName:"li"},"This option is recommended to be set to ",(0,i.kt)("inlineCode",{parentName:"p"},"true")," if ",(0,i.kt)("inlineCode",{parentName:"p"},"modules[*].scene === 'toolbar'"),"."))),(0,i.kt)("h3",{id:"available-hook-api"},"Available Hook API"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/next/reference/packages/store/#useDocumentInfo"},"useDocumentInfo"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"import { useDocumentInfo } from '@ones-op/store'\n\nconst documentInfo = useDocumentInfo()\n")),(0,i.kt)("h3",{id:"open-the-editable-interface-actively"},"Open The editable interface Actively"),(0,i.kt)("p",null,"In most cases, the editable interface is opened when the user clicks the button in the toolbar. If wants to open it automatically when the user inserts the macro into the wiki document\nfor the first time, The parameter ",(0,i.kt)("inlineCode",{parentName:"p"},"isTriggerByUser")," is useful to implement this with the help of a local variable."),(0,i.kt)("p",null,"Display interface"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"let shouldOpenEditPage = true\n\nfunction App() {\n  const document = useDocumentInfo<unknown, boolean>()\n\n  useEffect(() => {\n    if (document.isTriggerByUser && shouldOpenEditPage) {\n      // Go to editable interface\n      document.goToState({\n        builtIn: false,\n        value: {\n          id: 'ones-wiki-editor-embed-BUmK',\n          title: 'edit',\n        },\n        customData: true,\n      })\n      shouldOpenEditPage = false\n    }\n  }, [document])\n\n  return <div />\n}\n")),(0,i.kt)("p",null,"Editable interface"),(0,i.kt)(l.Z,{mdxType:"Tabs"},(0,i.kt)(r.Z,{value:"latest",label:"Latest",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import { lifecycle } from '@ones-op/bridge'\n\nfunction App() {\n  const document = useDocumentInfo<unknown, boolean>()\n\n  const cancel = useCallback(() => {\n    if (document.toolbarState.customData) {\n      document.destroy()\n    } else {\n      // close toolbar\n      lifecycle.destroy()\n    }\n  }, [document])\n\n  return <Modal title=\"Plugin development\" onCancel={cancel} />\n}\n"))),(0,i.kt)(r.Z,{value:"ONES v3.11.40-",label:"ONES v3.11.40-",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"function App() {\n  const document = useDocumentInfo<unknown, boolean>()\n\n  const cancel = useCallback(() => {\n    if (document.toolbarState.customData) {\n      document.destroy()\n    } else {\n      // close toolbar\n      document.goToState({\n        builtIn: true,\n        value: 'init',\n      })\n    }\n  }, [document])\n\n  return <Modal title=\"Plugin development\" onCancel={cancel} />\n}\n")))),(0,i.kt)("h3",{id:"save-the-data"},"Save The Data"),(0,i.kt)("p",null,"When invoking the function ",(0,i.kt)("inlineCode",{parentName:"p"},"saveData"),", the data will be saved to the wiki document. If the data is simple(e.g. URL, text, etc.), it's OK to save it to the document.\nBut if the data is large, recommended saving the data in the backend database by communicating with backend services, and then save the returned ",(0,i.kt)("inlineCode",{parentName:"p"},"ID")," in the document."),(0,i.kt)("admonition",{title:"caution",type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"The data in the document will be used to revoke, version rollback, etc. Every time the user performs those operations, the editor will return the corresponding version\nof the data to the plugin for rendering.")),(0,i.kt)("p",null,"While saving the data, the plugin needs to tell the editor how to export this data when the user export it to word or PDF(for example, the issue plugin will\nsave the ID into the document. When exported to PDF, this data will render as a link). Now only three formats are supported(text, link, image). This has been defined\nin the API section. Among them, the image is special, you need to save the image to the background server of the editor by calling the ",(0,i.kt)("inlineCode",{parentName:"p"},"uploadResource")," method,\nand the server will return the file name of the resource. Finally, use the returned file name to generate an export format, refer to the following example."),(0,i.kt)("admonition",{title:"caution",type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"When uploading the resource to the editor service by using ",(0,i.kt)("inlineCode",{parentName:"p"},"uploadResource"),", the resource is bound to the document. If the user needs to copy the macro to a new document,\nthe resource in the previous document is need to bind to the current document too. So there is a fixed field ",(0,i.kt)("inlineCode",{parentName:"p"},"resources")," in the data, if the ",(0,i.kt)("inlineCode",{parentName:"p"},"resources")," exists,\nthe platform will bind the resources to the new document."),(0,i.kt)("p",{parentName:"admonition"},"The resources in the ",(0,i.kt)("inlineCode",{parentName:"p"},"exportSpec")," do not need to add to the fixed field ",(0,i.kt)("inlineCode",{parentName:"p"},"resources"),", the platform handles it by default."),(0,i.kt)("p",{parentName:"admonition"},"Do not pass a custom value to the field ",(0,i.kt)("inlineCode",{parentName:"p"},"resources"),", otherwise it will be treated as a resource ID."),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"document.saveData(\n  {\n    resources: [resourceId],\n  },\n  {\n    exportSpec: [\n      {\n        type: 'image',\n        data: resourceName,\n      },\n    ],\n  }\n)\n"))),(0,i.kt)(l.Z,{mdxType:"Tabs"},(0,i.kt)(r.Z,{value:"latest",label:"Latest",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"import { lifecycle } from '@ones-op/bridge'\n\nconst document = useDocumentInfo()\n\ndocument\n  .uploadResource(File /** the image file that needs to be exported  */, 'test.svg'), () => {})\n  .then((resourceName) => {\n    document.saveData(\n      // the data that saves to the document\n      {\n        data: value,\n        // Do not pass a custom value to the field `resources`, otherwise it will be treated as a resource ID.\n        resources: [resourceId]\n      },\n      {\n        exportSpec: [\n          {\n            type: 'image',\n            data: resourceName,\n          },\n        ],\n      }\n    )\n    // close toolbar\n    lifecycle.destroy()\n  })\n"))),(0,i.kt)(r.Z,{value:"ONES v3.11.40-",label:"ONES v3.11.40-",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"const document = useDocumentInfo()\n\ndocument\n  .uploadResource(File /** the image file that needs to be exported  */, 'test.svg'), () => {})\n  .then((resourceName) => {\n    document.saveData(\n      // the data that saves to the document\n      {\n        data: value,\n        // Do not pass a custom value to the field `resources`, otherwise it will be treated as a resource ID.\n        resources: [resourceId]\n      },\n      {\n        exportSpec: [\n          {\n            type: 'image',\n            data: resourceName,\n          },\n        ],\n      }\n    )\n    // close toolbar\n    document.goToState({\n      builtIn: true,\n      value: 'init',\n    })\n  })\n")))),(0,i.kt)("h3",{id:"plugin-runtime-status"},"Plugin Runtime Status"),(0,i.kt)("p",null,"The runtime status of the plugin can be get by the param ",(0,i.kt)("inlineCode",{parentName:"p"},"status"),", and the plugin can modify the status by function ",(0,i.kt)("inlineCode",{parentName:"p"},"setStatus"),",\nfor example, when the data in the document is not expected, the plugin needs to tell the user to edit the data by call function ",(0,i.kt)("inlineCode",{parentName:"p"},"setStatus"),".\nFor the definition of specific states, please refer to the ",(0,i.kt)("inlineCode",{parentName:"p"},"API")," type definition."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"const document = useDocumentInfo()\ndocument.setStatus(EmbedPluginRuntimeStatus.DATA_INVALID)\n")))}h.isMDXComponent=!0}}]);