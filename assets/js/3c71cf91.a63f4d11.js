(self.webpackChunkopen_docs=self.webpackChunkopen_docs||[]).push([[48410],{3431:(e,t,i)=>{e.exports={src:{srcSet:i.p+"assets/ideal-img/ci-plugin-en.336d45d.1024.png 1024w,"+i.p+"assets/ideal-img/ci-plugin-en.12b8581.1718.png 1718w",images:[{path:i.p+"assets/ideal-img/ci-plugin-en.336d45d.1024.png",width:1024,height:563},{path:i.p+"assets/ideal-img/ci-plugin-en.12b8581.1718.png",width:1718,height:944}],src:i.p+"assets/ideal-img/ci-plugin-en.336d45d.1024.png",toString:function(){return i.p+"assets/ideal-img/ci-plugin-en.336d45d.1024.png"},placeholder:void 0,width:1024,height:563},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAW0lEQVQImWWMiwqAIBAE/f8P7BMiNSij14nexAWF1MLAsizjUkos28FxCqr6UqsCyrwXun7FxRg5RbC0R8NSqnVwIQRyzr+j2Z6zdTd4jzTGb2y6jX6cEPkbv1yiAMTqwb0PYwAAAABJRU5ErkJggg=="}},80889:(e,t,i)=>{e.exports={src:{srcSet:i.p+"assets/ideal-img/pipeline.30aac20.1024.png 1024w,"+i.p+"assets/ideal-img/pipeline.1842215.1915.png 1915w",images:[{path:i.p+"assets/ideal-img/pipeline.30aac20.1024.png",width:1024,height:483},{path:i.p+"assets/ideal-img/pipeline.1842215.1915.png",width:1915,height:903}],src:i.p+"assets/ideal-img/pipeline.30aac20.1024.png",toString:function(){return i.p+"assets/ideal-img/pipeline.30aac20.1024.png"},placeholder:void 0,width:1024,height:483},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAcElEQVQImYWNUQrDMAxDc/9zZrCPljK2xInl5I16B5hBCEkPXGp94C7MBq01JOFSupnxvDqKRbnBiGDKMe+03hnuKIS7AztVaq0JanZsfrjeL5oZkjPGyG3vTTmO4xdCKJzpM9+utbK/PcHzPHP4d1/2rMOkpR/ZcAAAAABJRU5ErkJggg=="}},70412:(e,t,i)=>{e.exports={src:{srcSet:i.p+"assets/ideal-img/variable.14cc554.1024.png 1024w,"+i.p+"assets/ideal-img/variable.65c4f58.1915.png 1915w",images:[{path:i.p+"assets/ideal-img/variable.14cc554.1024.png",width:1024,height:483},{path:i.p+"assets/ideal-img/variable.65c4f58.1915.png",width:1915,height:903}],src:i.p+"assets/ideal-img/variable.14cc554.1024.png",toString:function(){return i.p+"assets/ideal-img/variable.14cc554.1024.png"},placeholder:void 0,width:1024,height:483},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAeUlEQVQImT2NWQ7DIAwFuf81SbN8NewUMFPhVLVkW5o3ls22vWitIyJ4dxO8J6VE750xhnKRibHWKphAjIGaPbVEag6M/uGpidn3HZHBkMn1Tnr0RDDX0K3ioW9WFLwjl0JvTVs//WxznKeKC9zOkXOm1Eop9c+X+AUAbsM53VnUrwAAAABJRU5ErkJggg=="}},21631:(e,t,i)=>{"use strict";i.r(t),i.d(t,{assets:()=>s,contentTitle:()=>p,default:()=>u,frontMatter:()=>l,metadata:()=>r,toc:()=>d});var n=i(87462),a=(i(67294),i(3905)),o=i(15944);const l={id:"deploy",sidebar_position:11},p="Deploy",r={unversionedId:"guide/deploy",id:"guide/deploy",title:"Deploy",description:"Overview",source:"@site/docs/guide/deploy.mdx",sourceDirName:"guide",slug:"/guide/deploy",permalink:"/open-docs/docs/next/guide/deploy",draft:!1,tags:[],version:"current",lastUpdatedBy:"liupengfei",lastUpdatedAt:1690862808,formattedLastUpdatedAt:"Aug 1, 2023",sidebarPosition:11,frontMatter:{id:"deploy",sidebar_position:11},sidebar:"guide",previous:{title:"Package",permalink:"/open-docs/docs/next/guide/package"},next:{title:"Upgrade",permalink:"/open-docs/docs/next/guide/upgrade"}},s={},d=[{value:"Overview",id:"overview",level:2},{value:"Advantage",id:"advantage",level:3},{value:"Usage",id:"usage",level:2},{value:"Precondition",id:"precondition",level:3},{value:"Initialization",id:"initialization",level:3},{value:".gitlab-ci.yml",id:"gitlab-ciyml",level:4},{value:"ci-deploy.yaml",id:"ci-deployyaml",level:4},{value:"Step 1: Connect ONES",id:"step-1-connect-ones",level:3},{value:"Step 2: Credential information desensitization",id:"step-2-credential-information-desensitization",level:3},{value:"Step 3: Push code, trigger pipeline",id:"step-3-push-code-trigger-pipeline",level:3},{value:"Step 4: Use plugin",id:"step-4-use-plugin",level:4}],c={toc:d};function u(e){let{components:t,...l}=e;return(0,a.kt)("wrapper",(0,n.Z)({},c,l,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"deploy"},"Deploy"),(0,a.kt)("h2",{id:"overview"},"Overview"),(0,a.kt)("p",null,"During the initialization of the plugin project, ONES CLI initializes ",(0,a.kt)("inlineCode",{parentName:"p"},"git")," for you in advance. We recommend that you use GitLab to host your engineering code and use GitLab CI/CD to build a continuous integration solution for your plugin project. So the following documentation tutorials are based on the ",(0,a.kt)("inlineCode",{parentName:"p"},"GitLab plugin continuous integration solution"),"."),(0,a.kt)("p",null,"We prefer to recommend continuous integration to you rather than packaging with the ",(0,a.kt)("inlineCode",{parentName:"p"},"npx op packup")," command."),(0,a.kt)("h3",{id:"advantage"},"Advantage"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"reduced repetitive movements"),(0,a.kt)("br",{parentName:"li"}),"Automated deployment frees repetitive work such as package release and installation, and the efficiency of automatic integration is much higher than that of manual work."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"reduce manual errors"),(0,a.kt)("br",{parentName:"li"}),"One of the biggest differences between people and machines is that people are prone to make mistakes in repetitive actions, while the record of machines making mistakes is almost zero."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"faster delivery"),(0,a.kt)("br",{parentName:"li"}),"Quick submission and quick release. If you find an error in the current version after deployment, you can also fall back to the previous version as soon as possible."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"higher product quality"),(0,a.kt)("br",{parentName:"li"}),"Integration server provides workflows such as Code review, automated testing, and so on. This can greatly enhance the quality of the product.")),(0,a.kt)("h2",{id:"usage"},"Usage"),(0,a.kt)("h3",{id:"precondition"},"Precondition"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The pipeline project has been configured on GitLab."),(0,a.kt)("li",{parentName:"ul"},"You have the maintainer or owner role of the project.")),(0,a.kt)("h3",{id:"initialization"},"Initialization"),(0,a.kt)("p",null,"A plugin project initialized with ONES CLI generates two GitLab CI/CD related configurations. ",(0,a.kt)("inlineCode",{parentName:"p"},".gitlab-ci.yml")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"config/ci-deploy.yaml"),"."),(0,a.kt)("h4",{id:"gitlab-ciyml"},".gitlab-ci.yml"),(0,a.kt)("p",null,"The preconfigured content of ",(0,a.kt)("inlineCode",{parentName:"p"},".gitlab-ci.yml")," in the plugin project will trigger the pipeline project provided by us, which will help you deploy the generated plugin package to the corresponding ONES instance environment. For the rest of the configuration, please refer to: ",(0,a.kt)("a",{parentName:"p",href:"https://docs.gitlab.cn/jh/ci/yaml/gitlab_ci_yaml.html"},".gitlab-ci.yml"),"."),(0,a.kt)("h4",{id:"ci-deployyaml"},"ci-deploy.yaml"),(0,a.kt)("p",null,"The main function of the file ",(0,a.kt)("inlineCode",{parentName:"p"},"ci-deploy.yaml")," is to ",(0,a.kt)("strong",{parentName:"p"},"set the parameters required for GitLab pipelining to run"),"."),(0,a.kt)("h3",{id:"step-1-connect-ones"},"Step 1: Connect ONES"),(0,a.kt)("p",null,"Because the pipeline will help you deploy the generated plugin package to the corresponding ONES environment, you need to connect to ONES first. Execute the following command in the root directory of the plugin project:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"npx op ci\n")),(0,a.kt)("p",null,"There will be the following interactive questions and answers during the connection process:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"Branch name: master\n? Please enter the environment base URL: https://ones.com\n? Username: test@ones.com\n? Password: [hidden]\n  \u2714 Converting CI deployment params\n  \u2714 Validating CI deployment params\n  \u2714 Updating configuration into config/ci-deploy.yaml\n\u2714 Successfully updated CI deployment configuration\nNow you can commit your changes to the remote repository and deploy your project\n? Do you want to execute 'npx op pickteam' for update team information into config file? (Y/n)\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Input parameter definition:")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"branch name (current branch name):")," for the selected branch name, enter master or main"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"base URL:")," ONES address"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"username:")," ONES user name"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"password:")," ONES password")),(0,a.kt)("p",null,"After the parameter input is completed and the verification is successful, you will be asked if you need to execute the ",(0,a.kt)("inlineCode",{parentName:"p"},"pickteam")," command to select a team. Of course, you can also manually execute ",(0,a.kt)("inlineCode",{parentName:"p"},"npx op pickteam ci")," later to select a team."),(0,a.kt)("admonition",{title:"notice",type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"After executing ",(0,a.kt)("inlineCode",{parentName:"p"},"npx op pickteam ci"),", you will need to enter a branchName, and then you can select ",(0,a.kt)("inlineCode",{parentName:"p"},"default"),".")),(0,a.kt)("p",null,"After the above operations are completed, the op tool will write back some configurations to the ",(0,a.kt)("inlineCode",{parentName:"p"},"ci-deploy.yaml")," file under the project. ",(0,a.kt)("strong",{parentName:"p"},"do not modify the configuration manually"),". The configuration is as follows:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="/config/ci-deploy.yaml"',title:'"/config/ci-deploy.yaml"'},"default:\n  host: https://ones.com\n  username: test@ones.com\n  password: test1234\n  ones-check-id: 6vjJcr4L\n  ones-check-point: team\n  ones-plugin-id: JefbDHq5\n  team_uuid: 6vjJcr4L\n")),(0,a.kt)("p",null,"At this point, the connection ONES is complete."),(0,a.kt)("h3",{id:"step-2-credential-information-desensitization"},"Step 2: Credential information desensitization"),(0,a.kt)("p",null,"User credentials are stored in plaintext in the ",(0,a.kt)("inlineCode",{parentName:"p"},"/config/ci-deploy.yaml")," file. When you do not want to store credentials in clear text, you can add user credentials to ",(0,a.kt)("a",{parentName:"p",href:"https://gitlab.plugins.myones.net/help/ci/variables/index.md#add-a-cicd-variable-to-a-project"},"CI/CD variable"),"."),(0,a.kt)("p",null,"Go to ","[Settings]"," of GitLab and select ","[CI/CD]",", then find ","[Variables]"," on the page to configure the credential information."),(0,a.kt)("p",null,(0,a.kt)(o.Z,{img:i(70412),mdxType:"Image"})),(0,a.kt)("admonition",{title:"notice",type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"The Key configured by Gitlab CI/CD Variable must be consistent with the configuration file")),(0,a.kt)("p",null,"Then replace the corresponding fields in ",(0,a.kt)("inlineCode",{parentName:"p"},"ci-deploy.yaml")," in the plugin project, such as the username and password fields."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="config/ci-deploy.yaml"',title:'"config/ci-deploy.yaml"'},"default:\n  host: https://ones.com\n  username: ${username}\n  password: ${password}\n  ones-check-id: 6vjJcr4L\n  ones-check-point: team\n  ones-plugin-id: JefbDHq5\n  team_uuid: 6vjJcr4L\n")),(0,a.kt)("h3",{id:"step-3-push-code-trigger-pipeline"},"Step 3: Push code, trigger pipeline"),(0,a.kt)("p",null,"Every time you push the code to the remote warehouse, the GitLab pipeline task will be triggered."),(0,a.kt)("p",null,'Go to "CI/CD" in GitLab and select "Pipelines" to see the pipelined task that has just been pushed and triggered. As shown below:'),(0,a.kt)(o.Z,{img:i(80889),mdxType:"Image"}),(0,a.kt)("h4",{id:"step-4-use-plugin"},"Step 4: Use plugin"),(0,a.kt)("p",null,"After all the pipelining tasks are successful, you can find your plug-in in the corresponding ONES environment and use it happily."),(0,a.kt)(o.Z,{img:i(3431),mdxType:"Image"}))}u.isMDXComponent=!0}}]);