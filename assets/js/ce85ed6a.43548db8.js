(self.webpackChunkopen_docs=self.webpackChunkopen_docs||[]).push([[13892],{35415:(e,t,i)=>{e.exports={src:{srcSet:i.p+"assets/ideal-img/audit-log1.8ae8227.1024.png 1024w,"+i.p+"assets/ideal-img/audit-log1.7bc8fe8.2384.png 2384w",images:[{path:i.p+"assets/ideal-img/audit-log1.8ae8227.1024.png",width:1024,height:514},{path:i.p+"assets/ideal-img/audit-log1.7bc8fe8.2384.png",width:2384,height:1196}],src:i.p+"assets/ideal-img/audit-log1.8ae8227.1024.png",toString:function(){return i.p+"assets/ideal-img/audit-log1.8ae8227.1024.png"},placeholder:void 0,width:1024,height:514},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAe0lEQVQImTWOSw7CMBBDe/8rcgMWLZnMLxPahxpgYVmWnmVvTR13JyKIzOX//Heui+0linTFzEh3Mpz8FWYVFoPHM9mktQVpJCmNFGFU0VpDVVE1xIJNRPAI3ue5ADVjzskYg33fcTNqjC94f+v3dARVtdR75ziOtXYXP6ILwd4APYh3AAAAAElFTkSuQmCC"}},33514:(e,t,i)=>{"use strict";i.r(t),i.d(t,{assets:()=>u,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>p,toc:()=>g});var a=i(87462),n=(i(67294),i(3905)),o=i(15944),s=i(35415),r=i.n(s);const l={sidebar_position:9,description:"Audit log are used in plugins."},d="Audit log",p={unversionedId:"abilities/basic/auditlog",id:"version-1.x/abilities/basic/auditlog",title:"Audit log",description:"Audit log are used in plugins.",source:"@site/versioned_docs/version-1.x/abilities/basic/auditlog.mdx",sourceDirName:"abilities/basic",slug:"/abilities/basic/auditlog",permalink:"/open-docs/docs/abilities/basic/auditlog",draft:!1,tags:[],version:"1.x",lastUpdatedBy:"liupengfei",lastUpdatedAt:1690862808,formattedLastUpdatedAt:"Aug 1, 2023",sidebarPosition:9,frontMatter:{sidebar_position:9,description:"Audit log are used in plugins."},sidebar:"abilities",previous:{title:"Timer",permalink:"/open-docs/docs/abilities/basic/timer"},next:{title:"Upload file",permalink:"/open-docs/docs/abilities/basic/uploadFile"}},u={},g=[{value:"Requirements",id:"requirements",level:2},{value:"Overview",id:"overview",level:2},{value:"Usage",id:"usage",level:2},{value:"Step 1\uff1aInstalling dependencies",id:"step-1installing-dependencies",level:3},{value:"Step 2\uff1aCall the <code>createLog</code> method in the plugin to write the audit log to ONES",id:"step-2call-the-createlog-method-in-the-plugin-to-write-the-audit-log-to-ones",level:3}],c={toc:g};function h(e){let{components:t,...i}=e;return(0,n.kt)("wrapper",(0,a.Z)({},c,i,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"audit-log"},"Audit log"),(0,n.kt)("h2",{id:"requirements"},"Requirements"),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:"left"},"ONES"),(0,n.kt)("th",{parentName:"tr",align:"left"},"@ones-op/node-ability"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"v3.6.0+"),(0,n.kt)("td",{parentName:"tr",align:"left"},"v0.1.9+")))),(0,n.kt)("h2",{id:"overview"},"Overview"),(0,n.kt)("p",null,"The plugin can write the audit log to the ONES. You can see the contents of the audit log on the ",(0,n.kt)("inlineCode",{parentName:"p"},"Configuration -> System security -> Audit Log")," page."),(0,n.kt)("p",null,"The operation type of audit log generated by plugin using this ability is ",(0,n.kt)("strong",{parentName:"p"},"Plugin log"),"."),(0,n.kt)(o.Z,{img:r(),mdxType:"Image"}),(0,n.kt)("h2",{id:"usage"},"Usage"),(0,n.kt)("h3",{id:"step-1installing-dependencies"},"Step 1\uff1aInstalling dependencies"),(0,n.kt)("p",null,"Enter the ",(0,n.kt)("inlineCode",{parentName:"p"},"/backend")," directory of the plugin project, and execute the following command for dependent installation:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"npm i @ones-op/node-ability\n")),(0,n.kt)("h3",{id:"step-2call-the-createlog-method-in-the-plugin-to-write-the-audit-log-to-ones"},"Step 2\uff1aCall the ",(0,n.kt)("inlineCode",{parentName:"h3"},"createLog")," method in the plugin to write the audit log to ONES"),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"The ",(0,n.kt)("inlineCode",{parentName:"p"},"createLog")," method requires two input parameters, one of which contains the structure of the ",(0,n.kt)("inlineCode",{parentName:"p"},"X-Real-Ip")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"Ones-User-Id")," fields, as well as the audit information to be recorded ",(0,n.kt)("inlineCode",{parentName:"p"},"message"),". ",(0,n.kt)("inlineCode",{parentName:"p"},"Ones-User-Id")," is the uuid of the operator,",(0,n.kt)("inlineCode",{parentName:"p"},"X-Real-Ip")," is the IP address of the operator.")),(0,n.kt)("p",null,"As shown in the following code, construct a structure ",(0,n.kt)("inlineCode",{parentName:"p"},"auditData")," with ",(0,n.kt)("inlineCode",{parentName:"p"},"X-Real-Ip")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"Ones-User-Id")," as the first input parameter, and take the audit information you want to record ",(0,n.kt)("inlineCode",{parentName:"p"},"message")," as the second input parameter, and call the ",(0,n.kt)("inlineCode",{parentName:"p"},"createLog")," method to write to the plugin audit log. If it is an organization-level plugin, it needs the team's unique identifier ",(0,n.kt)("inlineCode",{parentName:"p"},"teamUUID")," as the third entry."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-typescript"},"import { AuditLog } from '@ones-op/node-ability'\n\nexport async function testAuditLog(request: PluginRequest): Promise<PluginResponse> {\n  const auditHeader = {\n    'Ones-User-Id': 'E6ZqgsSX', //This parameter is user uuid\n    'X-Real-Ip': '127.0.0.1', //IP address\n  }\n  const resp = await AuditLog.createLog(auditHeader, 'Test log')\n  return {\n    body: {\n      res: 'audit log',\n      resp: resp,\n    },\n  }\n}\n")),(0,n.kt)("p",null,"The header of ",(0,n.kt)("inlineCode",{parentName:"p"},"request")," contains all the parameters required by the ",(0,n.kt)("inlineCode",{parentName:"p"},"createLog")," method, so you can directly use the header of ",(0,n.kt)("inlineCode",{parentName:"p"},"request")," as a parameter. The operator of the audit diary is the user accessing the interface, and the IP address of the audit log is the IP address of the user accessing the interface, as shown below."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-typescript"},"import { AuditLog } from '@ones-op/node-ability'\n\nexport async function hello(request: PluginRequest): Promise<PluginResponse> {\n  const body = request.body || {}\n  await AuditLog.createLog(request.headers, 'Audit log from plugin') //write audit information\n  return {\n    body: {\n      res: 'audit log',\n      requestBody: body,\n    },\n  }\n}\n")))}h.isMDXComponent=!0}}]);