(self.webpackChunkopen_docs=self.webpackChunkopen_docs||[]).push([[8222],{70665:(t,e,n)=>{t.exports={src:{srcSet:n.p+"assets/ideal-img/notify-01.6e81845.870.png 870w",images:[{path:n.p+"assets/ideal-img/notify-01.6e81845.870.png",width:870,height:504}],src:n.p+"assets/ideal-img/notify-01.6e81845.870.png",toString:function(){return n.p+"assets/ideal-img/notify-01.6e81845.870.png"},placeholder:void 0,width:870,height:504},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAYAAAD68A/GAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAq0lEQVQImX2MPQrCQBCF95pWdtrrFSxstFMv4CkUsREbEQsF2xAiCIlx8zNJdhP9JAlo58A3vPdmeOr+EKDi/7xRkhuuTsLqoNmeInbnmP0lafTm2HrJDMqYjOXapzNy6U08hguPwcyhP/Xojl0G8xtBmKCekWCtbeprRAStNbxf30zHgqqX5AVlVVEYS5Yb8qKlLCusLX+Pzyilbg51ShDG+GHEQydN1t5SPkFY3tigQttIAAAAAElFTkSuQmCC"}},17942:(t,e,n)=>{"use strict";n.d(e,{Zo:()=>d,kt:()=>f});var a=n(50959);function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach((function(e){i(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function l(t,e){if(null==t)return{};var n,a,i=function(t,e){if(null==t)return{};var n,a,i={},r=Object.keys(t);for(a=0;a<r.length;a++)n=r[a],e.indexOf(n)>=0||(i[n]=t[n]);return i}(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(a=0;a<r.length;a++)n=r[a],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}var s=a.createContext({}),p=function(t){var e=a.useContext(s),n=e;return t&&(n="function"==typeof t?t(e):o(o({},e),t)),n},d=function(t){var e=p(t.components);return a.createElement(s.Provider,{value:e},t.children)},u="mdxType",c={inlineCode:"code",wrapper:function(t){var e=t.children;return a.createElement(a.Fragment,{},e)}},m=a.forwardRef((function(t,e){var n=t.components,i=t.mdxType,r=t.originalType,s=t.parentName,d=l(t,["components","mdxType","originalType","parentName"]),u=p(n),m=i,f=u["".concat(s,".").concat(m)]||u[m]||c[m]||r;return n?a.createElement(f,o(o({ref:e},d),{},{components:n})):a.createElement(f,o({ref:e},d))}));function f(t,e){var n=arguments,i=e&&e.mdxType;if("string"==typeof t||i){var r=n.length,o=new Array(r);o[0]=m;var l={};for(var s in e)hasOwnProperty.call(e,s)&&(l[s]=e[s]);l.originalType=t,l[u]="string"==typeof t?t:i,o[1]=l;for(var p=2;p<r;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},57444:(t,e,n)=>{"use strict";n.r(e),n.d(e,{assets:()=>p,contentTitle:()=>l,default:()=>g,frontMatter:()=>o,metadata:()=>s,toc:()=>d});var a=n(28957),i=(n(50959),n(17942)),r=n(49500);const o={id:"notifications",sidebar_position:5,description:"Plugins have the ability to send message notifications to users, supporting various notification channels such as WeChat, DingTalk, Youdu, Feishu, and email."},l="Send external notifications",s={unversionedId:"abilities/basic/notifications",id:"abilities/basic/notifications",title:"Send external notifications",description:"Plugins have the ability to send message notifications to users, supporting various notification channels such as WeChat, DingTalk, Youdu, Feishu, and email.",source:"@site/docs/abilities/basic/notifications.mdx",sourceDirName:"abilities/basic",slug:"/abilities/basic/notifications",permalink:"/open-docs/docs/abilities/basic/notifications",draft:!1,tags:[],version:"current",lastUpdatedBy:"liupengfei",lastUpdatedAt:1703495563,formattedLastUpdatedAt:"Dec 25, 2023",sidebarPosition:5,frontMatter:{id:"notifications",sidebar_position:5,description:"Plugins have the ability to send message notifications to users, supporting various notification channels such as WeChat, DingTalk, Youdu, Feishu, and email."},sidebar:"abilities",previous:{title:"Database",permalink:"/open-docs/docs/abilities/basic/database"},next:{title:"Custom plugin configuration",permalink:"/open-docs/docs/abilities/basic/custom-config"}},p={},d=[{value:"Requirements",id:"requirements",level:2},{value:"Overview",id:"overview",level:2},{value:"Usage",id:"usage",level:2},{value:"Step 1: Installation dependency",id:"step-1-installation-dependency",level:3},{value:"Step 2: Send notification",id:"step-2-send-notification",level:3}],u=(c="Image",function(t){return r.warn("Component "+c+" was not imported, exported, or provided by MDXProvider as global scope"),(0,i.kt)("div",t)});var c;const m={toc:d},f="wrapper";function g(t){let{components:e,...r}=t;return(0,i.kt)(f,(0,a.Z)({},m,r,{components:e,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"send-external-notifications"},"Send external notifications"),(0,i.kt)("h2",{id:"requirements"},"Requirements"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"left"},"ONES"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"v3.6.0+")))),(0,i.kt)("h2",{id:"overview"},"Overview"),(0,i.kt)("p",null,"The plugin has the ability to send message notifications to users. The supported notification channels include WeChat, DingDing, Youdu, Lark and email."),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"If you need to send a notification to a third-party system, you need to access the corresponding",(0,i.kt)("strong",{parentName:"p"}," ",(0,i.kt)("a",{parentName:"strong",href:"/open-docs/docs/abilities/business/account/synchronize-with-third-party-system/"},"Three-Party System")," ")," To send notifications normally.")),(0,i.kt)("h2",{id:"usage"},"Usage"),(0,i.kt)("h3",{id:"step-1-installation-dependency"},"Step 1: Installation dependency"),(0,i.kt)("p",null,"Enter the ",(0,i.kt)("inlineCode",{parentName:"p"},"/backend")," directory of the plugin project, and execute the following command for dependent installation:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"npm i @ones-op/node-ability\n")),(0,i.kt)("h3",{id:"step-2-send-notification"},"Step 2: Send notification"),(0,i.kt)("p",null,"Use the ",(0,i.kt)("a",{parentName:"p",href:"/open-docs/docs/reference/packages/node-ability/#Notify"},"Notify")," method to send a notification to the user."),(0,i.kt)("p",null,"Example: use the ",(0,i.kt)("a",{parentName:"p",href:"/open-docs/docs/abilities/basic/ones-api/registration"},"ONES API registration")," the ability registration API, and pass in the user ",(0,i.kt)("inlineCode",{parentName:"p"},"uuid")," when calling the interface, and send a test email to the specified user."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Notify, NotifyWay } from '@ones-op/node-ability'\n\nexport async function sendEmail(request: PluginRequest): Promise<PluginResponse> {\n  const { user_uuid } = request?.body as any\n  if (!user_uuid) {\n    return {\n      body: {\n        error: 'Missing parameters user_uuid',\n      },\n    }\n  }\n  const NotifyRes = await Notify({\n    Title: 'Test',\n    ToUsers: [user_uuid],\n    NotifyWay: NotifyWay.Email,\n    MessageBody: [\n      {\n        Body: 'Email sending test',\n        Url: 'https://ones.com/',\n      },\n    ],\n    Ext: 'ext string',\n  })\n  return {\n    body: {\n      NotifyRes: NotifyRes,\n      data: 'success',\n    },\n  }\n}\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Param")),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"left"},(0,i.kt)("strong",{parentName:"th"},"Param")),(0,i.kt)("th",{parentName:"tr",align:"left"},(0,i.kt)("strong",{parentName:"th"},"Type")),(0,i.kt)("th",{parentName:"tr",align:"left"},(0,i.kt)("strong",{parentName:"th"},"Description")),(0,i.kt)("th",{parentName:"tr",align:"left"},(0,i.kt)("strong",{parentName:"th"},"Required")),(0,i.kt)("th",{parentName:"tr",align:"left"},(0,i.kt)("strong",{parentName:"th"},"Default")))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"Title"),(0,i.kt)("td",{parentName:"tr",align:"left"},"string"),(0,i.kt)("td",{parentName:"tr",align:"left"},"information title"),(0,i.kt)("td",{parentName:"tr",align:"left"},"Y"),(0,i.kt)("td",{parentName:"tr",align:"left"},"-")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"ToUsers"),(0,i.kt)("td",{parentName:"tr",align:"left"},"string[]"),(0,i.kt)("td",{parentName:"tr",align:"left"},"Array of users to receive notifications"),(0,i.kt)("td",{parentName:"tr",align:"left"},"Y"),(0,i.kt)("td",{parentName:"tr",align:"left"},"-")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"NotifyWay"),(0,i.kt)("td",{parentName:"tr",align:"left"},"NotifyWay"),(0,i.kt)("td",{parentName:"tr",align:"left"},"Notification type, optional values:",(0,i.kt)("br",null),"- Email: NotifyWay.Email",(0,i.kt)("br",null),"- Lark: NotifyWay.Lark",(0,i.kt)("br",null),"- YouDu: NotifyWay.YouDu",(0,i.kt)("br",null),"- WeChat: NotifyWay.WeChat",(0,i.kt)("br",null),"- DingDing: NotifyWay.DingDing"),(0,i.kt)("td",{parentName:"tr",align:"left"},"Y"),(0,i.kt)("td",{parentName:"tr",align:"left"},"-")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"MessageBody"),(0,i.kt)("td",{parentName:"tr",align:"left"},"IMessageBody[]"),(0,i.kt)("td",{parentName:"tr",align:"left"},"Array of message bodies, each message body contains:",(0,i.kt)("br",null),"- Body: notification content",(0,i.kt)("br",null),"- url\uff1anotification jump link"),(0,i.kt)("td",{parentName:"tr",align:"left"},"Y"),(0,i.kt)("td",{parentName:"tr",align:"left"},"-")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"Ext"),(0,i.kt)("td",{parentName:"tr",align:"left"},"string"),(0,i.kt)("td",{parentName:"tr",align:"left"},"MessageType, supports:",(0,i.kt)("br",null),"When NotifyWay Field is ",(0,i.kt)("inlineCode",{parentName:"td"},"NotifyWay.YouDu"),", optional values are:",(0,i.kt)("br",null),"- ",(0,i.kt)("inlineCode",{parentName:"td"},"text"),": Text",(0,i.kt)("br",null),"- ",(0,i.kt)("inlineCode",{parentName:"td"},"exlink"),": External link"),(0,i.kt)("td",{parentName:"tr",align:"left"},"N"),(0,i.kt)("td",{parentName:"tr",align:"left"},"-")))),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Return")),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"left"},(0,i.kt)("strong",{parentName:"th"},"Parameter")),(0,i.kt)("th",{parentName:"tr",align:"left"},(0,i.kt)("strong",{parentName:"th"},"Type")),(0,i.kt)("th",{parentName:"tr",align:"left"},(0,i.kt)("strong",{parentName:"th"},"Description")),(0,i.kt)("th",{parentName:"tr",align:"left"},(0,i.kt)("strong",{parentName:"th"},"Required")),(0,i.kt)("th",{parentName:"tr",align:"left"},(0,i.kt)("strong",{parentName:"th"},"Default")))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"Error"),(0,i.kt)("td",{parentName:"tr",align:"left"},"ErrorMessage"),(0,i.kt)("td",{parentName:"tr",align:"left"},"Contains the following fields:",(0,i.kt)("br",null),"- Code: Fixed value: ",(0,i.kt)("inlineCode",{parentName:"td"},"11046"),(0,i.kt)("br",null),"- Msg: Fixed value: ",(0,i.kt)("inlineCode",{parentName:"td"},"NotifyEventFailure 11046"),(0,i.kt)("br",null),"- Err: Error message"),(0,i.kt)("td",{parentName:"tr",align:"left"},"N"),(0,i.kt)("td",{parentName:"tr",align:"left"},"-")))),(0,i.kt)("p",null,"The effect of sending mail is as shown in the figure:"),(0,i.kt)(u,{img:n(70665),mdxType:"Image"}))}g.isMDXComponent=!0}}]);