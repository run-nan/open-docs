(self.webpackChunkopen_docs=self.webpackChunkopen_docs||[]).push([[16576],{94926:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/add-ability.b073e16.1024.png 1024w,"+n.p+"assets/ideal-img/add-ability.54cad08.1528.png 1528w",images:[{path:n.p+"assets/ideal-img/add-ability.b073e16.1024.png",width:1024,height:137},{path:n.p+"assets/ideal-img/add-ability.54cad08.1528.png",width:1528,height:204}],src:n.p+"assets/ideal-img/add-ability.b073e16.1024.png",toString:function(){return n.p+"assets/ideal-img/add-ability.b073e16.1024.png"},placeholder:void 0,width:1024,height:137},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAABCAYAAADn9T9+AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAMklEQVQImWMwMjX5b29v/9/eweG/tr7Bf2V1zf+Kyir/lVRU/ysoq/wXl5L6Ly4t9R8ANC8O3Dgp/ncAAAAASUVORK5CYII="}},32064:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/export.75f59df.614.png 614w",images:[{path:n.p+"assets/ideal-img/export.75f59df.614.png",width:614,height:778}],src:n.p+"assets/ideal-img/export.75f59df.614.png",toString:function(){return n.p+"assets/ideal-img/export.75f59df.614.png"},placeholder:void 0,width:614,height:778},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAANCAYAAACQN/8FAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAvklEQVQokX1RWw6EIAzk/mf0T41RE+MrII92Nu1GFLLZJoUCw8wUTEoJdTBzUTMzjAzXdWGaJizLkkHvWYGyWNcVwzDgPE8QUQG4w0h5HAfmedYLMcYCyI80lGkcR7Vwg97gglGAN1sd/PbYdR3atsW+79i2DdZa3Q8hfBmJElxkWE8I3utB3/dqw3ufVYx0mRIhhEdWnso5V/hUjyLRNE0GCIsQFM3ERHognqR7mSXr3zEi+y+ytPx1/bi/8gNFcv6h2tpAoAAAAABJRU5ErkJggg=="}},2805:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/lib.84e1c4f.1024.png 1024w,"+n.p+"assets/ideal-img/lib.8adf64c.2560.png 2560w",images:[{path:n.p+"assets/ideal-img/lib.84e1c4f.1024.png",width:1024,height:564},{path:n.p+"assets/ideal-img/lib.8adf64c.2560.png",width:2560,height:1410}],src:n.p+"assets/ideal-img/lib.84e1c4f.1024.png",toString:function(){return n.p+"assets/ideal-img/lib.84e1c4f.1024.png"},placeholder:void 0,width:1024,height:564},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAaUlEQVQImTWOAQoAIQgE/f9n47jM1LM9VkgQN5kGZYyBtRbcHdu9Z0R0f1XICDzTIGaGyMTeu6Gqwjmnm7kFZhB9X7hZL+acUNW2ZWaDzKoLUpn4Mtp4rReilW+eJgB6yRMIsPjhZhoJ/lxSw/1OyNKUAAAAAElFTkSuQmCC"}},483:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/render.9e9a326.1024.png 1024w,"+n.p+"assets/ideal-img/render.452ee20.2560.png 2560w",images:[{path:n.p+"assets/ideal-img/render.9e9a326.1024.png",width:1024,height:564},{path:n.p+"assets/ideal-img/render.452ee20.2560.png",width:2560,height:1410}],src:n.p+"assets/ideal-img/render.9e9a326.1024.png",toString:function(){return n.p+"assets/ideal-img/render.9e9a326.1024.png"},placeholder:void 0,width:1024,height:564},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAcUlEQVQImT2OCwoDQQhD5/6XXdrujPG3KZFSQYxBH1nXdfGcQ3cn3GdGxHR1MyP4uo3LzMaEGR3GruTTzadqtAMEjGvvPRQZ9+dN7XrMTHYVw8F9Dld3s6qGCEWAMd1/5BqAoi2S1LEiiKIC8Nei6/ALTnPD2jKY2Q0AAAAASUVORK5CYII="}},56250:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/setting.30db079.1024.png 1024w,"+n.p+"assets/ideal-img/setting.dd4dae8.2560.png 2560w",images:[{path:n.p+"assets/ideal-img/setting.30db079.1024.png",width:1024,height:573},{path:n.p+"assets/ideal-img/setting.dd4dae8.2560.png",width:2560,height:1432}],src:n.p+"assets/ideal-img/setting.30db079.1024.png",toString:function(){return n.p+"assets/ideal-img/setting.30db079.1024.png"},placeholder:void 0,width:1024,height:573},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAi0lEQVQImTWNwQrCQAxE959bd0022Z4q1LZQ67GoH1K8KH7XyKwYCCSZN5OQUoKqwtwhouDOFlWUUuBuOGpGyDnD3St86ntclgXXdcU4DNVsZjDLCATobJoGz33Hv17vD1KMVWNY4MAWEczThMf9hm3bcB5nFCa6/8Cu6yrIF4RjjDi0LVQE1Hgn+AU12IB5muge+AAAAABJRU5ErkJggg=="}},83845:(e,t,n)=>{"use strict";n.r(t),n.d(t,{assets:()=>b,contentTitle:()=>f,default:()=>N,frontMatter:()=>A,metadata:()=>k,toc:()=>w});var o=n(87462),i=(n(67294),n(3905)),s=n(15944),a=n(2805),p=n.n(a),r=n(483),d=n.n(r),m=n(56250),l=n.n(m),c=n(32064),u=n.n(c),g=n(94926),h=n.n(g);const A={sidebar_position:11,description:"----"},f="Custom test reporting components",k={unversionedId:"abilities/business/testcase-report-component/index",id:"abilities/business/testcase-report-component/index",title:"Custom test reporting components",description:"----",source:"@site/docs/abilities/business/testcase-report-component/index.mdx",sourceDirName:"abilities/business/testcase-report-component",slug:"/abilities/business/testcase-report-component/",permalink:"/open-docs/docs/next/abilities/business/testcase-report-component/",draft:!1,tags:[],version:"current",lastUpdatedBy:"liupengfei",lastUpdatedAt:1690863366,formattedLastUpdatedAt:"Aug 1, 2023",sidebarPosition:11,frontMatter:{sidebar_position:11,description:"----"},sidebar:"abilities",previous:{title:"Scene: Use external storage",permalink:"/open-docs/docs/next/abilities/business/Independent-hosting-service/external-storage"},next:{title:"Custom project components",permalink:"/open-docs/docs/next/abilities/business/project-custom-component/"}},b={},w=[{value:"Requirements",id:"requirements",level:2},{value:"Overview",id:"overview",level:2},{value:"Performance",id:"performance",level:3},{value:"Usage",id:"usage",level:2},{value:"Install pre-dependencies",id:"install-pre-dependencies",level:3},{value:"Add Ability",id:"add-ability",level:3},{value:"Custom component card content",id:"custom-component-card-content",level:3},{value:"Custom component export content",id:"custom-component-export-content",level:3},{value:"Custom component setting popup",id:"custom-component-setting-popup",level:3},{value:"Q&amp;A",id:"qa",level:2}],C={toc:w};function N(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,o.Z)({},C,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"custom-test-reporting-components"},"Custom test reporting components"),(0,i.kt)("h2",{id:"requirements"},"Requirements"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"left"},"ONES"),(0,i.kt)("th",{parentName:"tr",align:"left"},"@ones-op/store"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"v3.13.22+"),(0,i.kt)("td",{parentName:"tr",align:"left"},"v0.7.0+")))),(0,i.kt)("h2",{id:"overview"},"Overview"),(0,i.kt)("p",null,"The open platform provides the ability to customize test report components. When the test report components provided by the standard product cannot meet the requirements, use this ability to add a custom component in the test report and test report template editing page.\nWhen using this ability, the content that users can customize includes:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Component card rendering content"),(0,i.kt)("li",{parentName:"ol"},"Component configuration popup content"),(0,i.kt)("li",{parentName:"ol"},"Component export content")),(0,i.kt)("h3",{id:"performance"},"Performance"),(0,i.kt)("p",null,"When the plug-in which uses this capability is enabled, you can add custom components from the component library on the left when editing a test report or test report template"),(0,i.kt)(s.Z,{img:p(),mdxType:"Image"}),(0,i.kt)("p",null,"After adding a custom component, you can configure the content of the component through a custom configuration pop-up window"),(0,i.kt)(s.Z,{img:l(),mdxType:"Image"}),(0,i.kt)("p",null,"The customized content will be rendered in the component card"),(0,i.kt)(s.Z,{img:d(),mdxType:"Image"}),(0,i.kt)("p",null,"If you have configured custom component export content, the exported test report will contain the content of the custom component"),(0,i.kt)(s.Z,{img:u(),mdxType:"Image"}),(0,i.kt)("h2",{id:"usage"},"Usage"),(0,i.kt)("h3",{id:"install-pre-dependencies"},"Install pre-dependencies"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"npm i @ones-op/store\n")),(0,i.kt)("h3",{id:"add-ability"},"Add Ability"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Execute ",(0,i.kt)("inlineCode",{parentName:"p"},"npx op add ability")," , select ",(0,i.kt)("inlineCode",{parentName:"p"},"testcase-report-custom-component@1.0.0")," to add an ability")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"As prompted, fill in the associated slot ",(0,i.kt)("inlineCode",{parentName:"p"},"ones:testcase:report:component:new")," name and create a sub-module to render the card content of the custom component in the test report"),(0,i.kt)(s.Z,{img:h(),mdxType:"Image"})," "),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"If the component does not need to support the ability to configure pop-up content, skip to the next step. Excute ",(0,i.kt)("inlineCode",{parentName:"p"},"npx op add sub-module")," , add a sub-module under the ",(0,i.kt)("inlineCode",{parentName:"p"},"ones:testcase:report:component:new module")," just added")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Manually configure the ability in ",(0,i.kt)("inlineCode",{parentName:"p"},"/config/plugin.yaml"),". A custom component module contains two submodules:"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"component card: ",(0,i.kt)("inlineCode",{parentName:"li"},"scene")," is ",(0,i.kt)("inlineCode",{parentName:"li"},"render"),", which is used to ",(0,i.kt)("inlineCode",{parentName:"li"},"render")," the card content of the custom component in the test report, which must be added"),(0,i.kt)("li",{parentName:"ul"},"setting popup: ",(0,i.kt)("inlineCode",{parentName:"li"},"scene")," is ",(0,i.kt)("inlineCode",{parentName:"li"},"setting"),", which is used to render the configuration pop-up window content of the custom component. If the component does not support configuration, you can choose not to add it")))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"modules:\n  - id: ones-testcase-report-component-new-5cZd\n    title: custom test report\n    moduleType: ones:testcase:report:component:new\n    modules:\n      - id: ones-testcase-report-component-new-U06I\n        title: card render\n        scene: render # necessary\n        entry: >-\n          modules/ones-testcase-report-component-new-5cZd/ones-testcase-report-component-new-U06I/index.html\n      - id: ones-testcase-report-component-new-NQD6\n        title: setting render\n        scene: setting # unnecessary\n        entry: >-\n          modules/ones-testcase-report-component-new-5cZd/ones-testcase-report-component-new-NQD6/index.html\n")),(0,i.kt)("h3",{id:"custom-component-card-content"},"Custom component card content"),(0,i.kt)("p",null,"In the module whose ",(0,i.kt)("inlineCode",{parentName:"p"},"scene")," is ",(0,i.kt)("inlineCode",{parentName:"p"},"render"),", get the component setting through ",(0,i.kt)("a",{parentName:"p",href:"../../../reference/packages/store/#useTestReportComponentInfo"},"useTestReportComponentInfo"),", and then render the corresponding UI according to the component setting"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import React from 'react'\nimport { useTestReportComponentInfo } from '@ones-op/store'\n\nexport const CustomComponentCard = () => {\n  // get the component setting\n  const { componentSetting } = useTestReportComponentInfo()\n  // render the corresponding UI according to the component setting\n  return (\n    <div>\n      <div>{JSON.stringify(componentSetting, null, 2)}</p>\n    </div>\n  )\n}\n\n")),(0,i.kt)("h3",{id:"custom-component-export-content"},"Custom component export content"),(0,i.kt)("p",null,"In the module where scene is render, use ",(0,i.kt)("a",{parentName:"p",href:"../../../reference/packages/store/#useTestReportComponentInfo"},"useTestReportComponentInfo")," to obtain the method to save the exported content, and then update the exported content according to the component setting"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import React from 'react'\nimport { useTestReportComponentInfo } from '@ones-op/store'\n\nexport const CustomComponentCard = () => {\n  // get the component setting and the method to save the exported content\n  const { componentSetting, updateComponentExportContent } = useTestReportComponentInfo()\n  // update the exported content according to the component setting\n  React.useEffect(() => {\n    updateComponentExportContent([\n      {\n        type: 'text',\n        content: JSON.stringify(componentSetting, null, 2),\n      },\n    ])\n  }, [componentSetting, updateComponentExportContent])\n  // omit follow-up content\n}\n")),(0,i.kt)("h3",{id:"custom-component-setting-popup"},"Custom component setting popup"),(0,i.kt)("p",null,"If the custom component needs to support configuration, then the developer needs to add a module with scene as setting. In this module, use the hook ",(0,i.kt)("a",{parentName:"p",href:"../../../reference/packages/store/#useTestReportComponentInfo"},"useTestReportComponentInfo")," to get the component setting, the method to update the component configuration, and the method to listen to the event of submitting the pop-up window, and then just render the editing form."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import React from 'react'\nimport { Form, Input } from '@ones-design/core'\nimport { useTestReportComponentInfo } from '@ones-op/store'\n\nexport const Setting = () => {\n  const { componentSetting, updateComponentSetting, addOnSubmitSettingListener } =\n    useTestReportComponentInfo()\n  const [form] = Form.useForm()\n  // The callback of the popup submission event\n  const onSubmitSetting = React.useCallback(\n    (next: () => void) => {\n      form\n        .validateFields()\n        .then(() => {\n          // If the form validation passes, update the component configuration, and call next to execute subsequent logic\n          updateComponentSetting(form.getFieldsValue())\n          next()\n        })\n        .catch((err) => {\n          console.log(err)\n        })\n    },\n    [form, updateComponentSetting]\n  )\n  // Listen to the pop-up window submission event when the component is mounted, and cancel the listener when the component is unmounted\n  React.useEffect(() => {\n    const unsubscribe = addOnSubmitSettingListener(onSubmitSetting)\n    return () => {\n      unsubscribe()\n    }\n  }, [onSubmitSetting])\n\n  return (\n    <Form initialValues={componentSetting} form={form}>\n      <Form.Item label=\"name\" name={['name']} rules={[{ required: true }]}>\n        <Input />\n      </Form.Item>\n    </Form>\n  )\n}\n")),(0,i.kt)("h2",{id:"qa"},"Q&A"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"How can the test report component name be multilingual?")),(0,i.kt)("p",null,"refer to ",(0,i.kt)("a",{parentName:"p",href:"/open-docs/docs/next/guide/abilities/multilingual"},"Plug-in multilingual support")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"service:\n  app_id: Wr1aVwZS\n  ...\nabilities:\n    - id: testcase-report-custom-component\n      name: testcase-report-custom-component\n      version: 1.0.0\n      abilityType: TestcaseReportCustomComponent\n      relateModule:\n        componentModule: 'ones-testcase-report-component-new-5cZd'\n      config:\n        - key: component_name\n          label: testcase-report-custom-component-name\n          value: {{.ComponentName}}\n          fieldType: Input\n          show: false\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"How to update test report component name?")),(0,i.kt)("p",null,"refer to ",(0,i.kt)("a",{parentName:"p",href:"/open-docs/docs/next/guide/upgrade"},"upgrade the plug-in")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Modify ",(0,i.kt)("inlineCode",{parentName:"li"},"abilities.config.value")," first, and then upgrade the plugin"),(0,i.kt)("li",{parentName:"ul"},"First modify the workspace ",(0,i.kt)("inlineCode",{parentName:"li"},"/lanuage/xx.yaml")," multilingual translation copy, and then upgrade the plug-in")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Test whether the report group name allows duplicate names?")),(0,i.kt)("p",null,"Not allowed."))}N.isMDXComponent=!0}}]);