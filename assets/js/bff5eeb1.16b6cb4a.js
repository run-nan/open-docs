"use strict";(self.webpackChunkopen_docs=self.webpackChunkopen_docs||[]).push([[3122],{17942:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>f});var a=n(50959);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),c=p(n),m=r,f=c["".concat(s,".").concat(m)]||c[m]||d[m]||i;return n?a.createElement(f,l(l({ref:t},u),{},{components:n})):a.createElement(f,l({ref:t},u))}));function f(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=m;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[c]="string"==typeof e?e:r,l[1]=o;for(var p=2;p<i;p++)l[p]=n[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},91044:(e,t,n)=>{n.r(t),n.d(t,{default:()=>l});var a=n(50959),r=n(45924);const i={tabItem:"tabItem_skN5"};function l(e){let{children:t,hidden:n,className:l}=e;return a.createElement("div",{role:"tabpanel",className:(0,r.Z)(i.tabItem,l),hidden:n},t)}},42181:(e,t,n)=>{n.d(t,{Z:()=>m});var a=n(28957),r=n(50959),i=n(45924),l=n(70562),o=n(94506),s=n(75814);const p={tabList:"tabList_Ifpf",tabItem:"tabItem_j1rW"};function u(e){let{className:t,block:n,selectedValue:o,selectValue:s,tabValues:u}=e;const c=[],{blockElementScrollPositionUntilNextRender:d}=(0,l.o5)(),m=e=>{const t=e.currentTarget,n=c.indexOf(t),a=u[n].value;a!==o&&(d(t),s(a))},f=e=>{var t;let n=null;switch(e.key){case"Enter":m(e);break;case"ArrowRight":{var a;const t=c.indexOf(e.currentTarget)+1;n=null!=(a=c[t])?a:c[0];break}case"ArrowLeft":{var r;const t=c.indexOf(e.currentTarget)-1;n=null!=(r=c[t])?r:c[c.length-1];break}}null==(t=n)||t.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":n},t)},u.map((e=>{let{value:t,label:n,attributes:l}=e;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:o===t?0:-1,"aria-selected":o===t,key:t,ref:e=>c.push(e),onKeyDown:f,onClick:m},l,{className:(0,i.Z)("tabs__item",p.tabItem,null==l?void 0:l.className,{"tabs__item--active":o===t})}),null!=n?n:t)})))}function c(e){let{lazy:t,children:n,selectedValue:a}=e;const i=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=i.find((e=>e.props.value===a));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},i.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==a}))))}function d(e){const t=(0,o.Y)(e);return r.createElement("div",{className:(0,i.Z)("tabs-container",p.tabList)},r.createElement(u,(0,a.Z)({},e,t)),r.createElement(c,(0,a.Z)({},e,t)))}function m(e){const t=(0,s.default)();return r.createElement(d,(0,a.Z)({key:String(t)},e))}},94506:(e,t,n)=>{n.d(t,{Y:()=>d});var a=n(50959),r=n(28903),i=n(94150),l=n(40828),o=n(29163);function s(e){return function(e){var t,n;return null!=(t=null==(n=a.Children.map(e,(e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})))?void 0:n.filter(Boolean))?t:[]}(e).map((e=>{let{props:{value:t,label:n,attributes:a,default:r}}=e;return{value:t,label:n,attributes:a,default:r}}))}function p(e){const{values:t,children:n}=e;return(0,a.useMemo)((()=>{const e=null!=t?t:s(n);return function(e){const t=(0,l.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function u(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function c(e){let{queryString:t=!1,groupId:n}=e;const l=(0,r.k6)(),o=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=n?n:null}({queryString:t,groupId:n});return[(0,i._X)(o),(0,a.useCallback)((e=>{if(!o)return;const t=new URLSearchParams(l.location.search);t.set(o,e),l.replace({...l.location,search:t.toString()})}),[o,l])]}function d(e){const{defaultValue:t,queryString:n=!1,groupId:r}=e,i=p(e),[l,s]=(0,a.useState)((()=>function(e){var t;let{defaultValue:n,tabValues:a}=e;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!u({value:n,tabValues:a}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${a.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const r=null!=(t=a.find((e=>e.default)))?t:a[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:t,tabValues:i}))),[d,m]=c({queryString:n,groupId:r}),[f,g]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[r,i]=(0,o.Nk)(n);return[r,(0,a.useCallback)((e=>{n&&i.set(e)}),[n,i])]}({groupId:r}),b=(()=>{const e=null!=d?d:f;return u({value:e,tabValues:i})?e:null})();(0,a.useLayoutEffect)((()=>{b&&s(b)}),[b]);return{selectedValue:l,selectValue:(0,a.useCallback)((e=>{if(!u({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);s(e),m(e),g(e)}),[m,g,i]),tabValues:i}}},74166:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>s,default:()=>f,frontMatter:()=>o,metadata:()=>p,toc:()=>c});var a=n(28957),r=(n(50959),n(17942)),i=n(42181),l=n(91044);const o={sidebar_position:13,description:"File storage for the plugin itself."},s="Plugin file operation",p={unversionedId:"abilities/basic/plugin-fileOP",id:"abilities/basic/plugin-fileOP",title:"Plugin file operation",description:"File storage for the plugin itself.",source:"@site/docs/abilities/basic/plugin-fileOP.md",sourceDirName:"abilities/basic",slug:"/abilities/basic/plugin-fileOP",permalink:"/open-docs/docs/abilities/basic/plugin-fileOP",draft:!1,tags:[],version:"current",lastUpdatedBy:"liupengfei",lastUpdatedAt:1703234094,formattedLastUpdatedAt:"Dec 22, 2023",sidebarPosition:13,frontMatter:{sidebar_position:13,description:"File storage for the plugin itself."},sidebar:"abilities",previous:{title:"Download file",permalink:"/open-docs/docs/abilities/basic/downloadFile"},next:{title:"Application menu entry",permalink:"/open-docs/docs/abilities/basic/app-menu"}},u={},c=[{value:"Requirements",id:"requirements",level:2},{value:"Overview",id:"overview",level:2},{value:"Usage",id:"usage",level:2},{value:"Step 1: Installing dependencies",id:"step-1-installing-dependencies",level:3},{value:"Step 2: Example",id:"step-2-example",level:3},{value:"SDK",id:"sdk",level:2}],d={toc:c},m="wrapper";function f(e){let{components:t,...n}=e;return(0,r.kt)(m,(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"plugin-file-operation"},"Plugin file operation"),(0,r.kt)("h2",{id:"requirements"},"Requirements"),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(l.default,{value:"2",label:"3.14.0+",mdxType:"TabItem"},(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"ONES"),(0,r.kt)("th",{parentName:"tr",align:"left"},"@ones-op/node-fs"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"v3.14.0+"),(0,r.kt)("td",{parentName:"tr",align:"left"},"v0.0.1+"))))),(0,r.kt)(l.default,{value:"1",label:"3.6.0+ ",mdxType:"TabItem"},(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"ONES"),(0,r.kt)("th",{parentName:"tr",align:"left"},"@ones-op/node-utils"),(0,r.kt)("th",{parentName:"tr",align:"left"},"@ones-op/node-file"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"v3.6.0+"),(0,r.kt)("td",{parentName:"tr",align:"left"},"v0.2.0+"),(0,r.kt)("td",{parentName:"tr",align:"left"},"v0.3.0+")))))),(0,r.kt)("h2",{id:"overview"},"Overview"),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(l.default,{value:"2",label:"3.14.0+",mdxType:"TabItem"},(0,r.kt)("p",null,"Each plugin has its own file workspace, which allows the plugin to create, read, write and preset its own files, which is located under ",(0,r.kt)("inlineCode",{parentName:"p"},"{{plugin root directory}}/workspace"),"."),(0,r.kt)("p",null,"Before the plugin is packaged, you can place the files you need in ",(0,r.kt)("inlineCode",{parentName:"p"},"{{plugin root directory}}/workspace"),". After the plugin is successfully installed and enabled, you can manipulate the plugin files and manipulate the files in the directory.")),(0,r.kt)(l.default,{value:"1",label:"3.6.0+ ",mdxType:"TabItem"},(0,r.kt)("p",null,"Each plugin has its own file workspace, which allows the plugin to create, read, write and preset its own files, which is located under ",(0,r.kt)("inlineCode",{parentName:"p"},"{{plugin root directory}}/workspace"),"."),(0,r.kt)("p",null,"Before the plugin is packaged, you can place the files you need in ",(0,r.kt)("inlineCode",{parentName:"p"},"{{plugin root directory}}/workspace"),". After the plugin is successfully installed and enabled, you can manipulate the plugin files and manipulate the files in the directory."),(0,r.kt)("p",null,"In order to facilitate the reading and writing of files, we provide a way to debug with local files, so that developers can see the effect of the code more intuitively without visiting the debugging server. If you need to redirect the file storage during debugging of the target plugin locally, you need to:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"modify the configuration in ",(0,r.kt)("inlineCode",{parentName:"li"},"config/local.yaml"),"\uff1b")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"local:\n  file_in_local: true\n")))),(0,r.kt)("h2",{id:"usage"},"Usage"),(0,r.kt)("h3",{id:"step-1-installing-dependencies"},"Step 1: Installing dependencies"),(0,r.kt)("p",null,"Enter the ",(0,r.kt)("inlineCode",{parentName:"p"},"/backend")," directory of the plugin project, and execute the following command for dependent installation:"),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(l.default,{value:"2",label:"3.14.0+",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"npm i @ones-op/node-fs\n"))),(0,r.kt)(l.default,{value:"1",label:"3.6.0+ ",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"npm i @ones-op/node-file\n")))),(0,r.kt)("h3",{id:"step-2-example"},"Step 2: Example"),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(l.default,{value:"2",label:"3.14.0+",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"import { promises } from '@ones-op/node-fs'\nimport { Logger } from '@ones-op/node-logger'\nimport { String2Unit8Array, Object2Unit8Array, Unit8Array2String } from '@ones-op/node-utils'\n\nconst dir1_name = './dir1'\nconst dir2_name = './dir1/dir2'\nconst dir3_name = './dir1/dir2/dir3'\nconst file21_name = './dir1/dir2/file21.txt'\nconst file21_copy_name = './dir1/dir2/file21_copy.txt'\nconst file21_cp_name = './dir1/dir2/file21_cp.txt'\nconst file21_rename_name = './dir1/dir2/file21_rename.txt'\nconst file21_copy_link_name = './dir1/dir2/file21_copy_link'\nconst file21_copy_symlink_name = './dir1/dir2/file21_copy_symlink'\nconst file22_name = './dir1/dir2/file22.txt'\nconst file23_name = './dir1/dir2/file23.txt'\n\nexport async function TestFile() {\n  let res\n  try {\n    await promises.mkdir(dir1_name)\n    await promises.mkdir(dir3_name, { recursive: true }) //Returns the top-level parent directory created\n    await promises.mkdtemp(path.join(dir2_name, 'foo-'))\n    await promises.writeFile(file21_name, '')\n\n    await promises.writeFile(file21_name, 'hello world\\n')\n    await promises.appendFile(file21_name, 'this is append content\\n')\n    await promises.copyFile(file21_name, file21_copy_name)\n    await promises.copyFile(file21_name, file22_name)\n    await promises.copyFile(file21_name, file23_name)\n    await promises.cp(file21_name, file21_cp_name)\n    await promises.rename(file21_name, file21_rename_name)\n\n    res = await promises.readFile(file22_name)\n    Logger.info('readFile:', Unit8Array2String(res))\n    const dir = await promises.opendir(dir2_name)\n    for await (const dirent of dir) Logger.info('opendir dirent:', dirent.name)\n    const files = await promises.readdir(dir2_name)\n    for (const file of files) Logger.info('readdir file:', file)\n\n    await promises.access(file21_copy_name)\n    await promises.realpath(file21_copy_name)\n    await promises.link(file21_copy_name, file21_copy_link_name)\n    await promises.symlink(file21_copy_name, file21_copy_symlink_name)\n    await promises.readlink(file21_copy_symlink_name)\n    await promises.unlink(file21_copy_symlink_name)\n\n    await promises.truncate(file22_name, 2)\n\n    await promises.stat(file22_name)\n    await promises.lstat(file22_name)\n\n    await promises.utimes(file22_name, 1684339200, 1684339200)\n    await promises.lutimes(file23_name, 1684252800, 1684252800)\n\n    await promises.chmod(file22_name, '777')\n    await promises.lchmod(file23_name, '644')\n\n    await promises.chown(file22_name, 2, 1)\n    await promises.lchown(file23_name, 2, 1)\n\n    await promises.rmdir(dir3_name)\n    await promises.rm(dir1_name, { recursive: true })\n  } catch (error) {\n    Logger.error('ERROR: testFile callback:', error)\n  }\n\n  return {\n    body: {\n      code: 200,\n      data: 'ok',\n    },\n  }\n}\n"))),(0,r.kt)(l.default,{value:"1",label:"3.6.0+ ",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"import { makeDir, createFile, writeStrings, appendStrings, copy, rename, writeBytes, appendBytes, list, isExist, isDir, isFile, read, readLines, remove } from '@ones-op/node-file'\nimport { Logger } from '@ones-op/node-logger'\nimport { String2Unit8Array, Object2Unit8Array, Unit8Array2String } from '@ones-op/node-utils'\n\nexport async function TestFile() {\n  try {\n    await makeDir('./tmp/test')\n    await createFile('./tmp/test/test.txt')\n    await writeStrings('./tmp/test/test.txt', ['hello world!\\n'])\n    await appendStrings('./tmp/test/test.txt', ['hello world!'])\n    await copy('./tmp/test/test.txt', './tmp/test/test2.txt')\n    await copy('./tmp/test/test.txt', './tmp/test/test3.txt')\n    await rename('./tmp/test/test3.txt', './tmp/test/test4.txt')\n    await writeBytes('./tmp/test/test.txt', String2Unit8Array('hello bytes!\\n'))\n    await appendBytes('./tmp/test/test.txt', Object2Unit8Array({ name: 'hello bytes!' }))\n    Logger.info('======List', await list('./tmp/test'))\n    Logger.info('======isExist', await isExist('./tmp/test/test.txt'))\n    Logger.info('======isDir', await isDir('./tmp'))\n    Logger.info('======isDir', await isDir('./tmp/test'))\n    Logger.info('======isDir', await isDir('./tmp/test/test.txt'))\n    Logger.info('======isFile', await isFile('./tmp/test/test.txt'))\n    Logger.info('======read', Unit8Array2String((await read('./tmp/test/test.txt')) as Uint8Array))\n    const lines = await readLines('./tmp/test/test.txt', 0, 1)\n    Logger.info('======readLines', lines)\n    await remove('./tmp/test/test4.txt')\n    Logger.info('======List', await list('./tmp/test'))\n  } catch (error) {\n    Logger.error('ERROR: testFile callback:', error)\n  }\n\n  return {\n    body: {\n      code: 200,\n      data: 'ok',\n    },\n  }\n}\n")))),(0,r.kt)("h2",{id:"sdk"},"SDK"),(0,r.kt)(i.Z,{mdxType:"Tabs"},(0,r.kt)(l.default,{value:"2",label:"3.14.0+",mdxType:"TabItem"},(0,r.kt)("p",null,"Parameters reference\uff1a",(0,r.kt)("a",{parentName:"p",href:"/open-docs/docs/reference/packages/node-fs/"},"@ones-op/node-fs"))),(0,r.kt)(l.default,{value:"1",label:"3.6.0+ ",mdxType:"TabItem"},(0,r.kt)("p",null,"Parameters reference\uff1a",(0,r.kt)("a",{parentName:"p",href:"/open-docs/docs/reference/legacy-packages/node-file/"},"@ones-op/node-file")))))}f.isMDXComponent=!0}}]);