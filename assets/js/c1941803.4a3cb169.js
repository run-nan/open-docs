"use strict";(self.webpackChunkopen_docs=self.webpackChunkopen_docs||[]).push([[73932],{3905:(e,t,n)=>{n.d(t,{Zo:()=>l,kt:()=>h});var i=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=i.createContext({}),c=function(e){var t=i.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},l=function(e){var t=c(e.components);return i.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},d=i.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,p=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),d=c(n),h=r,m=d["".concat(p,".").concat(h)]||d[h]||u[h]||a;return n?i.createElement(m,o(o({ref:t},l),{},{components:n})):i.createElement(m,o({ref:t},l))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,o=new Array(a);o[0]=d;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var c=2;c<a;c++)o[c]=n[c];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}d.displayName="MDXCreateElement"},80580:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>c});var i=n(87462),r=(n(67294),n(3905));const a={sidebar_position:4},o="Item mutation",s={unversionedId:"abilities/business/ONES-API/item-mutation",id:"version-1.x/abilities/business/ONES-API/item-mutation",title:"Item mutation",description:"Requirements",source:"@site/versioned_docs/version-1.x/abilities/business/ONES-API/item-mutation.md",sourceDirName:"abilities/business/ONES-API",slug:"/abilities/business/ONES-API/item-mutation",permalink:"/open-docs/docs/abilities/business/ONES-API/item-mutation",draft:!1,tags:[],version:"1.x",lastUpdatedBy:"liupengfei",lastUpdatedAt:1690863366,formattedLastUpdatedAt:"Aug 1, 2023",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"abilities",previous:{title:"ONES API interception",permalink:"/open-docs/docs/abilities/business/ONES-API/ONES-API-interception"},next:{title:"Account",permalink:"/open-docs/docs/abilities/business/account/"}},p={},c=[{value:"Requirements",id:"requirements",level:2},{value:"Overview",id:"overview",level:2},{value:"Usage",id:"usage",level:2},{value:"checkManhour",id:"checkmanhour",level:3},{value:"Step 1: Add ability",id:"step-1-add-ability",level:4},{value:"Step 2: Write the handler function",id:"step-2-write-the-handler-function",level:4}],l={toc:c};function u(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,i.Z)({},l,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"item-mutation"},"Item mutation"),(0,r.kt)("h2",{id:"requirements"},"Requirements"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"ONES"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"v3.6.0+")))),(0,r.kt)("h2",{id:"overview"},"Overview"),(0,r.kt)("p",null,"Many data in the ONES support GraphQL operations. We can regard each ",(0,r.kt)("a",{parentName:"p",href:"https://graphql.org/learn/queries/"},"GraphQL Mutation")," as an event, and use the ",(0,r.kt)("strong",{parentName:"p"},"Mutation event interception")," ability to intercept these events and perform some additional Check or operate to expand new business logic. The ability will provide interception support for certain event types in advance, and the plugin can intercept the corresponding ",(0,r.kt)("inlineCode",{parentName:"p"},"GraphQL Mutation")," event by specifying the event type."),(0,r.kt)("p",null,"The event types that currently support interception are: ",(0,r.kt)("inlineCode",{parentName:"p"},"checkManhour")," (man-hour verification)"),(0,r.kt)("h2",{id:"usage"},"Usage"),(0,r.kt)("h3",{id:"checkmanhour"},"checkManhour"),(0,r.kt)("p",null,"Using the ability to intercept the ",(0,r.kt)("inlineCode",{parentName:"p"},"checkManhour")," event type, you can perform some verification logic on the man-hour operation. If the verification fails, the modification operation will report an error. Only after passing the verification can the operation be completed normally."),(0,r.kt)("p",null,"The following are the steps to add pre-verification for ",(0,r.kt)("strong",{parentName:"p"},"Add man-hour")," and ",(0,r.kt)("strong",{parentName:"p"},"Update man-hour"),". During the development process, developers can write business code according to actual needs, such as verifying that the added and updated man-hour must be integers, modifying the value range, and other scenarios."),(0,r.kt)("h4",{id:"step-1-add-ability"},"Step 1: Add ability"),(0,r.kt)("p",null,"Use ",(0,r.kt)("inlineCode",{parentName:"p"},"npx op add ability")," to add ",(0,r.kt)("inlineCode",{parentName:"p"},"item-mutation")," ability."),(0,r.kt)("p",null,"Example configuration:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="/config/plugin.yaml"',title:'"/config/plugin.yaml"'},"abilities:\n  - id: Ksmnf_Mc\n    name: Item mutation\n    version: 1.0.0\n    abilityType: item-mutation\n    function:\n      checkManhour: CheckManhourOp # checkManhour is the event type, CheckManhourOp is the processing function\n    config:\n      - key: prefix # interception position, prefix means pre-operation\n        value: check # Indicates that the check operation is to be performed\n        fieldType: Input\n      - key: operating # operating indicates interception events\n        value: addManhour,updateManhour # Indicates that the two events addManhour and updateManhour are to be intercepted\n        fieldType: Input\n")),(0,r.kt)("h4",{id:"step-2-write-the-handler-function"},"Step 2: Write the handler function"),(0,r.kt)("p",null,"Write the processing function ",(0,r.kt)("inlineCode",{parentName:"p"},"CheckManhourOp")," in the ",(0,r.kt)("inlineCode",{parentName:"p"},"backend/src/item-mutation.ts")," of the plugin project, which will be called when the event intercepted in the configuration occurs. The event type of ",(0,r.kt)("inlineCode",{parentName:"p"},"checkManhour")," will judge whether the inspection of this event is successful or not according to whether the returned status code is ",(0,r.kt)("strong",{parentName:"p"},"200"),"."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"CheckManhourOp")," function template looks like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="backend/src/item-mutation.ts"',title:'"backend/src/item-mutation.ts"'},"interface CheckManhourOpRequest {\n  Selections: {\n    args: {\n      start_time: number\n      type: string\n    }\n  }[]\n}\n// The man-hour verification logic can obtain the relevant information of this request from Selections\nexport async function CheckManhourOp(request: any) {\n  const body = request.body || {}\n  const { Selections } = body as CheckManhourOpRequest\n  Logger.info(JSON.stringify(Selections))\n  return {\n    body: {\n      code: 200,\n      ResponseModel: 'Plugin.RegistrableDays',\n      Reason: 'Success',\n      Type: null,\n      Body: null,\n    },\n  }\n}\n")))}u.isMDXComponent=!0}}]);