(self.webpackChunkopen_docs=self.webpackChunkopen_docs||[]).push([[69613],{87244:(e,t,i)=>{e.exports={src:{srcSet:i.p+"assets/ideal-img/simple-auth1.b9a89df.1024.png 1024w,"+i.p+"assets/ideal-img/simple-auth1.b97d7a2.2140.png 2140w",images:[{path:i.p+"assets/ideal-img/simple-auth1.b9a89df.1024.png",width:1024,height:451},{path:i.p+"assets/ideal-img/simple-auth1.b97d7a2.2140.png",width:2140,height:942}],src:i.p+"assets/ideal-img/simple-auth1.b9a89df.1024.png",toString:function(){return i.p+"assets/ideal-img/simple-auth1.b9a89df.1024.png"},placeholder:void 0,width:1024,height:451},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAECAYAAAC3OK7NAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAaElEQVQImV2NTQ5CIQwGuf/dvIRb40sQWtpSGMNz5yy/n0zpIswIwh13R9UQUcyMMYTahcfTKacMn2QuDjHzHtkYdDEyE1iUu/1j7U20Tm3K2r+snLf7UQcRceuHGZ/3xeuq1K60rnwBFAecVGpCNc8AAAAASUVORK5CYII="}},50829:(e,t,i)=>{e.exports={src:{srcSet:i.p+"assets/ideal-img/simple-auth2.f741f2f.223.png 223w",images:[{path:i.p+"assets/ideal-img/simple-auth2.f741f2f.223.png",width:223,height:22}],src:i.p+"assets/ideal-img/simple-auth2.f741f2f.223.png",toString:function(){return i.p+"assets/ideal-img/simple-auth2.f741f2f.223.png"},placeholder:void 0,width:223,height:22},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAABCAYAAADn9T9+AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAMklEQVQImWNQ0tT+r+7k9V/VyuG/up3rfw1Hz//ajh7/tXV0/6upqf5XVFT8Lysr+x8AOiMPfj893QkAAAAASUVORK5CYII="}},50925:(e,t,i)=>{e.exports={src:{srcSet:i.p+"assets/ideal-img/simple-auth3.c62b2a0.1024.png 1024w,"+i.p+"assets/ideal-img/simple-auth3.0de42d1.2022.png 2022w",images:[{path:i.p+"assets/ideal-img/simple-auth3.c62b2a0.1024.png",width:1024,height:358},{path:i.p+"assets/ideal-img/simple-auth3.0de42d1.2022.png",width:2022,height:706}],src:i.p+"assets/ideal-img/simple-auth3.c62b2a0.1024.png",toString:function(){return i.p+"assets/ideal-img/simple-auth3.c62b2a0.1024.png"},placeholder:void 0,width:1024,height:358},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAADCAYAAACqPZ51AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAUklEQVQImSWKyw3DMAzFvP9wWaID9JDq6WPZDNwQ4IkcZmJWUZlkJqbAJOSO/Mf3FtcnGHmmmqy1OdRsIhI/c7wNmvGvbPZ+PaxuZI6yyVpENQ8f/nV8EsC3TAAAAABJRU5ErkJggg=="}},3164:(e,t,i)=>{"use strict";i.r(t),i.d(t,{assets:()=>g,contentTitle:()=>h,default:()=>f,frontMatter:()=>m,metadata:()=>c,toc:()=>A});var n=i(87462),a=(i(67294),i(3905)),l=i(15944),s=i(87244),o=i.n(s),p=i(50829),u=i.n(p),r=i(50925),d=i.n(r);const m={sidebar_position:1},h="Simple auth",c={unversionedId:"abilities/business/account/simple-auth/simple-auth",id:"version-1.x/abilities/business/account/simple-auth/simple-auth",title:"Simple auth",description:"Requirements",source:"@site/versioned_docs/version-1.x/abilities/business/account/simple-auth/simple-auth.mdx",sourceDirName:"abilities/business/account/simple-auth",slug:"/abilities/business/account/simple-auth/",permalink:"/open-docs/docs/abilities/business/account/simple-auth/",draft:!1,tags:[],version:"1.x",lastUpdatedBy:"liupengfei",lastUpdatedAt:1690863366,formattedLastUpdatedAt:"Aug 1, 2023",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"abilities",previous:{title:"Account",permalink:"/open-docs/docs/abilities/business/account/"},next:{title:"Scene\uff1a Assign employees of the department to make a simple login",permalink:"/open-docs/docs/abilities/business/account/simple-auth/sample-simple-auth1"}},g={},A=[{value:"Requirements",id:"requirements",level:2},{value:"Overview",id:"overview",level:2},{value:"Usage",id:"usage",level:2},{value:"Step 1: Add and use ability through the OP tool",id:"step-1-add-and-use-ability-through-the-op-tool",level:3},{value:"Step 2: Implement your own simple login verification logic",id:"step-2-implement-your-own-simple-login-verification-logic",level:3},{value:"Step 3: Request a simple login API to log in to ONES",id:"step-3-request-a-simple-login-api-to-log-in-to-ones",level:3},{value:"Examples",id:"examples",level:2}],k={toc:A};function f(e){let{components:t,...i}=e;return(0,a.kt)("wrapper",(0,n.Z)({},k,i,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"simple-auth"},"Simple auth"),(0,a.kt)("h2",{id:"requirements"},"Requirements"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:"left"},"ONES"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"v3.6.0+")))),(0,a.kt)("h2",{id:"overview"},"Overview"),(0,a.kt)("p",null,"This ability allows each plugin developer to implement their own login verification logic, beyond the original ONES login verification logic, through their own login logic to log in to ONES."),(0,a.kt)("p",null,"Through this ability, users can request a dedicated API for simple login without an ONES password, and use their own logic to complete the login. We take the default simple login implementation as an example. You only need to provide the user's ",(0,a.kt)("inlineCode",{parentName:"p"},"user_uuid")," through the dedicated API for requesting simple login through postman, and you can log in successfully without providing an account number and password."),(0,a.kt)(l.Z,{img:o(),mdxType:"Image"}),(0,a.kt)("h2",{id:"usage"},"Usage"),(0,a.kt)("p",null,"Add this ability through the OP tool, and then implement your own login verification logic in the corresponding method of this ability. The default name of this method is ",(0,a.kt)("inlineCode",{parentName:"p"},"SimpleAuthValidate"),". Users can modify the method name in ",(0,a.kt)("inlineCode",{parentName:"p"},"config/plugin.yaml"),", as shown below."),(0,a.kt)("h3",{id:"step-1-add-and-use-ability-through-the-op-tool"},"Step 1: Add and use ability through the OP tool"),(0,a.kt)("p",null,"Use the Command Line to enter the OP command in the plugin root directory to add ability (this directive requires OP tool version 1.0 or above)"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"npx op add ability\n")),(0,a.kt)("p",null,"Select and add ",(0,a.kt)("inlineCode",{parentName:"p"},"simple-auth@1.0.0")),(0,a.kt)(l.Z,{img:u(),mdxType:"Image"}),(0,a.kt)("p",null,"The OP tool add the following to the plugin"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The OP tool adds abilitiy field related paragraphs in ",(0,a.kt)("inlineCode",{parentName:"li"},"config/plugin.yaml"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="config/plugin.yaml"',title:'"config/plugin.yaml"'},"  service:\n    app_id: ...\n    name: simple-auth\n    ...\n  apis:\n    ...\n  abilities:\n    - id: C5CWrHte\n      name: Simple-login\n      version: 1.0.0\n      abilityType: SimpleAuth\n      function:\n        validateFunc: SimpleAuthValidate\n")),(0,a.kt)("p",null,"In the ",(0,a.kt)("inlineCode",{parentName:"p"},"abilities")," field of the ",(0,a.kt)("inlineCode",{parentName:"p"},"config/plugin.yaml")," file, the value of ",(0,a.kt)("inlineCode",{parentName:"p"},"id")," can be customized, the value of ",(0,a.kt)("inlineCode",{parentName:"p"},"name")," can be customized, and the value of ",(0,a.kt)("inlineCode",{parentName:"p"},"function.validateFunc")," can be replaced with the name of your implementation method. Of course, you can keep it by default."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The OP tool adds files to the plugin in ",(0,a.kt)("inlineCode",{parentName:"li"},"backend/src/simple-auth.ts"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="backend/src/simple-auth.ts"',title:'"backend/src/simple-auth.ts"'},"import type { PluginRequest, PluginResponse } from '@ones-op/node-types'\n\n// Example Function\nexport async function SimpleAuthValidate(request: PluginRequest): Promise<PluginResponse> {\n  const { user_uuid } = request?.body as any\n  if (!user_uuid) {\n    return {\n      body: {\n        code: 400,\n        reason: 'user_uuid miss',\n      },\n    }\n  }\n  return {\n    body: {\n      code: 200,\n      data: {\n        uuid: user_uuid,\n      },\n    },\n  }\n}\n")),(0,a.kt)("h3",{id:"step-2-implement-your-own-simple-login-verification-logic"},"Step 2: Implement your own simple login verification logic"),(0,a.kt)("p",null,"When a user logs in with Simple Auth, ONES calls the ",(0,a.kt)("inlineCode",{parentName:"p"},"SimpleAuthValidate")," method in the plugin to process the login logic in the method. Plugin developers need to complete their own login verification logic and specify their own login rules in the ",(0,a.kt)("inlineCode",{parentName:"p"},"SimpleAuthValidate")," method."),(0,a.kt)("p",null,"Here, the rule we implement is that only ",(0,a.kt)("inlineCode",{parentName:"p"},"user_uuid")," starting with ",(0,a.kt)("inlineCode",{parentName:"p"},"W")," is allowed for simple login."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="backend/src/simple-auth.ts"',title:'"backend/src/simple-auth.ts"'},"import type { PluginRequest, PluginResponse } from '@ones-op/node-types'\n\n// Example function SimpleAuth\nexport async function SimpleAuthValidate(request: PluginRequest): Promise<PluginResponse> {\n  const { user_uuid } = request?.body as any\n  if (!user_uuid) {\n    return {\n      body: {\n        code: 400,\n        reason: 'user_uuid miss',\n      },\n    }\n  }\n  if (!user_uuid.startsWith('W')) {\n    return {\n      body: {\n        code: 401,\n        reason: 'this user_uuid doesnt have the authority to login in',\n      },\n    }\n  }\n  return {\n    body: {\n      code: 200,\n      data: {\n        uuid: user_uuid,\n      },\n    },\n  }\n}\n")),(0,a.kt)("h3",{id:"step-3-request-a-simple-login-api-to-log-in-to-ones"},"Step 3: Request a simple login API to log in to ONES"),(0,a.kt)("p",null,"Install and enable plugin,try different ",(0,a.kt)("inlineCode",{parentName:"p"},"user_uuid")," to verify the results."),(0,a.kt)("p",null,"The url of the simple login API is ",(0,a.kt)("inlineCode",{parentName:"p"},"{{ ONES IpAddress}}/project/api/project/ability/simple_auth_login"),", where {{ONES IpAddress}} is your ONES instance address."),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"Replace the corresponding parameters\uff08required for all places where ",(0,a.kt)("inlineCode",{parentName:"p"},"{{}}")," parentheses are used\uff09")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"#  The value of Ones-Plugin-Id is plugin's instance_uuid, which can be obtained by viewing the plugin log.\n#  Ones-Check-Id is the team_uuid where the request user_uuid is located.\n#  Ones-Plugin-AbilityId is the ability you declared in plugin.yaml.\ncurl --location --request POST '{{ ONES IpAddress}}/project/api/project/ability/simple_auth_login' \\\n--header 'Ones-Check-Point: team' \\\n--header 'Ones-Plugin-Id: {{instance_uuid}}' \\\n--header 'Ones-Check-Id: {{team_uuid}}' \\\n--header 'Ones-Plugin-AbilityId: {{ability_id}}' \\\n--header 'Content-Type: application/json' \\\n--data-raw '{\n   \"user_uuid\": {{user_uuid}}\n}'\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"uuid")," is ",(0,a.kt)("inlineCode",{parentName:"li"},"LxCJav69"),",returns the predetermined error value, and the result is as follows")),(0,a.kt)(l.Z,{img:d(),mdxType:"Image"}),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"uuid")," is ",(0,a.kt)("inlineCode",{parentName:"li"},"WArQASip"),",successfully make a simple login and get the returned token.")),(0,a.kt)(l.Z,{img:o(),mdxType:"Image"}),(0,a.kt)("h2",{id:"examples"},"Examples"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/open-docs/docs/abilities/business/account/simple-auth/sample-simple-auth1"},"Assign employees of the department to make a simple login"))))}f.isMDXComponent=!0}}]);