(self.webpackChunkopen_docs=self.webpackChunkopen_docs||[]).push([[96449],{51505:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/image01.4a11c69.1024.png 1024w,"+n.p+"assets/ideal-img/image01.4e84687.1653.png 1653w",images:[{path:n.p+"assets/ideal-img/image01.4a11c69.1024.png",width:1024,height:390},{path:n.p+"assets/ideal-img/image01.4e84687.1653.png",width:1653,height:629}],src:n.p+"assets/ideal-img/image01.4a11c69.1024.png",toString:function(){return n.p+"assets/ideal-img/image01.4a11c69.1024.png"},placeholder:void 0,width:1024,height:390},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAECAYAAAC3OK7NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAU0lEQVQImW3KOQ6AIBQAUe5/Ty2MoCyh+AtjpHOZZLoXSinUWum9I6q4D2AwxvOw7ZHjPGmtIaKYGe7+henIxJjIKeEqE72fcF0XcmmYKLjx1w0vJ/ac5O99EAAAAAAASUVORK5CYII="}},95187:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/image02.b5207b2.1024.png 1024w,"+n.p+"assets/ideal-img/image02.a67eb60.1705.png 1705w",images:[{path:n.p+"assets/ideal-img/image02.b5207b2.1024.png",width:1024,height:516},{path:n.p+"assets/ideal-img/image02.a67eb60.1705.png",width:1705,height:859}],src:n.p+"assets/ideal-img/image02.b5207b2.1024.png",toString:function(){return n.p+"assets/ideal-img/image02.b5207b2.1024.png"},placeholder:void 0,width:1024,height:516},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAjElEQVQImU2NSw6CMABEe2SXJiKRBsUETkUpVTbcxtLvM9SEOMms5mWeOJ1rxkkTYsZ+PjjnsNayRynFpaqQUiLqm2QaFcFHwraRc8Z7X0CtZ651Tdc9Ed3jznvWkBLBbcQYS/e8jClvwzAg2rZlWZYy7Frv3AEaY2iahr7vf+C6rmUIIZBS/FPrA/wCDrip4wq3TmQAAAAASUVORK5CYII="}},58104:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/image03.1f1c0c1.1024.png 1024w,"+n.p+"assets/ideal-img/image03.4d00512.1710.png 1710w",images:[{path:n.p+"assets/ideal-img/image03.1f1c0c1.1024.png",width:1024,height:518},{path:n.p+"assets/ideal-img/image03.4d00512.1710.png",width:1710,height:865}],src:n.p+"assets/ideal-img/image03.1f1c0c1.1024.png",toString:function(){return n.p+"assets/ideal-img/image03.1f1c0c1.1024.png"},placeholder:void 0,width:1024,height:518},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAlUlEQVQImT3MXQ6CMBhEUbbsm4mA4VcTWJTBWsS6G2ParxSuoRrnbTInk+z2OZfhSljBWouI4JxjyzAMHNKUqqpIsmPBfXrEYZ4967oi4mNX6kaW57SnM0nbNBhj4uBFCCEw+y8cR01ZlvR9T1LXDdM0IVZ4v154L4RliVBrTVEUdF23wZqnMQTxiHOE2SO/R6XUH34AFpypuaor+UEAAAAASUVORK5CYII="}},10255:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/image04.c892e1a.1024.png 1024w,"+n.p+"assets/ideal-img/image04.7fc03af.1642.png 1642w",images:[{path:n.p+"assets/ideal-img/image04.c892e1a.1024.png",width:1024,height:385},{path:n.p+"assets/ideal-img/image04.7fc03af.1642.png",width:1642,height:617}],src:n.p+"assets/ideal-img/image04.c892e1a.1024.png",toString:function(){return n.p+"assets/ideal-img/image04.c892e1a.1024.png"},placeholder:void 0,width:1024,height:385},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAECAYAAAC3OK7NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAVUlEQVQImWXNyw6AIBBDUf7/S30MggExjgzXyE5p0q5OUhdDIOVMKQW9b8wa0GjtWzctQoiRnBKqSq0VMxvhvHo28eyyUvXq6N8OvQjpOOmP9BnywgcfjJzpH6j58AAAAABJRU5ErkJggg=="}},22384:(e,t,n)=>{"use strict";n.r(t),n.d(t,{assets:()=>k,contentTitle:()=>f,default:()=>N,frontMatter:()=>c,metadata:()=>A,toc:()=>h});var a=n(87462),i=(n(67294),n(3905)),s=n(15944),r=n(51505),l=n.n(r),o=n(95187),m=n.n(o),u=n(58104),p=n.n(u),g=n(10255),d=n.n(g);const c={sidebar_position:14,description:"----"},f="Custom User Filter Rules",A={unversionedId:"abilities/business/user-list-filter/index",id:"abilities/business/user-list-filter/index",title:"Custom User Filter Rules",description:"----",source:"@site/docs/abilities/business/user-list-filter/index.mdx",sourceDirName:"abilities/business/user-list-filter",slug:"/abilities/business/user-list-filter/",permalink:"/docs/next/abilities/business/user-list-filter/",draft:!1,tags:[],version:"current",lastUpdatedBy:"liupengfei",lastUpdatedAt:1690791943,formattedLastUpdatedAt:"Jul 31, 2023",sidebarPosition:14,frontMatter:{sidebar_position:14,description:"----"},sidebar:"abilities",previous:{title:"Third import",permalink:"/docs/next/abilities/business/third-import/"},next:{title:"Custom Card",permalink:"/docs/next/abilities/business/custom-card/"}},k={},h=[{value:"Requirements",id:"requirements",level:2},{value:"Overview",id:"overview",level:2},{value:"Performance",id:"performance",level:3},{value:"Usage",id:"usage",level:2},{value:"Add Ability",id:"add-ability",level:3},{value:"Custom Filter Rules",id:"custom-filter-rules",level:3},{value:"User",id:"user",level:4},{value:"Example",id:"example",level:4},{value:"Q&amp;A",id:"qa",level:2}],b={toc:h};function N(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,a.Z)({},b,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"custom-user-filter-rules"},"Custom User Filter Rules"),(0,i.kt)("h2",{id:"requirements"},"Requirements"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"left"},"ONES"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"v3.13.35+")))),(0,i.kt)("h2",{id:"overview"},"Overview"),(0,i.kt)("p",null,"As a plugin developer, I want to be able to customize user rules so that searching or modifying user in work items associated with a project must fall within the scope of the plugin's custom user rules.\nWhen using this ability, the content that users can customize includes:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},'In the global configuration item "Optional Range of Work Item Member Attributes", add custom rule options.'),(0,i.kt)("li",{parentName:"ol"},'For project-managed work items, the user search function is controlled by the "Optional Range of Work Item Member Attributes".')),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Including: search for person in charge, search for solvers, search for followers, search for custom single-choice members, search for custom multi-choice members.")),(0,i.kt)("ol",{start:3},(0,i.kt)("li",{parentName:"ol"},'For project-managed work items, the user modification function is controlled by "Optional Range of Work Item Member Attributes".')),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Including: modifying the person in charge, modifying the solver, modifying followers, modifying custom single-selection members, modifying custom multi-selection members, modifying attributes in batches, and adding work items.")),(0,i.kt)("h3",{id:"performance"},"Performance"),(0,i.kt)("p",null,'When the plug-in of this capability is enabled, a custom rule option is added in the global configuration item "Optional Range of Work Item Member Attributes".'),(0,i.kt)(s.Z,{img:l(),mdxType:"Image"}),(0,i.kt)("p",null,'When "Custom Rule Options" is selected, the member search function in the project management work item is controlled by the optional range.'),(0,i.kt)(s.Z,{img:m(),mdxType:"Image"}),(0,i.kt)("p",null,'When "Customize Rule Options" is selected, the function of modifying members in work items of project management is controlled by the optional scope.'),(0,i.kt)(s.Z,{img:p(),mdxType:"Image"}),(0,i.kt)("p",null,'When the plug-in for this capability is deactivated, the previously added custom rule option will disappear in the global configuration item "Optional Range of Work Item Member Attributes".'),(0,i.kt)(s.Z,{img:d(),mdxType:"Image"}),(0,i.kt)("h2",{id:"usage"},"Usage"),(0,i.kt)("h3",{id:"add-ability"},"Add Ability"),(0,i.kt)("p",null,"Execute ",(0,i.kt)("inlineCode",{parentName:"p"},"npx op add ability")," , select ",(0,i.kt)("inlineCode",{parentName:"p"},"user-list-filter@1.0.0")," to add an ability"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"config/plugin.yaml")," has follow information:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"service:\n  app_id: Wr1aVwZS\n  ...\nmodules:[]\nabilities:\n  - id: saxkWEsg\n    name: Plugin Members\n    version: 1.0.0\n    abilityType: UserListFilter\n    scope: org\n    desc: plugin members which can filter all ones users.\n    function:\n      UserListFilterCallback: userListFilterTest\n    forOnesFunc: null\n    forPluginFunc: null\n    config:\n      - key: user_list_name\n        value: custom members\n        fieldType: Input\n        show: false\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"backend/src/user_list_filter.ts")," has follow information:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import { Logger } from '@ones-op/node-logger'\nimport type { PluginRequest, PluginResponse } from '@ones-op/node-types'\n\nexport const userListFilterTest = async (request: PluginRequest): Promise<PluginResponse> => {\n  Logger.info('[userListFilterTest] enter')\n  const body = request?.body as any\n  let users = body['users']\n  //Logger.info(\"[userListFilterTest] users:\", users.length)\n\n  if (users == undefined) {\n    Logger.info('[userListFilterTest] has no users')\n  } else if (users.length == 0) {\n    Logger.info('[userListFilterTest] users has no item')\n  } else {\n    Logger.info('[userListFilterTest] users[0]:', users[0])\n  }\n  //Init information\n  let data_result = new Array()\n\n  /**[start] custom user filter rules**/\n\n  /**[end] custom user filter rules**/\n\n  return {\n    body: {\n      code: 200,\n      body: {\n        state: 0,\n        message: 'success',\n        data: data_result,\n      },\n    },\n  }\n}\n")),(0,i.kt)("h3",{id:"custom-filter-rules"},"Custom Filter Rules"),(0,i.kt)("p",null,"In userListFilterTest function, add custom rule logic based on user information to filter out users who meet the rules."),(0,i.kt)("h4",{id:"user"},"User"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"left"},"parameter name"),(0,i.kt)("th",{parentName:"tr",align:"left"},"value type"),(0,i.kt)("th",{parentName:"tr",align:"left"},"Ranges"),(0,i.kt)("th",{parentName:"tr",align:"left"},"example"),(0,i.kt)("th",{parentName:"tr",align:"left"},"illustration"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"uuid"),(0,i.kt)("td",{parentName:"tr",align:"left"},"string"),(0,i.kt)("td",{parentName:"tr",align:"left"},"len=8"),(0,i.kt)("td",{parentName:"tr",align:"left"},"NbDQH9A9"),(0,i.kt)("td",{parentName:"tr",align:"left"},"user uuid")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"company"),(0,i.kt)("td",{parentName:"tr",align:"left"},"string"),(0,i.kt)("td",{parentName:"tr",align:"left"},"len<=128"),(0,i.kt)("td",{parentName:"tr",align:"left"},"ones"),(0,i.kt)("td",{parentName:"tr",align:"left"},"Company Name")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"email"),(0,i.kt)("td",{parentName:"tr",align:"left"},"string"),(0,i.kt)("td",{parentName:"tr",align:"left"},"len<=128"),(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("a",{parentName:"td",href:"mailto:Tom@ones.com"},"Tom@ones.com")),(0,i.kt)("td",{parentName:"tr",align:"left"},"user email")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"inviter_uuid"),(0,i.kt)("td",{parentName:"tr",align:"left"},"string"),(0,i.kt)("td",{parentName:"tr",align:"left"},"len=8"),(0,i.kt)("td",{parentName:"tr",align:"left"},"4i4S57VG"),(0,i.kt)("td",{parentName:"tr",align:"left"},"Inviter uuid")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"name"),(0,i.kt)("td",{parentName:"tr",align:"left"},"string"),(0,i.kt)("td",{parentName:"tr",align:"left"},"len<=64"),(0,i.kt)("td",{parentName:"tr",align:"left"},"Tom01"),(0,i.kt)("td",{parentName:"tr",align:"left"},"user name")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"phone"),(0,i.kt)("td",{parentName:"tr",align:"left"},"string"),(0,i.kt)("td",{parentName:"tr",align:"left"},"len<=32"),(0,i.kt)("td",{parentName:"tr",align:"left"},"15522778899"),(0,i.kt)("td",{parentName:"tr",align:"left"},"phone")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"status"),(0,i.kt)("td",{parentName:"tr",align:"left"},"string"),(0,i.kt)("td",{parentName:"tr",align:"left"},"len<=8"),(0,i.kt)("td",{parentName:"tr",align:"left"},"1"),(0,i.kt)("td",{parentName:"tr",align:"left"},"user status, 1:normal 2.deleted")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"team_uuid"),(0,i.kt)("td",{parentName:"tr",align:"left"},"string"),(0,i.kt)("td",{parentName:"tr",align:"left"},"len=8"),(0,i.kt)("td",{parentName:"tr",align:"left"},"9xHa5f8V"),(0,i.kt)("td",{parentName:"tr",align:"left"},"team uuid")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"title"),(0,i.kt)("td",{parentName:"tr",align:"left"},"string"),(0,i.kt)("td",{parentName:"tr",align:"left"},"len<=64"),(0,i.kt)("td",{parentName:"tr",align:"left"},"manager"),(0,i.kt)("td",{parentName:"tr",align:"left"},"user position")))),(0,i.kt)("h4",{id:"example"},"Example"),(0,i.kt)("p",null,'Add custom rules based on user email information. For example, to filter all users whose email suffix is "@ones.com".'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import { Logger } from '@ones-op/node-logger'\nimport type { PluginRequest, PluginResponse } from '@ones-op/node-types'\n\nexport const userListFilterTest = async (request: PluginRequest): Promise<PluginResponse> => {\n  Logger.info('[userListFilterTest] enter')\n  const body = request?.body as any\n  let users = body['users']\n  //Logger.info(\"[userListFilterTest] users:\", users.length)\n\n  if (users == undefined) {\n    Logger.info('[userListFilterTest] has no users')\n  } else if (users.length == 0) {\n    Logger.info('[userListFilterTest] users has no item')\n  } else {\n    Logger.info('[userListFilterTest] users[0]:', users[0])\n  }\n  //Init information\n  let data_result = new Array()\n\n  /**[start] custom user filter rules**/\n  if (users) {\n    let reqSuffix = /@ones.com$/\n    for (let idx in users) {\n      if (reqSuffix.test(users[idx]['email'])) {\n        data_result.push(users[idx]['uuid'] as string)\n      }\n    }\n  }\n  /**[end] custom user filter rules**/\n\n  return {\n    body: {\n      code: 200,\n      body: {\n        state: 0,\n        message: 'success',\n        data: data_result,\n      },\n    },\n  }\n}\n")),(0,i.kt)("h2",{id:"qa"},"Q&A"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"How can the custom user list name be multilingual?")),(0,i.kt)("p",null,"refer to ",(0,i.kt)("a",{parentName:"p",href:"/docs/next/guide/abilities/multilingual"},"Plug-in multilingual support")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"service:\n  app_id: Wr1aVwZS\n  ...\nabilities:\n  - id: saxkWEsg\n    name: Plugin Members\n    version: 1.0.0\n    abilityType: UserListFilter\n    scope: org\n    desc: plugin members which can filter all ones users.\n    function:\n      UserListFilterCallback: userListFilterTest\n    forOnesFunc: null\n    forPluginFunc: null\n    config:\n      - key: user_list_name\n        value: {{.UserListName}}\n        fieldType: Input\n        show: false\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"How to update custom user list option name?")),(0,i.kt)("p",null,"refer to ",(0,i.kt)("a",{parentName:"p",href:"/docs/next/guide/upgrade"},"upgrade the plug-in")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Modify ",(0,i.kt)("inlineCode",{parentName:"li"},"abilities.config.value")," first"),(0,i.kt)("li",{parentName:"ul"},"Modify the workspace ",(0,i.kt)("inlineCode",{parentName:"li"},"/lanuage/xx.yaml")," multilingual translation copy"),(0,i.kt)("li",{parentName:"ul"},"Upgrade the plugin")))}N.isMDXComponent=!0}}]);