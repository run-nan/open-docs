(self.webpackChunkopen_docs=self.webpackChunkopen_docs||[]).push([[4994],{47706:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/task-event-handle0.36dacaa.1024.png 1024w,"+n.p+"assets/ideal-img/task-event-handle0.ccc380b.1230.png 1230w",images:[{path:n.p+"assets/ideal-img/task-event-handle0.36dacaa.1024.png",width:1024,height:196},{path:n.p+"assets/ideal-img/task-event-handle0.ccc380b.1230.png",width:1230,height:235}],src:n.p+"assets/ideal-img/task-event-handle0.36dacaa.1024.png",toString:function(){return n.p+"assets/ideal-img/task-event-handle0.36dacaa.1024.png"},placeholder:void 0,width:1024,height:196},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAACCAYAAABhYU3QAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAS0lEQVQImQXBuw2AMAxAwew/D7ABtCxAhaBDQvIvjiked20/neNJ8r7QecGmCVk3PDoegbkjorTXComixiBFGaKEGNoLj6RnkePjB+dgS6Giqy7OAAAAAElFTkSuQmCC"}},84991:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/task-event-handle1.0e8c213.730.png 730w",images:[{path:n.p+"assets/ideal-img/task-event-handle1.0e8c213.730.png",width:730,height:852}],src:n.p+"assets/ideal-img/task-event-handle1.0e8c213.730.png",toString:function(){return n.p+"assets/ideal-img/task-event-handle1.0e8c213.730.png"},placeholder:void 0,width:730,height:852},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAMCAYAAABbayygAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAyklEQVQYlX2Q7U7DMAxF+/7Px8b4MWAIFbWCfmxp1zixD3KrokGBKJaT65PryAWAmXkiq3GqrjSXxKqvteIWVFP2pyfqrvkGmhnF7SsHD8873vv6f0dfYxiJUcg5o6qz9uW4Xjz6vmeaphlKKW1BFz1CCHN2XUS24NzKlN3jHXW7/FHSL6C7ZM0cXvdUXQW2aFvHtDiWbUk3dJgq5rTvn639PFzOSIwcyyMPL/d/tM6Zt4/AeYhcp5Ewhi3o4xBJlE2kDYLZMsMV/AQurNcdYTSV4QAAAABJRU5ErkJggg=="}},43839:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/task-event-handler2.041ad0d.1024.png 1024w,"+n.p+"assets/ideal-img/task-event-handler2.49aef96.1046.png 1046w",images:[{path:n.p+"assets/ideal-img/task-event-handler2.041ad0d.1024.png",width:1024,height:547},{path:n.p+"assets/ideal-img/task-event-handler2.49aef96.1046.png",width:1046,height:559}],src:n.p+"assets/ideal-img/task-event-handler2.041ad0d.1024.png",toString:function(){return n.p+"assets/ideal-img/task-event-handler2.041ad0d.1024.png"},placeholder:void 0,width:1024,height:547},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAdElEQVQImU1OSQoCQQzM/98jPkdPevCizrTd2UsSRKYghFBb6LUPTHawGFQVejnDridkBgoZgYgAPZ4fvLeFfUysxdDthhj3JkW0t3uAVAQZ3u4jSjDn6pbMBEkJM3uKNHO4e99HEDP/XWYGFm1h//cLqMQvEGfEHqaQnXMAAAAASUVORK5CYII="}},17942:(e,t,n)=>{"use strict";n.d(t,{Zo:()=>d,kt:()=>k});var a=n(50959);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o=a.createContext({}),p=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(o.Provider,{value:t},e.children)},m="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),m=p(n),u=r,k=m["".concat(o,".").concat(u)]||m[u]||g[u]||i;return n?a.createElement(k,l(l({ref:t},d),{},{components:n})):a.createElement(k,l({ref:t},d))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=u;var s={};for(var o in t)hasOwnProperty.call(t,o)&&(s[o]=t[o]);s.originalType=e,s[m]="string"==typeof e?e:r,l[1]=s;for(var p=2;p<i;p++)l[p]=n[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},78874:(e,t,n)=>{"use strict";n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>s,default:()=>c,frontMatter:()=>l,metadata:()=>o,toc:()=>d});var a=n(28957),r=(n(50959),n(17942)),i=n(49500);const l={sidebar_position:3,description:"Perform pre-processing, validation, and post-notification of events when the system generates updates to issue fields."},s="Intercept issue field modifications",o={unversionedId:"abilities/business/project/task-event-handler/task-event-handler",id:"abilities/business/project/task-event-handler/task-event-handler",title:"Intercept issue field modifications",description:"Perform pre-processing, validation, and post-notification of events when the system generates updates to issue fields.",source:"@site/docs/abilities/business/project/task-event-handler/task-event-handler.mdx",sourceDirName:"abilities/business/project/task-event-handler",slug:"/abilities/business/project/task-event-handler/",permalink:"/open-docs/docs/abilities/business/project/task-event-handler/",draft:!1,tags:[],version:"current",lastUpdatedBy:"liupengfei",lastUpdatedAt:1703495563,formattedLastUpdatedAt:"Dec 25, 2023",sidebarPosition:3,frontMatter:{sidebar_position:3,description:"Perform pre-processing, validation, and post-notification of events when the system generates updates to issue fields."},sidebar:"abilities",previous:{title:"Modify script properties",permalink:"/open-docs/docs/abilities/business/project/field/update-script-field/"},next:{title:"Intercept item actions",permalink:"/open-docs/docs/abilities/business/project/item-handler/"}},p={},d=[{value:"Requirements",id:"requirements",level:2},{value:"Overview",id:"overview",level:2},{value:"Scope of application",id:"scope",level:3},{value:"Trigger",id:"trigger",level:3},{value:"Performance",id:"performance",level:3},{value:"Usage",id:"usage",level:2},{value:"Step 1: Add configuration",id:"step-1-add-configuration",level:3},{value:"Step 2: Add pre-processing",id:"step-2-add-pre-processing",level:3},{value:"Step 3: Add post-processing",id:"step-3-add-post-processing",level:3},{value:"NOTICE",id:"notice",level:3}],m=(g="Image",function(e){return i.warn("Component "+g+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.kt)("div",e)});var g;const u={toc:d},k="wrapper";function c(e){let{components:t,...i}=e;return(0,r.kt)(k,(0,a.Z)({},u,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"intercept-issue-field-modifications"},"Intercept issue field modifications"),(0,r.kt)("h2",{id:"requirements"},"Requirements"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"ONES"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"v3.7.54+")))),(0,r.kt)("h2",{id:"overview"},"Overview"),(0,r.kt)("p",null,"When you want to do some processing and validation when issue field change, you can use the TaskEventHandle ability to achieve the requirement. This ability can pre-process, verify and post-proces the event when the system generates a issue update event. When the plugin that uses this ability is installed, the issue update event will be pre-process by the plugin before processing, and the plugin can ignore, reject, and modify this event according to requirements; after the event processing is completed, The plugin will receive a notification, and some post-process can be done at this time."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Applicable scene")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"A certain field or state of a issue has restrictions when changing, for example, it is not allowed to change the title of a issue of a requirement type."),(0,r.kt)("li",{parentName:"ol"},"Post operations are performed after issue field changes are complete. For example, after updating the person in charge of the issue of the requirement type, send an email to the corresponding person.")),(0,r.kt)("h3",{id:"scope"},"Scope of application"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Covered")),(0,r.kt)("p",{parentName:"li"},"Including changes in issue field, script-field, and status;"),(0,r.kt)("p",{parentName:"li"},"Including the UI operation and the events generated by directly calling the interface;")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Not covered")),(0,r.kt)("p",{parentName:"li"},"Operations that do not directly change attributes/states, such as commenting and uploading files, are not included;"),(0,r.kt)("p",{parentName:"li"},"Changes in calculated field such as number of stops, intervals, etc. are not included;"),(0,r.kt)("p",{parentName:"li"},"Changes triggered by post-actions are not included;"),(0,r.kt)("p",{parentName:"li"},"Does not include the processing of man-hour (man-hour are a separate ",(0,r.kt)("inlineCode",{parentName:"p"},"item")," type, and the corresponding similar abilitiy will be added in the follow-up ability);"),(0,r.kt)("p",{parentName:"li"},"Does not include state changes triggered by functions that modify state abnormally;"))),(0,r.kt)("h3",{id:"trigger"},"Trigger"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Issue details page for field or status modification"),(0,r.kt)("li",{parentName:"ul"},"Modify field field in batches"),(0,r.kt)("li",{parentName:"ul"},"Batch change issue type")),(0,r.kt)("h3",{id:"performance"},"Performance"),(0,r.kt)("p",null,"Using the issue processor ability configuration does not allow modification of the person in charge of the requirement, and an error is reported when modifying the person in charge of the requirement"),(0,r.kt)(m,{img:n(47706),mdxType:"Image"}),(0,r.kt)("h2",{id:"usage"},"Usage"),(0,r.kt)("p",null,"When ONES enables the plugin that uses the TaskEventHandle ability, the execution flow of issue field and state change events is shown in the following figure:"),(0,r.kt)(m,{img:n(84991),mdxType:"Image"}),(0,r.kt)("h3",{id:"step-1-add-configuration"},"Step 1: Add configuration"),(0,r.kt)("p",null,"Use ",(0,r.kt)("inlineCode",{parentName:"p"},"npx op add ability")," to add ",(0,r.kt)("inlineCode",{parentName:"p"},"task-event-handler")," ability. After adding, the ",(0,r.kt)("inlineCode",{parentName:"p"},"backend/src/task-event-handler.ts")," file will be added, and the following configurations will be added to the configuration file."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Developers only need to pay attention to two configurations of ",(0,r.kt)("strong",{parentName:"p"},"issue type")," and ",(0,r.kt)("strong",{parentName:"p"},"issue field"),". Multiple configurations of ",(0,r.kt)("strong",{parentName:"p"},"issue type")," and ",(0,r.kt)("strong",{parentName:"p"},"issue field")," are supported. Between multiple configurations Delimited by ",(0,r.kt)("strong",{parentName:"p"},'","')," .")),(0,r.kt)("p",null,"Example configuration: Indicates ",(0,r.kt)("strong",{parentName:"p"},"issue type")," that focus on ",(0,r.kt)("strong",{parentName:"p"},"requirement")," and ",(0,r.kt)("strong",{parentName:"p"},"defect")," , ",(0,r.kt)("strong",{parentName:"p"},"issue field")," that focus on ",(0,r.kt)("strong",{parentName:"p"},"Due date")," and ",(0,r.kt)("strong",{parentName:"p"},"assign")," change event."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="config/plugin.yaml"',title:'"config/plugin.yaml"'},"abilities:\n  - id: _ZcH89U9\n    name: TaskEventHandler\n    version: 1.0.0\n    abilityType: TaskEventHandler\n    function:\n      taskPreActionFunc: taskPreAction\n      taskActionDoneFunc: taskActionDone\n    config:\n      - key: issueTypeScope\n        value: 'Requirement,Bug'\n        fieldType: Input\n        label: IssueType\n        show: true\n      - key: field\n        value: 'Assignee,Due date,'\n        fieldType: Input\n        label: IssueField\n        show: true\n")),(0,r.kt)("h3",{id:"step-2-add-pre-processing"},"Step 2: Add pre-processing"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"backend/src/task-event-handler.ts")," file will automatically generate the ",(0,r.kt)("inlineCode",{parentName:"p"},"taskPreAction")," function, which is a pre-processing function. This function will be called before the event takes effect, and different strategies will be adopted according to the returned content\u3002"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Return")),(0,r.kt)("p",{parentName:"li"},"The structure of the content returned by the ",(0,r.kt)("inlineCode",{parentName:"p"},"taskPreAction")," function is as follows, and different strategies are adopted according to the values of the ",(0,r.kt)("inlineCode",{parentName:"p"},"is_follow"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"is_reject")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"task_events")," fields:"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Ignore: Set the returned ",(0,r.kt)("inlineCode",{parentName:"li"},"is_follow = false"),", indicating that the plugin does not do additional processing, and the update event is executed according to the normal process."),(0,r.kt)("li",{parentName:"ul"},"Reject: Set the returned ",(0,r.kt)("inlineCode",{parentName:"li"},"is_follow = true && is_reject = true"),", which means that the update event will not be executed and will end directly."),(0,r.kt)("li",{parentName:"ul"},"Accept: Set the returned ",(0,r.kt)("inlineCode",{parentName:"li"},"is_follow = true && is_reject = false"),", which means accepting the event, but not modifying the update content, and only notifying the plugin after the event is completed."),(0,r.kt)("li",{parentName:"ul"},"Modification: Set the returned ",(0,r.kt)("inlineCode",{parentName:"li"},"is_follow = true && is_reject = false")," and add field modification by returning the ",(0,r.kt)("inlineCode",{parentName:"li"},"task_events")," object to indicate acceptance of this event, modify the update content this time and notify the plugin after the event is completed.")))),(0,r.kt)("admonition",{title:"NOTICE",type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Even if there is no need to add new modifications in the plugin logic, the data in the original ",(0,r.kt)("inlineCode",{parentName:"p"},"task_events")," field needs to be returned, otherwise the change event may fail")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"type taskPreResponse = {\n  statusCode: number\n  body: {\n    code: number\n    body: {\n      is_follow: boolean\n      is_reject: boolean\n      reject_reason: string\n      task_events: any\n      other_data: string\n    }\n  }\n}\n")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Param"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Type"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Required"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"is_follow"),(0,r.kt)("td",{parentName:"tr",align:"left"},"string"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Y"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Express concern")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"is_reject"),(0,r.kt)("td",{parentName:"tr",align:"left"},"string"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Y"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Whether to refuse")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"reject_reason"),(0,r.kt)("td",{parentName:"tr",align:"left"},"string"),(0,r.kt)("td",{parentName:"tr",align:"left"},"N"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Reject reason")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"task_events"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("a",{parentName:"td",href:"#TaskEvent"},"[]TaskEvent")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Y"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Changed data (plugins can add changed field values)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"other_data"),(0,r.kt)("td",{parentName:"tr",align:"left"},"interface"),(0,r.kt)("td",{parentName:"tr",align:"left"},"N"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Other data (this data will be passed to the ",(0,r.kt)("inlineCode",{parentName:"td"},"taskActionDone")," method)")))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Params")),(0,r.kt)("p",{parentName:"li"},"Include the following content in the request body of the function input parameter:"),(0,r.kt)("table",{parentName:"li"},(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Param"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Required"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"user_uuid"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Y"),(0,r.kt)("td",{parentName:"tr",align:null},"User's ",(0,r.kt)("inlineCode",{parentName:"td"},"uuid"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"lang"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Y"),(0,r.kt)("td",{parentName:"tr",align:null},"Current user language")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"task_events"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"#TaskEvent"},"[]TaskEvent")),(0,r.kt)("td",{parentName:"tr",align:null},"Y"),(0,r.kt)("td",{parentName:"tr",align:null},"Changed data")))),(0,r.kt)("h4",{parentName:"li",id:"TaskEvent"},"TaskEvent"),(0,r.kt)("table",{parentName:"li"},(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Param"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Required"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"task_fields"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"#TaskEventField"},"[]TaskEventField")),(0,r.kt)("td",{parentName:"tr",align:null},"Y"),(0,r.kt)("td",{parentName:"tr",align:null},"Change field list")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"task_uuid"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Y"),(0,r.kt)("td",{parentName:"tr",align:null},"The ",(0,r.kt)("inlineCode",{parentName:"td"},"uuid")," of the issue")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"action"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Y"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"update"),": general field",(0,r.kt)("br",null),(0,r.kt)("inlineCode",{parentName:"td"},"transit"),": status change (with step field)",(0,r.kt)("br",null),(0,r.kt)("inlineCode",{parentName:"td"},"change_issue_type"),": issue type change",(0,r.kt)("br",null),(0,r.kt)("inlineCode",{parentName:"td"},"publish_version"),": version release",(0,r.kt)("br",null),(0,r.kt)("inlineCode",{parentName:"td"},"add "),": create a new issue")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"issue_type_scope_uuid"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Y"),(0,r.kt)("td",{parentName:"tr",align:null},"Issue type ",(0,r.kt)("inlineCode",{parentName:"td"},"UUID")," under the project to which it belongs")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"issue_type_scope_name"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Y"),(0,r.kt)("td",{parentName:"tr",align:null},"The name of the issue type under the project")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"issue_type_scope_name_map"),(0,r.kt)("td",{parentName:"tr",align:null},"map","[string]","string"),(0,r.kt)("td",{parentName:"tr",align:null},"Y"),(0,r.kt)("td",{parentName:"tr",align:null},"The name of ",(0,r.kt)("inlineCode",{parentName:"td"},"issue_type_scope")," in each language version")))),(0,r.kt)("h4",{parentName:"li",id:"TaskEventField"},"TaskEventField"),(0,r.kt)("table",{parentName:"li"},(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Param"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Type"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Required"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"field_uuid"),(0,r.kt)("td",{parentName:"tr",align:"left"},"string"),(0,r.kt)("td",{parentName:"tr",align:"left"},"N"),(0,r.kt)("td",{parentName:"tr",align:"left"},"The ",(0,r.kt)("inlineCode",{parentName:"td"},"uuid")," of the field")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"field_type"),(0,r.kt)("td",{parentName:"tr",align:"left"},"string"),(0,r.kt)("td",{parentName:"tr",align:"left"},"N"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Field type")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"field_name"),(0,r.kt)("td",{parentName:"tr",align:"left"},"string"),(0,r.kt)("td",{parentName:"tr",align:"left"},"N"),(0,r.kt)("td",{parentName:"tr",align:"left"},"The ",(0,r.kt)("inlineCode",{parentName:"td"},"key")," for the field name")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"field_name_map"),(0,r.kt)("td",{parentName:"tr",align:"left"},"map","[string]","string"),(0,r.kt)("td",{parentName:"tr",align:"left"},"N"),(0,r.kt)("td",{parentName:"tr",align:"left"},"The name of each language version of the field, such as: ",(0,r.kt)("br",null),"en: 'Assignee/Owner' ",(0,r.kt)("br",null),"origin: '{{field.assign}}' ",(0,r.kt)("br",null),"zh: '\u8d1f\u8d23\u4eba'")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"field_value_type"),(0,r.kt)("td",{parentName:"tr",align:"left"},"string"),(0,r.kt)("td",{parentName:"tr",align:"left"},"N"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Field value type:",(0,r.kt)("br",null),"0 - any",(0,r.kt)("br",null),"1 - int",(0,r.kt)("br",null),"2 - string",(0,r.kt)("br",null),"3 - []string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"value"),(0,r.kt)("td",{parentName:"tr",align:"left"},"interface"),(0,r.kt)("td",{parentName:"tr",align:"left"},"N"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Field value"))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Example")),(0,r.kt)("p",{parentName:"li"},"After modifying the field or state of a issue, the title of the issue will be modified synchronously."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="backend/src/task-event-handler.ts"',title:'"backend/src/task-event-handler.ts"'},"export async function taskPreAction(request: PluginRequest): Promise<PluginResponse> {\n  const body = request?.body as any\n  const userUUID = body.user_uuid\n  const lang = body.lang\n  const events = body.task_events\n  const action = events[0].action\n  Logger.info('nEvents', events)\n  Logger.info('userID:', userUUID)\n  Logger.info('lang', lang)\n  Logger.info('action', action)\n  // Add field modification\n  const aField = {\n    field_name: 'Title',\n    value: 'test title',\n  }\n  events[0].task_fields.push(aField)\n  return {\n    statusCode: 200,\n    body: {\n      code: 200,\n      body: {\n        is_follow: true,\n        is_reject: false,\n        reject_reason: '',\n        task_events: events,\n        other_data: 'other data',\n      },\n    },\n  }\n}\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Special note"),"\uff1aIf you want the page to pop a custom ",(0,r.kt)("inlineCode",{parentName:"p"},"warning toast"),",you can set it in the following ways"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="backend/src/task-event-handler.ts"',title:'"backend/src/task-event-handler.ts"'},"export async function taskPreAction(request: PluginRequest): Promise<PluginResponse> {\n  return {\n    body: {\n      code: 400,\n      reason: 'Test warning error',\n      type: 'warning',\n      model: 'plugin.xxx',\n    },\n  }\n}\n")),(0,r.kt)(m,{img:n(43839),mdxType:"Image"}),(0,r.kt)("h3",{id:"step-3-add-post-processing"},"Step 3: Add post-processing"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"taskActionDone")," function is automatically generated in the ",(0,r.kt)("inlineCode",{parentName:"p"},"backend/src/task-event-handler.ts")," file. This function is post-processing and will be called first after the event takes effect."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Params"),(0,r.kt)("table",{parentName:"li"},(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Param"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Type"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Required"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"user_uuid"),(0,r.kt)("td",{parentName:"tr",align:"left"},"string"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Y"),(0,r.kt)("td",{parentName:"tr",align:"left"},"User ",(0,r.kt)("inlineCode",{parentName:"td"},"uuid"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"lang"),(0,r.kt)("td",{parentName:"tr",align:"left"},"string"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Y"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Current user language")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"task_events"),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("a",{parentName:"td",href:"#TaskEvent"},"[]TaskEvent")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Y"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Changed data")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"other_data"),(0,r.kt)("td",{parentName:"tr",align:"left"},"interface"),(0,r.kt)("td",{parentName:"tr",align:"left"},"N"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Other data (this data will come from the ",(0,r.kt)("inlineCode",{parentName:"td"},"taskPreAction")," method)"))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Example")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="backend/src/task-event-handler.ts"',title:'"backend/src/task-event-handler.ts"'},"export async function taskActionDone(request: PluginRequest): Promise<PluginResponse> {\n  var body = request?.body as any\n  var events = body.task_events\n  var otherData = body.other_data\n  var userUUID = body.user_uuid\n  var lang = body.lang\n  var action = events[0].action\n  Logger.info('ans event', events)\n  Logger.info('ans other_data', otherData)\n  Logger.info('ans userID:', userUUID)\n  Logger.info('ans lang', lang)\n  Logger.info('ans action', action)\n\n  return {\n    statusCode: 200,\n    body: {\n      code: 200,\n    },\n  }\n}\n")))),(0,r.kt)("h3",{id:"notice"},"NOTICE"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"When ",(0,r.kt)("inlineCode",{parentName:"li"},"TaskEvent.action")," is ",(0,r.kt)("inlineCode",{parentName:"li"},"transit"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"publish_version"),", the plugin is not allowed to modify the state."),(0,r.kt)("li",{parentName:"ol"},"The processing logic of ",(0,r.kt)("inlineCode",{parentName:"li"},"taskPreAction")," is earlier than the required verification of the step field. If the plugin changes the value of the required item of the step field to an empty value, an error will be reported."),(0,r.kt)("li",{parentName:"ol"},"When ",(0,r.kt)("inlineCode",{parentName:"li"},"TaskEvent.action")," is ",(0,r.kt)("inlineCode",{parentName:"li"},"change_issue_type"),", the plugin is not allowed to modify the issue type and parent issue."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"TaskEvent")," does not support the deletion of a field change.")))}c.isMDXComponent=!0}}]);