(self.webpackChunkopen_docs=self.webpackChunkopen_docs||[]).push([[44934],{20135:(e,i,t)=>{e.exports={src:{srcSet:t.p+"assets/ideal-img/sample-script-field-float1.dccdb72.1024.png 1024w,"+t.p+"assets/ideal-img/sample-script-field-float1.8574a46.2098.png 2098w",images:[{path:t.p+"assets/ideal-img/sample-script-field-float1.dccdb72.1024.png",width:1024,height:662},{path:t.p+"assets/ideal-img/sample-script-field-float1.8574a46.2098.png",width:2098,height:1356}],src:t.p+"assets/ideal-img/sample-script-field-float1.dccdb72.1024.png",toString:function(){return t.p+"assets/ideal-img/sample-script-field-float1.dccdb72.1024.png"},placeholder:void 0,width:1024,height:662},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAYAAAD68A/GAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAhUlEQVQImU2OWw5DIQgF3f9G269Wry9AdBpNTHoSAoGBQ/ikh+9TiDFRSkZEmHPi7iffCClnniqU2shNqLXhPnCfmA3WBVsumApbc61zSWygZrTeGWOw1iLE15scI6qCqmIbsHlAFSG2THcj3OHW3txxaxEl9YGORTjdP+iC+6++rX0epx+3nutDfXiCvwAAAABJRU5ErkJggg=="}},1308:(e,i,t)=>{e.exports={src:{srcSet:t.p+"assets/ideal-img/sample-script-field-float2.00a1d6f.1024.png 1024w,"+t.p+"assets/ideal-img/sample-script-field-float2.584279a.2100.png 2100w",images:[{path:t.p+"assets/ideal-img/sample-script-field-float2.00a1d6f.1024.png",width:1024,height:534},{path:t.p+"assets/ideal-img/sample-script-field-float2.584279a.2100.png",width:2100,height:1096}],src:t.p+"assets/ideal-img/sample-script-field-float2.00a1d6f.1024.png",toString:function(){return t.p+"assets/ideal-img/sample-script-field-float2.00a1d6f.1024.png"},placeholder:void 0,width:1024,height:534},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAc0lEQVQImU2O2w7DMAhD8/9fuj1sLblxCcRTUnUqkh+OsDHpSxkHVRwnoZSC1hnuvhURf6UPVeTKqK1BRMAsezHnhJph3kbVC56zTB6BzowxxuYkqhjuG1byrlwszDh7AbshtfcLmum68vhtsZkhs0NG4AdjpMQlFtdtHwAAAABJRU5ErkJggg=="}},30008:(e,i,t)=>{"use strict";t.r(i),t.d(i,{assets:()=>f,contentTitle:()=>u,default:()=>g,frontMatter:()=>d,metadata:()=>c,toc:()=>m});var n=t(87462),s=(t(67294),t(3905)),a=t(15944),l=t(20135),o=t.n(l),p=t(1308),r=t.n(p);const d={},u="Scene: Automatically count the number of relationships of a certain link type of issue",c={unversionedId:"abilities/business/field/script-field-float/sample-script-field-float",id:"abilities/business/field/script-field-float/sample-script-field-float",title:"Scene: Automatically count the number of relationships of a certain link type of issue",description:"Scene description",source:"@site/docs/abilities/business/field/script-field-float/sample-script-field-float.mdx",sourceDirName:"abilities/business/field/script-field-float",slug:"/abilities/business/field/script-field-float/sample-script-field-float",permalink:"/open-docs/docs/next/abilities/business/field/script-field-float/sample-script-field-float",draft:!1,tags:[],version:"current",lastUpdatedBy:"liupengfei",lastUpdatedAt:1690862808,formattedLastUpdatedAt:"Aug 1, 2023",frontMatter:{},sidebar:"abilities",previous:{title:"Float",permalink:"/open-docs/docs/next/abilities/business/field/script-field-float/"},next:{title:"Issue",permalink:"/open-docs/docs/next/abilities/business/issue/"}},f={},m=[{value:"Scene description",id:"scene-description",level:2},{value:"Performance",id:"performance",level:2},{value:"Solution",id:"solution",level:2},{value:"Implementation idea",id:"implementation-idea",level:3},{value:"Plugin development",id:"plugin-development",level:3}],h={toc:m};function g(e){let{components:i,...t}=e;return(0,s.kt)("wrapper",(0,n.Z)({},h,t,{components:i,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"scene-automatically-count-the-number-of-relationships-of-a-certain-link-type-of-issue"},"Scene: Automatically count the number of relationships of a certain link type of issue"),(0,s.kt)("h2",{id:"scene-description"},"Scene description"),(0,s.kt)("p",null,'Users want to automatically count the number of issue related to the "link" of a issue and display it in the form of issue filed.'),(0,s.kt)("p",null,"The following figure shows that the issue has two link contents, and what the user needs is the number of the link type ",(0,s.kt)("inlineCode",{parentName:"p"},"Link"),"."),(0,s.kt)(a.Z,{img:o(),mdxType:"Image"}),(0,s.kt)("h2",{id:"performance"},"Performance"),(0,s.kt)("p",null,'Through the way of script filed, the number of issue whose link relationship is "Link" is automatically counted and displayed.'),(0,s.kt)(a.Z,{img:r(),mdxType:"Image"}),(0,s.kt)("h2",{id:"solution"},"Solution"),(0,s.kt)("h3",{id:"implementation-idea"},"Implementation idea"),(0,s.kt)("p",null,"Use ",(0,s.kt)("inlineCode",{parentName:"p"},"Plugin Script fields - Floating point number"),' ability.In the script filed calculation method, the uuid of a issue requests ONES to obtain the number of issue link relationship with its "Link". The assembly script filed calculation method returns parameters and returns, and you can enable the plugin to add the script filed to the issue.'),(0,s.kt)("h3",{id:"plugin-development"},"Plugin development"),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"Use OP tool to add ability ",(0,s.kt)("inlineCode",{parentName:"p"},"Plugin Script fields - Floating point number"),".")),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"Modify the configuration related to script filed in the plugin configuration file ",(0,s.kt)("inlineCode",{parentName:"p"},"plugin.yaml"),"."))),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="config/plugin.yaml"',title:'"config/plugin.yaml"'},"service: ...\napis: ...\nmodules: []\nabilities:\n  - name: scriptField\n    version: 1.0.0\n    abilityType: ScriptFieldFloat\n    function:\n      calcFieldValue: linkTime\n    config:\n      - key: FieldName\n        value: LinkTaskNumber\n        fieldType: Input\n        show: false\n    id: ...\n")),(0,s.kt)("ol",{start:3},(0,s.kt)("li",{parentName:"ol"},"In the script filed method ",(0,s.kt)("inlineCode",{parentName:"li"},"linkTime"),', use graphQL to query the number of "Link" issue in batches.')),(0,s.kt)("admonition",{type:"caution"},(0,s.kt)("p",{parentName:"admonition"},"In the case of batch uuid, we try to use graqhQL only once, otherwise a large number of network requests will be generated.")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"import { fetchONES } from '@ones-op/node-fetch'\nimport type { PluginRequest, PluginResponse } from '@ones-op/node-types'\n\nexport const linkTime = async (request: PluginRequest): Promise<PluginResponse> => {\n  const body = request?.body as any\n  const returnValue: any[] = []\n  if (body.fieldUUID && body.taskUUIDs && body.taskUUIDs.length > 0) {\n    const uuidArray: any = []\n    for (const taskUUID of body.taskUUIDs) {\n      uuidArray.push(taskUUID)\n    }\n    const jsonUuidArray = JSON.stringify(uuidArray)\n    const tempAbility = await fetchONES({\n      path: `/team/${globalThis.onesEnv.teamUUID}/items/graphql`,\n      method: 'POST',\n      body: {\n        query:\n          '{\\n    tasks(\\n        filter: {   \\n            uuid_in: ' +\n          jsonUuidArray +\n          ',\\n        }\\n    ){  \\n        uuid\\n        name\\n        linkTypeIduuid0001In{\\n            uuid\\n            name\\n        }\\n    }\\n}',\n        variables: {},\n      },\n      root: true,\n    })\n    //@ts-ignore\n    const linkData = tempAbility?.body?.data.tasks\n    for (let i = 0; i < linkData.length; i++) {\n      returnValue.push({\n        taskUUID: linkData[i]['uuid'].toString(),\n        value: linkData[i]['linkTypeIduuid0001In'].length * 100000, //The specific returned value can be counted according to the business logic.\n      })\n    }\n  }\n  return {\n    body: {\n      code: 200,\n      body: {\n        values: returnValue,\n      },\n    },\n  }\n}\n")),(0,s.kt)("ol",{start:4},(0,s.kt)("li",{parentName:"ol"},"After the plugin is developed, the plugin can be installed to create the script filed ",(0,s.kt)("inlineCode",{parentName:"li"},"LinkTaskNumber"),", which can be used by adding the script filed to issue type.")))}g.isMDXComponent=!0}}]);