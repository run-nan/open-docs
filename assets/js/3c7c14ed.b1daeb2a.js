"use strict";(self.webpackChunkopen_docs=self.webpackChunkopen_docs||[]).push([[18619],{3905:(t,e,n)=>{n.d(e,{Zo:()=>m,kt:()=>u});var a=n(67294);function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function i(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function p(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function l(t,e){if(null==t)return{};var n,a,r=function(t,e){if(null==t)return{};var n,a,r={},i=Object.keys(t);for(a=0;a<i.length;a++)n=i[a],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(a=0;a<i.length;a++)n=i[a],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}var o=a.createContext({}),s=function(t){var e=a.useContext(o),n=e;return t&&(n="function"==typeof t?t(e):p(p({},e),t)),n},m=function(t){var e=s(t.components);return a.createElement(o.Provider,{value:e},t.children)},d={inlineCode:"code",wrapper:function(t){var e=t.children;return a.createElement(a.Fragment,{},e)}},c=a.forwardRef((function(t,e){var n=t.components,r=t.mdxType,i=t.originalType,o=t.parentName,m=l(t,["components","mdxType","originalType","parentName"]),c=s(n),u=r,f=c["".concat(o,".").concat(u)]||c[u]||d[u]||i;return n?a.createElement(f,p(p({ref:e},m),{},{components:n})):a.createElement(f,p({ref:e},m))}));function u(t,e){var n=arguments,r=e&&e.mdxType;if("string"==typeof t||r){var i=n.length,p=new Array(i);p[0]=c;var l={};for(var o in e)hasOwnProperty.call(e,o)&&(l[o]=e[o]);l.originalType=t,l.mdxType="string"==typeof t?t:r,p[1]=l;for(var s=2;s<i;s++)p[s]=n[s];return a.createElement.apply(null,p)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},53034:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>o,contentTitle:()=>p,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>s});var a=n(87462),r=(n(67294),n(3905));const i={sidebar_position:13,description:"----"},p="Third import",l={unversionedId:"abilities/business/third-import/third-import",id:"version-1.x/abilities/business/third-import/third-import",title:"Third import",description:"----",source:"@site/versioned_docs/version-1.x/abilities/business/third-import/third-import.mdx",sourceDirName:"abilities/business/third-import",slug:"/abilities/business/third-import/",permalink:"/open-docs/docs/abilities/business/third-import/",draft:!1,tags:[],version:"1.x",lastUpdatedBy:"liupengfei",lastUpdatedAt:1690862808,formattedLastUpdatedAt:"Aug 1, 2023",sidebarPosition:13,frontMatter:{sidebar_position:13,description:"----"},sidebar:"abilities",previous:{title:"Scene: Statistics of Sprint working hours within a project",permalink:"/open-docs/docs/abilities/business/project-custom-component/sample-project-custom-component1"},next:{title:"Custom User Filter Rules",permalink:"/open-docs/docs/abilities/business/user-list-filter/"}},o={},s=[{value:"Requirements",id:"requirements",level:2},{value:"Overview",id:"overview",level:2},{value:"Usage",id:"usage",level:2},{value:"Implementation principle",id:"implementation-principle",level:3},{value:"Step 1: Installation dependency",id:"step-1-installation-dependency",level:3},{value:"Step 2: Add configuration",id:"step-2-add-configuration",level:3},{value:"Step 3: Start importing",id:"step-3-start-importing",level:3},{value:"Step 4: Implement the import function",id:"step-4-implement-the-import-function",level:3},{value:"Step 5: Implement the notification function",id:"step-5-implement-the-notification-function",level:3}],m={toc:s};function d(t){let{components:e,...n}=t;return(0,r.kt)("wrapper",(0,a.Z)({},m,n,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"third-import"},"Third import"),(0,r.kt)("h2",{id:"requirements"},"Requirements"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"ONES"),(0,r.kt)("th",{parentName:"tr",align:"left"},"@ones-op/node-third-import"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"v3.11.39+"),(0,r.kt)("td",{parentName:"tr",align:"left"},"v0.1.2+")))),(0,r.kt)("h2",{id:"overview"},"Overview"),(0,r.kt)("p",null,"Sometimes we need to import third data into ONES in batches. Due to the need to connect with different third parties, plugins are generally used to realize data conversion and import. The third import ability defines a set of data import specifications and processes, which simplifies the process of plugin importing data to ONES, and only needs to implement data conversion according to the specifications to complete the import."),(0,r.kt)("h2",{id:"usage"},"Usage"),(0,r.kt)("h3",{id:"implementation-principle"},"Implementation principle"),(0,r.kt)("p",null,"The entire data import process is started by the plugin calling ",(0,r.kt)("inlineCode",{parentName:"p"},"startImport"),", and then ONES starts to call the plugin method for different data types to obtain data. Each data type will be called multiple times until the plugin returns an empty array. When the import of all data types is complete or an error occurs during the import process, the plugin will be notified of the result of this import."),(0,r.kt)("mermaid",{value:"sequenceDiagram\nparticipant O as ONES\nparticipant P as Plugin\n     P->>O: startImport\n     loop traverses all data types\n       O--\x3e>+P: call ImportFunc\n       P--\x3e>O: return to imported data\n       O--\x3e>P: call ImportFunc\n       P--\x3e>-O: return [] means that this type of data has been returned\n     end\n     O--\x3e>+P: call notifyFunc\n     P--\x3e>-O: return"}),(0,r.kt)("h3",{id:"step-1-installation-dependency"},"Step 1: Installation dependency"),(0,r.kt)("p",null,"Enter the ",(0,r.kt)("inlineCode",{parentName:"p"},"/backend")," directory of the plugin project, and execute the following command for dependent installation:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"npm i @ones-op/node-third-import\n")),(0,r.kt)("h3",{id:"step-2-add-configuration"},"Step 2: Add configuration"),(0,r.kt)("p",null,"Use ",(0,r.kt)("inlineCode",{parentName:"p"},"npx op add ability")," to add ",(0,r.kt)("inlineCode",{parentName:"p"},"third-import@1.0.0")," type ability. Generate the ",(0,r.kt)("inlineCode",{parentName:"p"},"backend/src/third-import.ts")," file and add ability configuration in the plugin configuration file."),(0,r.kt)("p",null,"Example configuration:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="config/plugin.yaml"',title:'"config/plugin.yaml"'},"abilities:\n  - id: 5I-CjPX_\n    name: third-party import\n    version: 1.0.0\n    abilityType: ThirdImport\n    function:\n      importFunc: importFunc\n      notifyFunc: notifyFunc\n")),(0,r.kt)("h3",{id:"step-3-start-importing"},"Step 3: Start importing"),(0,r.kt)("p",null,"Call the ",(0,r.kt)("inlineCode",{parentName:"p"},"startImport")," method to start importing third data."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Entry:")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},(0,r.kt)("strong",{parentName:"th"},"Parameter")),(0,r.kt)("th",{parentName:"tr",align:"left"},(0,r.kt)("strong",{parentName:"th"},"Type")),(0,r.kt)("th",{parentName:"tr",align:"left"},(0,r.kt)("strong",{parentName:"th"},"Description")),(0,r.kt)("th",{parentName:"tr",align:"left"},(0,r.kt)("strong",{parentName:"th"},"Required")),(0,r.kt)("th",{parentName:"tr",align:"left"},(0,r.kt)("strong",{parentName:"th"},"Default Value")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"userUUID"),(0,r.kt)("td",{parentName:"tr",align:"left"},"string"),(0,r.kt)("td",{parentName:"tr",align:"left"},"user uuid"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Y"),(0,r.kt)("td",{parentName:"tr",align:"left"},"-")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"abilityId"),(0,r.kt)("td",{parentName:"tr",align:"left"},"string"),(0,r.kt)("td",{parentName:"tr",align:"left"},"ability id in plugin ability configuration"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Y"),(0,r.kt)("td",{parentName:"tr",align:"left"},"-")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"password"),(0,r.kt)("td",{parentName:"tr",align:"left"},"string"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Import user's default password when logging in for the first time (the default password needs to be alphanumeric)"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Y"),(0,r.kt)("td",{parentName:"tr",align:"left"},"-")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"serverId"),(0,r.kt)("td",{parentName:"tr",align:"left"},"string"),(0,r.kt)("td",{parentName:"tr",align:"left"},"If you import the same batch of data, you need to ensure the same ",(0,r.kt)("inlineCode",{parentName:"td"},"server_id")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Y"),(0,r.kt)("td",{parentName:"tr",align:"left"},"-")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"teamUUID"),(0,r.kt)("td",{parentName:"tr",align:"left"},"string"),(0,r.kt)("td",{parentName:"tr",align:"left"},"The unique ID of the team, only required for organization plugins"),(0,r.kt)("td",{parentName:"tr",align:"left"},"N"),(0,r.kt)("td",{parentName:"tr",align:"left"},"-")))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Example:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { startImport } from '@ones-op/node-third-import'\n\nawait startImport(user_uuid, abilityId, password, server_id, teamUUID)\n")),(0,r.kt)("h3",{id:"step-4-implement-the-import-function"},"Step 4: Implement the import function"),(0,r.kt)("p",null,"When the plugin calls ",(0,r.kt)("inlineCode",{parentName:"p"},"startImport")," to start the import, the system will automatically start the import process. After the import process starts, ",(0,r.kt)("inlineCode",{parentName:"p"},"importFunc")," will be called multiple times to obtain the imported data. Each time the function is called, ",(0,r.kt)("inlineCode",{parentName:"p"},"importFunc")," will be passed in to indicate the data type imported by this call, and the plugin can return the corresponding data according to this field. When there is no data of this type to be imported, an empty array [] can be returned, and the next data type will be imported until all types are imported."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"The definitions of all imported data types can be found in ",(0,r.kt)("a",{parentName:"p",href:"/open-docs/docs/reference/packages/node-third-import/"},"@ones-op/node-third-import")," content.")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Entry:")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},(0,r.kt)("strong",{parentName:"th"},"Parameter")),(0,r.kt)("th",{parentName:"tr",align:"left"},(0,r.kt)("strong",{parentName:"th"},"Type")),(0,r.kt)("th",{parentName:"tr",align:"left"},(0,r.kt)("strong",{parentName:"th"},"Description")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"import_type"),(0,r.kt)("td",{parentName:"tr",align:"left"},"string"),(0,r.kt)("td",{parentName:"tr",align:"left"},"The data type of this import")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"pre_data"),(0,r.kt)("td",{parentName:"tr",align:"left"},"any"),(0,r.kt)("td",{parentName:"tr",align:"left"},"the last data imported last time for this type")))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Example:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import type { ThirdUser } from '@ones-op/node-third-import'\n\nexport async function importFunc(request: PluginRequest): Promise<PluginResponse> {\n  const { import_type } = request?.body as any\n  const data: any[] = []\n\n  if (import_type === 'ThirdUser') {\n    const user: ThirdUser = {\n      resource_id: 'xxxx',\n      name: 'hosea',\n      email: 'xiaoming@ones.com',\n      phone: '18888888888',\n      title: 'xxx',\n      company: 'ONES',\n      status: 10,\n      create_time: 1665310367819,\n      modify_time: 1665310367819,\n    }\n\n    data.push(user)\n  }\n\n  return {\n    body: {\n      code: 200,\n      body: data,\n    },\n  }\n}\n")),(0,r.kt)("h3",{id:"step-5-implement-the-notification-function"},"Step 5: Implement the notification function"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"notifyFunc")," function will be automatically generated in ",(0,r.kt)("inlineCode",{parentName:"p"},"backend/src/third-import.ts"),". After the import process is completed, this function will be called and the result of this data import will be returned. According to whether the import is successful, the corresponding content will be returned in ",(0,r.kt)("inlineCode",{parentName:"p"},"body")," in the input parameter of the function."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Imported successfully"),(0,r.kt)("table",{parentName:"li"},(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Param"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Type"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"is_success"),(0,r.kt)("td",{parentName:"tr",align:"left"},"bool"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Whether it is successful"))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"import failed"),(0,r.kt)("table",{parentName:"li"},(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"parameter"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Type"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"process_name"),(0,r.kt)("td",{parentName:"tr",align:"left"},"string"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Indicates the failed link")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"error_msg"),(0,r.kt)("td",{parentName:"tr",align:"left"},"string"),(0,r.kt)("td",{parentName:"tr",align:"left"},"error message")))))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Example:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"export async function notifyFunc(request: PluginRequest): Promise<PluginResponse> {\n  Logger.info('receive notify', JSON.stringify(request?.body))\n\n  return {\n    body: {\n      code: 200,\n      body: {},\n    },\n  }\n}\n")))}d.isMDXComponent=!0}}]);