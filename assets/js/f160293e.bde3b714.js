(self.webpackChunkopen_docs=self.webpackChunkopen_docs||[]).push([[61869],{39681:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/account1.3ecdb82.473.png 473w",images:[{path:n.p+"assets/ideal-img/account1.3ecdb82.473.png",width:473,height:536}],src:n.p+"assets/ideal-img/account1.3ecdb82.473.png",toString:function(){return n.p+"assets/ideal-img/account1.3ecdb82.473.png"},placeholder:void 0,width:473,height:536},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAALCAYAAABGbhwYAAAACXBIWXMAAAsTAAALEwEAmpwYAAABFklEQVQYlU2QyU4DMRBE50ORuOaA+BIOiBPbR3DkAEECsQgRCcQSxAWJLCiQZDxOmBnbbT9kT0hoqbxVdVe7M2MFJ4KaC8ednJfXN27vOjw9d7HOE/mIzDohIl563zVKz8lVwWSS48QnLiIT8aQIIW1VVWGMWTyFuOKiMNpaYwi+SSiKgtls9k/ISqi1pixLyqrCWpdIEVkiapJ17EmpAmMcxljKWvhSlpGyqLnDe//XY6wS+4po7FbRfCiL6q2jMes7A1q7QzYPhmzsD2ntfbK23efwJE/JqeL9e0X7QdO+7HNx0+P86oOz6wGnjz90ezWEZC0LCwNOI94RxEA9XZov5+gDOOsIaooaTdCjcTq7AN43c/wFgVGjCE/ge+oAAAAASUVORK5CYII="}},37162:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/account2.40e94c6.479.png 479w",images:[{path:n.p+"assets/ideal-img/account2.40e94c6.479.png",width:479,height:264}],src:n.p+"assets/ideal-img/account2.40e94c6.479.png",toString:function(){return n.p+"assets/ideal-img/account2.40e94c6.479.png"},placeholder:void 0,width:479,height:264},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAhUlEQVQImT2O0Q6DMAwD+f/vHGhbS2kSSkuDuAm0zZLltzsPtVZUMnXb7poqaZ6JIeDu/DK0fhDMeakTV+dtzpQ71g7cOyLKBRtSOZhSYQzCGJQpKnERUlbMDBFBVS+iU1qn1B3bdtbav7Lzrz3Pk6GUguTMYvXe1holC8tjYnuOeIr3xw9QJMEpzISXhAAAAABJRU5ErkJggg=="}},52207:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/account3.347f1be.983.png 983w",images:[{path:n.p+"assets/ideal-img/account3.347f1be.983.png",width:983,height:368}],src:n.p+"assets/ideal-img/account3.347f1be.983.png",toString:function(){return n.p+"assets/ideal-img/account3.347f1be.983.png"},placeholder:void 0,width:983,height:368},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAECAYAAAC3OK7NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAbElEQVQImVWMQRLCIBAE+f8vvWjFkLABkWXX0CpVHuzr9HSotaKtIblyuW2ovXAzjnyQS8HdGWMQljUiIjy1s2wZM5tjXCOPJHRVeu+E630n7oKq0prO2nmeuHW81lmbRUmJUvJ8/fiKf3zEN5H6m515ygJNAAAAAElFTkSuQmCC"}},18103:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/account4.6dec46b.119.png 119w",images:[{path:n.p+"assets/ideal-img/account4.6dec46b.119.png",width:119,height:18}],src:n.p+"assets/ideal-img/account4.6dec46b.119.png",toString:function(){return n.p+"assets/ideal-img/account4.6dec46b.119.png"},placeholder:void 0,width:119,height:18},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAACCAYAAABhYU3QAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAUklEQVQImR3KSw5AMBRAUQtpXxGkYUCTIiEV/wlh/6u5EoMzO5HYCt20SO1/ug9o12MaTz7MqKxAlCIS15HuD8lyYaaT9HiJ1xszbkg4SWz5xw/IvB7KcRTpEQAAAABJRU5ErkJggg=="}},3139:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/account5.fef9bcf.648.png 648w",images:[{path:n.p+"assets/ideal-img/account5.fef9bcf.648.png",width:648,height:617}],src:n.p+"assets/ideal-img/account5.fef9bcf.648.png",toString:function(){return n.p+"assets/ideal-img/account5.fef9bcf.648.png"},placeholder:void 0,width:648,height:617},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAJCAYAAAALpr0TAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAmElEQVQYlYXQ3QrCMAwF4L7/QwpeOGQT+5OuSdrUIxYZkylenIskXwjE3SNhnheICMwMrbVDVBWOiiHGhFoVtdaPtD1kNXgfRvELighcXgtyztvmNzygrBlECfUfDMRIlA/gAGNpiIlQVUdzj3rv4xPCDCdcELxHKWUMX+f1Dce7XlAU7ny64DZN4GVGNxvDLf2BFgP4OuEJd3RfXGDJ3OkAAAAASUVORK5CYII="}},92637:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/account6.56e6147.1024.png 1024w,"+n.p+"assets/ideal-img/account6.c81fada.1229.png 1229w",images:[{path:n.p+"assets/ideal-img/account6.56e6147.1024.png",width:1024,height:523},{path:n.p+"assets/ideal-img/account6.c81fada.1229.png",width:1229,height:628}],src:n.p+"assets/ideal-img/account6.56e6147.1024.png",toString:function(){return n.p+"assets/ideal-img/account6.56e6147.1024.png"},placeholder:void 0,width:1024,height:523},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAdElEQVQImVXNWxLCIAxAUfa/UW0JrSBQ3tehWh0zc/5uEuW9J8aI8wEfIq13xjTGqfd+UiKCtZYQAqUUckq01s6o1vql7rKziXDohWw03Vn4XJuuUVoMbjOE5cahV/Du/ZrZ/xbUqjVPZ0nGUB47I6e/4ApfDK3DDgWr0xwAAAAASUVORK5CYII="}},74721:(e,t,n)=>{"use strict";n.r(t),n.d(t,{assets:()=>b,contentTitle:()=>k,default:()=>E,frontMatter:()=>f,metadata:()=>w,toc:()=>S});var i=n(87462),a=(n(67294),n(3905)),s=n(15944),o=n(39681),r=n.n(o),l=n(37162),p=n.n(l),h=n(52207),d=n.n(h),c=n(18103),m=n.n(c),g=n(3139),u=n.n(g),A=n(92637),y=n.n(A);const f={sidebar_position:2},k="Synchronize with third-party system",w={unversionedId:"abilities/business/account/synchronize-with-third-party-system/synchronize-with-third-party-system",id:"abilities/business/account/synchronize-with-third-party-system/synchronize-with-third-party-system",title:"Synchronize with third-party system",description:"Requirements",source:"@site/docs/abilities/business/account/synchronize-with-third-party-system/synchronize-with-third-party-system.mdx",sourceDirName:"abilities/business/account/synchronize-with-third-party-system",slug:"/abilities/business/account/synchronize-with-third-party-system/",permalink:"/open-docs/docs/next/abilities/business/account/synchronize-with-third-party-system/",draft:!1,tags:[],version:"current",lastUpdatedBy:"liupengfei",lastUpdatedAt:1690862808,formattedLastUpdatedAt:"Aug 1, 2023",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"abilities",previous:{title:"Scene\uff1a Assign employees of the department to make a simple login",permalink:"/open-docs/docs/next/abilities/business/account/simple-auth/sample-simple-auth1"},next:{title:"Scene\uff1aONES integrate with Ding Talk system",permalink:"/open-docs/docs/next/abilities/business/account/synchronize-with-third-party-system/sample-synchronize-with-third-party-system1"}},b={},S=[{value:"Requirements",id:"requirements",level:2},{value:"Overview",id:"overview",level:2},{value:"Usage",id:"usage",level:2},{value:"Step 1: Add ability through the OP tool\uff1a",id:"step-1-add-ability-through-the-op-tool",level:3},{value:"Step 2: Realizing the correspondence method of each ability point",id:"step-2-realizing-the-correspondence-method-of-each-ability-point",level:3},{value:"Implement third-party login",id:"implement-third-party-login",level:4},{value:"Achieve organizational personnel synchronization",id:"achieve-organizational-personnel-synchronization",level:4},{value:"Implement message push",id:"implement-message-push",level:4},{value:"Step 3: Do the following in ONES to interface with third-party systems.",id:"step-3-do-the-following-in-ones-to-interface-with-third-party-systems",level:3},{value:"Examples",id:"examples",level:2}],N={toc:S};function E(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,i.Z)({},N,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"synchronize-with-third-party-system"},"Synchronize with third-party system"),(0,a.kt)("h2",{id:"requirements"},"Requirements"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:"left"},"ONES"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"v3.6.0+")))),(0,a.kt)("h2",{id:"overview"},"Overview"),(0,a.kt)("p",null,"This ability allows plugin to integrate a third-party system (including Google, Ding Talk, or other third-party systems). Plugin developers can implement one or more of the following functions according to their own needs:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Third party login\uff1aUsers can login to ONES by logging in to a third-party system."),(0,a.kt)("li",{parentName:"ol"},"Message push\uff1aMessage notifications for ONES can be sent to third-party systems."),(0,a.kt)("li",{parentName:"ol"},"Organizational personnel synchronization\uff1aSynchronize the department information and personnel information of the third-party system to ONES.")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Third party login"))),(0,a.kt)("p",null,"Under the original login page, there is a new login\nway. Click this icon to log in to ONES through a third-party system."),(0,a.kt)(s.Z,{img:r(),mdxType:"Image"}),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Message push"))),(0,a.kt)("p",null,"After installing the plugin that implements this ability, you can choose whether or not to push the message to the third-party system under each notification mode."),(0,a.kt)("p",null,"Take `Issue Notification' as an example, add the name of the plugin in the notification option, and select it to notify the third-party system"),(0,a.kt)(s.Z,{img:p(),mdxType:"Image"}),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Organizational personnel synchronization"))),(0,a.kt)("p",null,"In ",(0,a.kt)("inlineCode",{parentName:"p"},"Configuration -> User management -> member")," , you can see the users synchronized to ONES by the third-party system and indicate the plugins from which it synchronizes."),(0,a.kt)(s.Z,{img:d(),mdxType:"Image"}),(0,a.kt)("h2",{id:"usage"},"Usage"),(0,a.kt)("p",null,"Add this ability through the OP tool, then implement the corresponding method of each ability point, finally install and enable plugin, and integrate the third-party system in ONES."),(0,a.kt)("h3",{id:"step-1-add-ability-through-the-op-tool"},"Step 1: Add ability through the OP tool\uff1a"),(0,a.kt)("p",null,"Use the Command Line to enter the OP command in the plugin root directory to add ability (this directive requires OP tool version 1.0 or above)"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"npx op add ability\n")),(0,a.kt)("p",null,"Select and add ",(0,a.kt)("inlineCode",{parentName:"p"},"account@1.0.0")),(0,a.kt)(s.Z,{img:m(),mdxType:"Image"}),(0,a.kt)("p",null,"The OP tool add the following to the plugin"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Add related paragraphs to the abilities field in ",(0,a.kt)("inlineCode",{parentName:"li"},"{{plugin root directory}}/config/plugin.yaml"),".")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="config/plugin.yaml"',title:'"config/plugin.yaml"'},"    service:\n    ...\n    ...\n    abilities:\n    - id: ...\n        name: account\n        version: 1.0.0\n        abilityType: account\n        function:\n         sendMessage: SendMessage\n         createLoginUrl: CreateLoginUrl # create redirect login URL\n         doExchangeUser: DoExchangeUser # obtain login user information\n         doPullData: DoPullData # synchronize third-party system user data\n        config:\n        # whether the login function is realized\n        - key: canLogin\n            value: true\n            show: false\n        # whether the synchronization function is realized\n        - key: canSync\n            value: true\n            show: false\n        # whether the function of sending messages is realized\n        - key: canMessage\n            value: true\n            show: false\n        # the logo address of the third party login, which is the name of the file, which is required to be placed in the root directory of the front-end resource, web/dist/\n        - key: logo\n            value: logo.svg\n            show: false\n        # third party login name\n        - key: title\n            value: title\n            show: false\n        # third party description\n        - key: desc\n            value: desc\n            show: false\n        # third party description\n        - key: detailTip\n            value: detailTip\n            show: false\n        # third party configuration reminder\n        - key: configTip\n            value: configTip\n            show: false\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The OP tool adds files to the plugin in ",(0,a.kt)("inlineCode",{parentName:"li"},"backend/src/account.ts"))),(0,a.kt)("h3",{id:"step-2-realizing-the-correspondence-method-of-each-ability-point"},"Step 2: Realizing the correspondence method of each ability point"),(0,a.kt)("h4",{id:"implement-third-party-login"},"Implement third-party login"),(0,a.kt)("p",null,"To implement the third-party login ONES feature, you only need to implement the ",(0,a.kt)("inlineCode",{parentName:"p"},"CreateLoginUrl")," method.If you want to synchronize the user information (including name, email, etc.) of the third-party system to ONES and automatically create an ONES account, you also need to complete the ",(0,a.kt)("inlineCode",{parentName:"p"},"DoExchangeUser")," method."),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"CreateLoginUrl")," needs to return the url called when the third-party system logs in. The request of this method contains the URL redirected to ONES, which can be stitched into the respUrl to be returned by plugin developers."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"//Fill in the url with the url that is called when the third party system logs in\nexport async function CreateLoginUrl(request: PluginRequest): Promise<PluginResponse> {\n  //After calling the third party login, the returned information will be redirected to that address, and sometimes it is necessary to use this address to concatenate the respUrl\n  //@ts-ignore\n  const redirectUrl: string = request?.body.redirect_url\n  const response: CreateLoginUrlResponse = {\n    url: '',\n  }\n  return CreateLoginUrlRespData(200, '200', '', '', '', response)\n}\n")),(0,a.kt)("p",null,"In the ",(0,a.kt)("inlineCode",{parentName:"p"},"DoExchangeUser")," method, the plugin developer needs to return the user's information data so that the user's account is created and the information is synchronized in ONES. In the request of this method, there is key ",(0,a.kt)("inlineCode",{parentName:"p"},"code")," information, through which plugin developers can go to a third-party system to obtain user information, and then return user information in the ",(0,a.kt)("inlineCode",{parentName:"p"},"DoExchangeUser")," method."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"export async function DoExchangeUser(request: PluginRequest): Promise<PluginResponse> {\n  let code1 = ''\n  if (typeof request?.body == 'object' && !Array.isArray(request?.body)) {\n    const authInfo = request.body.auth_info\n    const obj = JSON.parse(authInfo)\n    //Get the code after login, and use the code to go to the third party system to obtain user information.\n    code1 = obj.code\n  }\n  //The format of the returned information resp\n  const resp: DoExchangeUserResponse = {\n    third_party_id: '',\n    name: '',\n    title: '',\n    avatar: '',\n    email: '',\n    phone: '',\n  }\n  //Get user information and combine data into resp by calling third-party API\n  return DoExchangeUserRespData(200, '', '', '', '', resp)\n}\n")),(0,a.kt)("h4",{id:"achieve-organizational-personnel-synchronization"},"Achieve organizational personnel synchronization"),(0,a.kt)("p",null,"To achieve the function of synchronizing third-party organizational personnel to ONES, you only need to implement the ",(0,a.kt)("inlineCode",{parentName:"p"},"DoPullData")," method. Plugin developers need to return the information of third-party departments and personnel in this method, so as to synchronize departments and personnel in ONES."),(0,a.kt)("p",null,"Plugin developers need to go to the third-party system to obtain department information and personnel information, and then reconstruct the data into the return structure specified in the ",(0,a.kt)("inlineCode",{parentName:"p"},"DoPullData")," method."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"export async function DoPullData(request: PluginRequest): Promise<PluginResponse> {\n  const resp: DoPullDataResponse = {\n    departments: [],\n    users: [],\n  }\n\n  // Suppose there is only one root department, the department information must have a root department, and the root department id is \"- 1\"\n  const rootDepartment = {\n    third_party_id: '-1',\n    name: 'ONES',\n    parent_id: '',\n    next_id: '',\n  }\n\n  const departments: DepartmentInfo[] = []\n  departments[0] = rootDepartment\n\n  const userInfos: UserInfo[] = []\n  userInfos.push({\n    third_party_id: '1',\n    name: 'test',\n    email: 'test@qq.com',\n    title: 'Position',\n    department_ids: ['-1'],\n    company: 'ONES',\n  })\n\n  resp.departments = departments\n  resp.users = userInfos\n\n  return DoPullDataRespData(200, '', '', '', '', resp)\n}\n")),(0,a.kt)("h4",{id:"implement-message-push"},"Implement message push"),(0,a.kt)("p",null,"To implement message push to a third-party system, plugin developers need to implement their own sending logic in the ",(0,a.kt)("inlineCode",{parentName:"p"},"SendMessage")," method. Every time ONES needs to send a message to a third-party system, the ",(0,a.kt)("inlineCode",{parentName:"p"},"SendMessage")," method will be called, and the exact content of the message will be placed in the request of the ",(0,a.kt)("inlineCode",{parentName:"p"},"SendMessage")," method."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"export async function SendMessage(request: PluginRequest): Promise<PluginResponse> {\n  Logger.info('SendMessage Request:', request?.body)\n  Logger.info('[Plugin] SendMessage ======= success')\n  //Implement the logic of sending to a third-party system\n  return sendMessageRespData(200, '', '', '', '')\n}\n")),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"step-3-do-the-following-in-ones-to-interface-with-third-party-systems"},"Step 3: Do the following in ONES to interface with third-party systems."),(0,a.kt)("p",null,"Install and enable plugin that implement this ability in ",(0,a.kt)("inlineCode",{parentName:"p"},"Configuration -> Plugin management -> Org structure syn, login and notification"),"."),(0,a.kt)("p",null,'Then click "Add integrations" in ',(0,a.kt)("inlineCode",{parentName:"p"},"Configuration -> User management -> Integration"),", and select the plugin to add."),(0,a.kt)(s.Z,{img:u(),mdxType:"Image"}),(0,a.kt)("p",null,"After the addition is successful, you can enable the required function points."),(0,a.kt)(s.Z,{img:y(),mdxType:"Image"}),(0,a.kt)("h2",{id:"examples"},"Examples"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/open-docs/docs/next/abilities/business/account/synchronize-with-third-party-system/sample-synchronize-with-third-party-system1"}," ONES integrate with Ding Talk"))))}E.isMDXComponent=!0}}]);