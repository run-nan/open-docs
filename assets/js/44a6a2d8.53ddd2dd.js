"use strict";(self.webpackChunkopen_docs=self.webpackChunkopen_docs||[]).push([[46886],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var a=n(67294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,r=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=u(n),m=l,g=d["".concat(s,".").concat(m)]||d[m]||p[m]||r;return n?a.createElement(g,o(o({ref:t},c),{},{components:n})):a.createElement(g,o({ref:t},c))}));function m(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=n.length,o=new Array(r);o[0]=d;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:l,o[1]=i;for(var u=2;u<r;u++)o[u]=n[u];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},18679:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(67294),l=n(34334);const r="tabItem_Ymn6";function o(e){let{children:t,hidden:n,className:o}=e;return a.createElement("div",{role:"tabpanel",className:(0,l.Z)(r,o),hidden:n},t)}},34259:(e,t,n)=>{n.d(t,{Z:()=>m});var a=n(87462),l=n(67294),r=n(34334),o=n(51048),i=n(33609),s=n(1943),u=n(72957);const c="tabList__CuJ",p="tabItem_LNqP";function d(e){var t,n;const{lazy:o,block:d,defaultValue:m,values:g,groupId:b,className:f}=e,h=l.Children.map(e.children,(e=>{if((0,l.isValidElement)(e)&&"value"in e.props)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),k=null!=g?g:h.map((e=>{let{props:{value:t,label:n,attributes:a}}=e;return{value:t,label:n,attributes:a}})),y=(0,i.l)(k,((e,t)=>e.value===t.value));if(y.length>0)throw new Error('Docusaurus error: Duplicate values "'+y.map((e=>e.value)).join(", ")+'" found in <Tabs>. Every value needs to be unique.');const v=null===m?m:null!=(t=null!=m?m:null==(n=h.find((e=>e.props.default)))?void 0:n.props.value)?t:h[0].props.value;if(null!==v&&!k.some((e=>e.value===v)))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+v+'" but none of its children has the corresponding value. Available values are: '+k.map((e=>e.value)).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");const{tabGroupChoices:N,setTabGroupChoices:C}=(0,s.U)(),[w,O]=(0,l.useState)(v),x=[],{blockElementScrollPositionUntilNextRender:T}=(0,u.o5)();if(null!=b){const e=N[b];null!=e&&e!==w&&k.some((t=>t.value===e))&&O(e)}const D=e=>{const t=e.currentTarget,n=x.indexOf(t),a=k[n].value;a!==w&&(T(t),O(a),null!=b&&C(b,String(a)))},I=e=>{var t;let n=null;switch(e.key){case"Enter":D(e);break;case"ArrowRight":{var a;const t=x.indexOf(e.currentTarget)+1;n=null!=(a=x[t])?a:x[0];break}case"ArrowLeft":{var l;const t=x.indexOf(e.currentTarget)-1;n=null!=(l=x[t])?l:x[x.length-1];break}}null==(t=n)||t.focus()};return l.createElement("div",{className:(0,r.Z)("tabs-container",c)},l.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":d},f)},k.map((e=>{let{value:t,label:n,attributes:o}=e;return l.createElement("li",(0,a.Z)({role:"tab",tabIndex:w===t?0:-1,"aria-selected":w===t,key:t,ref:e=>x.push(e),onKeyDown:I,onClick:D},o,{className:(0,r.Z)("tabs__item",p,null==o?void 0:o.className,{"tabs__item--active":w===t})}),null!=n?n:t)}))),o?(0,l.cloneElement)(h.filter((e=>e.props.value===w))[0],{className:"margin-top--md"}):l.createElement("div",{className:"margin-top--md"},h.map(((e,t)=>(0,l.cloneElement)(e,{key:t,hidden:e.props.value!==w})))))}function m(e){const t=(0,o.Z)();return l.createElement(d,(0,a.Z)({key:String(t)},e))}},56544:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>m,frontMatter:()=>i,metadata:()=>u,toc:()=>p});var a=n(87462),l=(n(67294),n(3905)),r=n(34259),o=n(18679);const i={},s="Trigger slot",u={unversionedId:"abilities/slot/global/trigger/index",id:"abilities/slot/global/trigger/index",title:"Trigger slot",description:"Requirements",source:"@site/docs/abilities/slot/global/trigger/index.md",sourceDirName:"abilities/slot/global/trigger",slug:"/abilities/slot/global/trigger/",permalink:"/open-docs/docs/next/abilities/slot/global/trigger/",draft:!1,tags:[],version:"current",lastUpdatedBy:"liupengfei",lastUpdatedAt:1690863366,formattedLastUpdatedAt:"Aug 1, 2023",frontMatter:{},sidebar:"abilities",previous:{title:"Progress slot",permalink:"/open-docs/docs/next/abilities/slot/global/progress-detail/"},next:{title:"Trigger action list",permalink:"/open-docs/docs/next/abilities/slot/global/trigger/list"}},c={},p=[{value:"Requirements",id:"requirements",level:2},{value:"Overview",id:"overview",level:2},{value:"Slots",id:"slots",level:2},{value:"ones:global:trigger",id:"onesglobaltrigger",level:4},{value:"Usage",id:"usage",level:2},{value:"Available Hook API",id:"context",level:3},{value:"useVariablesInfo",id:"usevariablesinfo",level:4},{value:"useAction (Deprecated)",id:"useAction",level:4},{value:"FAQ",id:"faq",level:2}],d={toc:p};function m(e){let{components:t,...n}=e;return(0,l.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"trigger-slot"},"Trigger slot"),(0,l.kt)("h2",{id:"requirements"},"Requirements"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:"center"},"ONES"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"center"},"v3.10.20+")))),(0,l.kt)("h2",{id:"overview"},"Overview"),(0,l.kt)("p",null,"We have provided slots for the trigger event to edit the data or cancel the action which is triggered in the system."),(0,l.kt)("p",null,"The slots currently supported are as follows:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#onesglobaltrigger"},"ones:global:trigger"))),(0,l.kt)("h2",{id:"slots"},"Slots"),(0,l.kt)("h4",{id:"onesglobaltrigger"},"ones:global:trigger"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Number limit\uff1a")," Declare a maximum of ",(0,l.kt)("strong",{parentName:"p"},"10")," slots in each plugin, and up to ",(0,l.kt)("strong",{parentName:"p"},"100")," slots in the system."),(0,l.kt)("h2",{id:"usage"},"Usage"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"modules:\n  - id: ones-global-trigger-QIOs\n    title: trigger\n    moduleType: ones:global:trigger\n    entry: modules/ones-global-trigger-QIOs/index.html\n    preload: true\n    manual: true\n    actions:\n      - action:pre:ones:task:fields:update\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Supported config options\uff1a")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("a",{parentName:"p",href:"../../../../reference/config/plugin.yaml#manual"},"manual(required)")),(0,l.kt)("p",{parentName:"li"},"This option must be set to ",(0,l.kt)("inlineCode",{parentName:"p"},"true"),".")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"actions(required)"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"type: ",(0,l.kt)("inlineCode",{parentName:"li"},"Array<string>"))),(0,l.kt)("p",{parentName:"li"},"Configure the ",(0,l.kt)("a",{parentName:"p",href:"/open-docs/docs/next/abilities/slot/global/trigger/list"},"trigger event")," this module needs to be handle."),(0,l.kt)("admonition",{parentName:"li",type:"warning"},(0,l.kt)("p",{parentName:"admonition"},"When the plugin is activated, you must use the ",(0,l.kt)("inlineCode",{parentName:"p"},"useVariablesInfo")," or ",(0,l.kt)("inlineCode",{parentName:"p"},"useAction")," method in ",(0,l.kt)("a",{parentName:"p",href:"#context"},"accessible context data")," below to get the ",(0,l.kt)("inlineCode",{parentName:"p"},"next")," or ",(0,l.kt)("inlineCode",{parentName:"p"},"cancel")," function and call it, otherwise the system action (Action) will be permanently in the pending state."))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("a",{parentName:"p",href:"../../../../reference/config/plugin.yaml#preload"},"preload")),(0,l.kt)("p",{parentName:"li"},"This option is recommended to be set to ",(0,l.kt)("inlineCode",{parentName:"p"},"true"),".")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("a",{parentName:"p",href:"../../../../reference/config/plugin.yaml#enabledelaydestroy"},"enableDelayDestroy")),(0,l.kt)("p",{parentName:"li"},"This option is recommended to be set to ",(0,l.kt)("inlineCode",{parentName:"p"},"true"),"."))),(0,l.kt)("h3",{id:"context"},"Available Hook API"),(0,l.kt)("h4",{id:"usevariablesinfo"},(0,l.kt)("a",{parentName:"h4",href:"/open-docs/docs/next/reference/packages/store/#useVariablesInfo"},"useVariablesInfo")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"ONES Requirement: ",(0,l.kt)("inlineCode",{parentName:"li"},"v3.13.43+"))),(0,l.kt)("p",null,"Similarities and differences with ",(0,l.kt)("inlineCode",{parentName:"p"},"useAction"),"."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Return data directly, no longer need to get it by way of callback pairs."),(0,l.kt)("li",{parentName:"ul"},"No parameters, return value is inferred by paradigm."),(0,l.kt)("li",{parentName:"ul"},"The ",(0,l.kt)("inlineCode",{parentName:"li"},"next")," and ",(0,l.kt)("inlineCode",{parentName:"li"},"cancel")," methods of this method do not bind to the plugin destruction operation, but let the plugin control the module destruction timing by calling the ",(0,l.kt)("inlineCode",{parentName:"li"},"lifecycle.destroy")," method."),(0,l.kt)("li",{parentName:"ul"},"A new ",(0,l.kt)("inlineCode",{parentName:"li"},"actionType")," return is added to determine what Action triggered the current plugin module.")),(0,l.kt)(r.Z,{mdxType:"Tabs"},(0,l.kt)(o.Z,{value:"1",label:"enableDelayDestroy: true",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-tsx"},"import { useVariablesInfo } from '@ones-op/store'\nimport { lifecycle } from '@ones-op/bridge'\n\nfunction TriggerPlugin() {\n  const [visible, setVisible] = useState(true)\n\n  const moduleData = useVariablesInfo<'ones:global:trigger'>()\n\n  const { sessionID, next, cancel, data: payload, actionType } = moduleData\n\n  const handleOk = useCallback(() => {\n    setVisible(false)\n    next?.(payload)\n    lifecycle.destroy()\n  }, [next, payload])\n\n  const handleCancel = useCallback(() => {\n    cancel?.()\n    toast.warning('cancel')\n    setVisible(false)\n    lifecycle.destroy()\n  }, [cancel])\n\n  return (\n    <Modal visible={visible} title=\"Confirm Data\" onOk={handleOk} onCancel={handleCancel}>\n      <p>sessionID: {sessionID}</p>\n      <p>data: </p>\n      <p>{JSON.stringify(payload?.data)}</p>\n    </Modal>\n  )\n}\n"))),(0,l.kt)(o.Z,{value:"2",label:"enableDelayDestroy: false",mdxType:"TabItem"},(0,l.kt)("admonition",{type:"warning"},(0,l.kt)("p",{parentName:"admonition"},"When the plugin calls ",(0,l.kt)("inlineCode",{parentName:"p"},"next")," or ",(0,l.kt)("inlineCode",{parentName:"p"},"cancel"),", it needs to call the ",(0,l.kt)("inlineCode",{parentName:"p"},"lifecycle.destroy")," method to destroy itself as soon as possible, so that the user can't reactivate the plugin when it is triggered again.")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-tsx"},"import { useVariablesInfo } from '@ones-op/store'\nimport { lifecycle } from '@ones-op/bridge'\n\nfunction TriggerPlugin() {\n  const [visible, setVisible] = useState(true)\n\n  const moduleData = useVariablesInfo<'ones:global:trigger'>()\n\n  const { sessionID, next, cancel, data: payload, actionType } = moduleData\n\n  const handleOk = useCallback(() => {\n    setVisible(false)\n    next?.(payload)\n    lifecycle.destroy()\n  }, [next, payload])\n\n  const handleCancel = useCallback(() => {\n    setVisible(false)\n    toast.warning('cancel')\n    // highlight-next-line\n    setTimeout(() => {\n      cancel?.()\n      lifecycle.destroy()\n      // highlight-next-line\n    }, 1100)\n  }, [cancel])\n\n  return (\n    <Modal visible={visible} title=\"Confirm Data\" onOk={handleOk} onCancel={handleCancel}>\n      <p>sessionID: {sessionID}</p>\n      <p>data: </p>\n      <p>{JSON.stringify(payload?.data)}</p>\n    </Modal>\n  )\n}\n")))),(0,l.kt)("h4",{id:"useAction"},(0,l.kt)("a",{parentName:"h4",href:"/open-docs/docs/next/reference/packages/store/#useAction"},"useAction")," (Deprecated)"),(0,l.kt)("details",null,(0,l.kt)("summary",null,"Show More"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-tsx"},"import { useAction } from '@ones-op/store'\n\nfunction TriggerPlugin() {\n  const [visible, setVisible] = useState(false)\n  const [sessionID, setSessionID] = useState('')\n  const [payload, setPayload] = useState<Record<string, any>>()\n  const onOkRef = useRef<Function>()\n  const onCancelRef = useRef<Function>()\n\n  useAction('action:pre:ones:task:fields:update', ({ sessionID, next, data, cancel }) => {\n    console.log('task fields update data: ', data)\n    setSessionID(sessionID)\n    setPayload(data)\n    onOkRef.current = next\n    onCancelRef.current = cancel\n    setVisible(true)\n  })\n\n  const handleOk = useCallback(() => {\n    setVisible(false)\n    onOkRef.current?.(payload)\n  }, [payload])\n\n  const handleCancel = useCallback(() => {\n    setVisible(false)\n    toast.warning('cancel')\n    setTimeout(() => {\n      onCancelRef.current?.()\n    }, 1100)\n  }, [])\n\n  return (\n    <Modal visible={visible} title=\"Confirm Data\" onOk={handleOk} onCancel={handleCancel}>\n      <p>sessionID: {sessionID}</p>\n      <p>data: </p>\n      <p>{JSON.stringify(payload?.data)}</p>\n    </Modal>\n  )\n}\n"))),(0,l.kt)("h2",{id:"faq"},"FAQ"),(0,l.kt)("h3",null,"How does the open platform handles the conflict when multiple modules use the same action?"),(0,l.kt)("p",null,"The open platform will activate the modules serially with the order in the plugin management page, every module will get\nthe original data from the action, after all, modules are handled, the result is merged by the function ",(0,l.kt)("a",{parentName:"p",href:"https://lodash.com/docs/#merge"},(0,l.kt)("inlineCode",{parentName:"a"},"merge")),"\nfrom the ",(0,l.kt)("inlineCode",{parentName:"p"},"lodash")," and return to the system."),(0,l.kt)("p",null,"We strongly do not recommend that you use the same ",(0,l.kt)("inlineCode",{parentName:"p"},"action")," for multiple modules or plugins at the same time, because of\nthe reason described above, and you cannot delete specific data in a plugin, and modifying attributes of the data \u200b\u200bwill\nalso be limited by the order of plugins (For the same attribute in the data, the former is overridden by the latter)."))}m.isMDXComponent=!0}}]);