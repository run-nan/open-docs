(self.webpackChunkopen_docs=self.webpackChunkopen_docs||[]).push([[2919],{14810:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/p1.a9ec085.1024.png 1024w,"+n.p+"assets/ideal-img/p1.bbd70ab.1475.png 1475w",images:[{path:n.p+"assets/ideal-img/p1.a9ec085.1024.png",width:1024,height:58},{path:n.p+"assets/ideal-img/p1.bbd70ab.1475.png",width:1475,height:83}],src:n.p+"assets/ideal-img/p1.a9ec085.1024.png",toString:function(){return n.p+"assets/ideal-img/p1.a9ec085.1024.png"},placeholder:void 0,width:1024,height:58},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAABCAYAAADn9T9+AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAJUlEQVQImWOwtLT8b21t/d/MzOy/iYnJf1NTUzANwyC+sbHxfwBDpRA8fX0L0gAAAABJRU5ErkJggg=="}},77745:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/p2.b7b1fa1.1024.png 1024w,"+n.p+"assets/ideal-img/p2.504e296.1792.png 1792w,"+n.p+"assets/ideal-img/p2.f995847.1916.png 1916w",images:[{path:n.p+"assets/ideal-img/p2.b7b1fa1.1024.png",width:1024,height:430},{path:n.p+"assets/ideal-img/p2.504e296.1792.png",width:1792,height:753},{path:n.p+"assets/ideal-img/p2.f995847.1916.png",width:1916,height:805}],src:n.p+"assets/ideal-img/p2.b7b1fa1.1024.png",toString:function(){return n.p+"assets/ideal-img/p2.b7b1fa1.1024.png"},placeholder:void 0,width:1024,height:430},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAECAYAAAC3OK7NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAXklEQVQImWWLQQ4DIQzE+P9n2wCFBJK4YncPlXqwZI08pXVF2kTVUFuMuTC72dux5Qx1irSBvIRRK1Mnahv3INzxBzIptXX6ZxCRJGfLy385x6Lyxlol5onjL4q8wy8f1Jz20NDRyQAAAABJRU5ErkJggg=="}},51714:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/p3.3ab8548.657.png 657w",images:[{path:n.p+"assets/ideal-img/p3.3ab8548.657.png",width:657,height:113}],src:n.p+"assets/ideal-img/p3.3ab8548.657.png",toString:function(){return n.p+"assets/ideal-img/p3.3ab8548.657.png"},placeholder:void 0,width:657,height:113},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAACCAYAAABhYU3QAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAPklEQVQImVXKOQoAQQgF0T6SC7aKIvT9D/UHzCZ4UEGd7oa7IyIwM9sisogIzLzOew9VhXsvMnNHM4Oq/sYPJ8sgg8joMlMAAAAASUVORK5CYII="}},17942:(e,t,n)=>{"use strict";n.d(t,{Zo:()=>c,kt:()=>u});var a=n(50959);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),d=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=d(e.components);return a.createElement(l.Provider,{value:t},e.children)},p="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,s=e.originalType,l=e.parentName,c=r(e,["components","mdxType","originalType","parentName"]),p=d(n),h=i,u=p["".concat(l,".").concat(h)]||p[h]||g[h]||s;return n?a.createElement(u,o(o({ref:t},c),{},{components:n})):a.createElement(u,o({ref:t},c))}));function u(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var s=n.length,o=new Array(s);o[0]=h;var r={};for(var l in t)hasOwnProperty.call(t,l)&&(r[l]=t[l]);r.originalType=e,r[p]="string"==typeof e?e:i,o[1]=r;for(var d=2;d<s;d++)o[d]=n[d];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},13813:(e,t,n)=>{"use strict";n.r(t),n.d(t,{assets:()=>m,contentTitle:()=>h,default:()=>w,frontMatter:()=>g,metadata:()=>u,toc:()=>f});var a=n(28957),i=(n(50959),n(17942)),s=n(14810),o=n.n(s),r=n(77745),l=n.n(r),d=n(51714),c=n.n(d),p=n(49500);const g={sidebar_position:18,description:"Receive notification messages via SMS."},h="Receive notification messages via SMS",u={unversionedId:"abilities/basic/send-short-message/send-short-message",id:"abilities/basic/send-short-message/send-short-message",title:"Receive notification messages via SMS",description:"Receive notification messages via SMS.",source:"@site/docs/abilities/basic/send-short-message/send-short-message.mdx",sourceDirName:"abilities/basic/send-short-message",slug:"/abilities/basic/send-short-message/",permalink:"/open-docs/docs/abilities/basic/send-short-message/",draft:!1,tags:[],version:"current",lastUpdatedBy:"liupengfei",lastUpdatedAt:1703495563,formattedLastUpdatedAt:"Dec 25, 2023",sidebarPosition:18,frontMatter:{sidebar_position:18,description:"Receive notification messages via SMS."},sidebar:"abilities",previous:{title:"Scene\uff1aCustom sprint component with context-based permission",permalink:"/open-docs/docs/abilities/basic/custom-permission/permission-with-context"},next:{title:"App Modules",permalink:"/open-docs/docs/abilities/business/"}},m={},f=[{value:"Require",id:"require",level:2},{value:"Overview",id:"overview",level:2},{value:"use",id:"use",level:2},{value:"Step 1: Add Capabilities",id:"step-1-add-capabilities",level:3},{value:"Step 2: Add external route",id:"step-2-add-external-route",level:3},{value:"Step 3: Install the plugin locally and request the added external interface",id:"step-3-install-the-plugin-locally-and-request-the-added-external-interface",level:3},{value:"Step 4: Create an account and bind a mobile phone number to this account",id:"step-4-create-an-account-and-bind-a-mobile-phone-number-to-this-account",level:3},{value:"Step 5: Use the administrator account to log in to the system, select the text message in the message notification of creating a task, and add the newly created user to the member list",id:"step-5-use-the-administrator-account-to-log-in-to-the-system-select-the-text-message-in-the-message-notification-of-creating-a-task-and-add-the-newly-created-user-to-the-member-list",level:3},{value:"Step 6: Create a task",id:"step-6-create-a-task",level:3}],b=(A="Image",function(e){return p.warn("Component "+A+" was not imported, exported, or provided by MDXProvider as global scope"),(0,i.kt)("div",e)});var A;const y={toc:f},v="wrapper";function w(e){let{components:t,...n}=e;return(0,i.kt)(v,(0,a.Z)({},y,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"receive-notification-messages-via-sms"},"Receive notification messages via SMS"),(0,i.kt)("h2",{id:"require"},"Require"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"left"},"ONES"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"v3.12.0+")))),(0,i.kt)("h2",{id:"overview"},"Overview"),(0,i.kt)("p",null,'In the notification method, we only need to enable the relevant configuration of the SMS sending capability, and then we can select the "SMS" sending channel. For details on how to configure it, please refer to ',"[Enable SMS sending]","(",(0,i.kt)("a",{parentName:"p",href:"https://guide.ones.pro/wiki/"},"https://guide.ones.pro/wiki/")," #/team/LBrdb4wE/space/6XDAYB1a/page/Y9T5GFQn) , to enable the above configuration, we need to have an independent service to carry the receiving and sending of SMS messages, and also need to maintain the service, which often costs It is relatively high. If the SMS sending system is implemented through plug-ins, customers do not need to care about the operation and maintenance of the service, and plug-in developers only need to care about receiving the content of the plug-in and the number of the person receiving the SMS. Just forward the SMS, and the forwarding logic of the SMS is handled by the plug-in itself. It should be noted that this capability only supports single-team organizations, and does not support multi-team organizations, and only one plug-in under this team can use this ability."),(0,i.kt)("h2",{id:"use"},"use"),(0,i.kt)("h3",{id:"step-1-add-capabilities"},"Step 1: Add Capabilities"),(0,i.kt)("p",null,"Execute the ",(0,i.kt)("inlineCode",{parentName:"p"},"npx op add ability")," command in the root directory of the plug-in project, and select: ",(0,i.kt)("inlineCode",{parentName:"p"},"send-short-message@1.0.0"),"."),(0,i.kt)("p",null,"After the execution is completed, a section of configuration will be added under the ",(0,i.kt)("strong",{parentName:"p"},"abilities")," property of the ",(0,i.kt)("inlineCode",{parentName:"p"},"plugin.yaml")," configuration file. The configuration is as follows:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"abilities:\n  - id: xxxxxx\n    name: SendShortMessage\n    version: 1.0.0\n    abilityType: send_short_message\n    function:\n      sendShortMessage: SendShortMessage\n")),(0,i.kt)("p",null,"The backend code adds the following code:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"export async function SendShortMessage(request: PluginRequest): Promise<PluginResponse> {\n  return {\n    body: {\n      code: 200,\n      ResponseModel: 'Plugin.SendShortMessage',\n      Reason: 'Success',\n      Type: null,\n      Body: null,\n    },\n  }\n}\n")),(0,i.kt)("p",null,"The above code is used to receive text messages. Once the scene that needs to send text messages is triggered, the text message context will be forwarded to this function, including the content of the text message and the number of the user who needs to receive the text message, respectively in the body of the request. content, phone_numbers parameter."),(0,i.kt)("h3",{id:"step-2-add-external-route"},"Step 2: Add external route"),(0,i.kt)("p",null,"This route mainly plays the role of enabling the SMS configuration, because only when the SMS configuration is enabled, can the SMS be selected in the message notification."),(0,i.kt)("p",null,"Add the following content to the apis field in the plugin.yaml file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"apis:\n   -type: external\n     methods:\n       - POST\n     url: /team/:teamUUID/open_send_short_message\n     function: OpenSendShortMessage\n")),(0,i.kt)("p",null,"Add the following code to the backend file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"export async function OpenSendShortMessage(request: PluginRequest): Promise<PluginResponse> {\n  // Query sms_config interface ${globalThis.onesEnv.teamUUID\n  const response = await fetchONES({\n    path: `/organization/${globalThis.onesEnv.organizationUUID}/sms_config`,\n    method: 'GET',\n    root: true, //default is true\n  })\n  Logger.info('resp:', response)\n  const { uuid, channel_uuid } = response?.body as any\n\n  // Call to open the configuration interface\n  const response2 = await fetchONES({\n    path: `/organization/${globalThis.onesEnv.organizationUUID}/sms_config/update`,\n    method: 'POST',\n    body: {\n      uuid: uuid,\n      url: '-',\n      token: '-',\n      enable_bind: 1,\n      enable_notice: 1,\n      channel_uuid: channel_uuid,\n    },\n    root: true,\n  })\n  Logger.info('resp:', response2)\n\n  return {\n    body: {\n      res: 'success',\n    },\n  }\n}\n")),(0,i.kt)("h3",{id:"step-3-install-the-plugin-locally-and-request-the-added-external-interface"},"Step 3: Install the plugin locally and request the added external interface"),(0,i.kt)("h3",{id:"step-4-create-an-account-and-bind-a-mobile-phone-number-to-this-account"},"Step 4: Create an account and bind a mobile phone number to this account"),(0,i.kt)("p",null,"When we fill in the phone number on the binding page, and then click to send the verification code, if we print out the request in the OpenSendShortMessage function in the plug-in, we will see the following result:"),(0,i.kt)(b,{img:o(),mdxType:"Image"}),"The reason why sending a verification code triggers this function is that as long as there is a scene in the system that needs to send a text message, the content of the text message and the number of the user to be accepted can be intercepted through this capability, because sending a verification code is also a scene of calling a text message , so the function of the plug-in will be triggered, and the mobile phone number can be bound according to the verification code.",(0,i.kt)("h3",{id:"step-5-use-the-administrator-account-to-log-in-to-the-system-select-the-text-message-in-the-message-notification-of-creating-a-task-and-add-the-newly-created-user-to-the-member-list"},"Step 5: Use the administrator account to log in to the system, select the text message in the message notification of creating a task, and add the newly created user to the member list"),(0,i.kt)(b,{img:l(),mdxType:"Image"}),(0,i.kt)("h3",{id:"step-6-create-a-task"},"Step 6: Create a task"),(0,i.kt)("p",null,"After creating a task, you can receive the following information in the plugin:"),(0,i.kt)(b,{img:c(),mdxType:"Image"}))}w.isMDXComponent=!0}}]);