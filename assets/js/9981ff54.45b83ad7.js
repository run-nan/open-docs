"use strict";(self.webpackChunkopen_docs=self.webpackChunkopen_docs||[]).push([[91479],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>h});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var p=a.createContext({}),c=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},s=function(e){var t=c(e.components);return a.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,p=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),d=c(n),h=o,k=d["".concat(p,".").concat(h)]||d[h]||u[h]||r;return n?a.createElement(k,i(i({ref:t},s),{},{components:n})):a.createElement(k,i({ref:t},s))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=d;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var c=2;c<r;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},11606:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>u,frontMatter:()=>r,metadata:()=>l,toc:()=>c});var a=n(87462),o=(n(67294),n(3905));const r={id:"authorization",sidebar_position:2,sidebar_label:"Authorization"},i="Authentication And Authorization",l={unversionedId:"openapi/authorization",id:"openapi/authorization",title:"Authentication And Authorization",description:"Create oauth application",source:"@site/docs/openapi/authorization.mdx",sourceDirName:"openapi",slug:"/openapi/authorization",permalink:"/open-docs/docs/next/openapi/authorization",draft:!1,tags:[],version:"current",lastUpdatedBy:"liupengfei",lastUpdatedAt:1690863366,formattedLastUpdatedAt:"Aug 1, 2023",sidebarPosition:2,frontMatter:{id:"authorization",sidebar_position:2,sidebar_label:"Authorization"},sidebar:"openapi",previous:{title:"About",permalink:"/open-docs/docs/next/openapi/"},next:{title:"Status Codes",permalink:"/open-docs/docs/next/openapi/status-code"}},p={},c=[{value:"Create oauth application",id:"create-oauth-application",level:2},{value:"Apply for authorization code",id:"apply-for-authorization-code",level:2},{value:"Apply for access token",id:"apply-for-access-token",level:2},{value:"Access Open API",id:"access-open-api",level:2},{value:"Get access token details",id:"get-access-token-details",level:2},{value:"Refresh access token",id:"refresh-access-token",level:2},{value:"Revoke access token",id:"revoke-access-token",level:2},{value:"FAQ",id:"faq",level:2}],s={toc:c};function u(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"authentication-and-authorization"},"Authentication And Authorization"),(0,o.kt)("h2",{id:"create-oauth-application"},"Create oauth application"),(0,o.kt)("p",null,'Team administrators can create it in the ONES system in "Configuration Center" - "Team Configuration" - "Custom OAuth Application". After creating the OAuth application, you will receive a Client ID and Client Secret, which developers need to store securely.'),(0,o.kt)("p",null,"Creating an OAuth application requires the following information:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Application Name: The name of the OAuth application."),(0,o.kt)("li",{parentName:"ul"},"Redirect URI: Upon successful authorization code application, it will redirect to this address."),(0,o.kt)("li",{parentName:"ul"},"Scope: Select the extent of the ONES Open API that the OAuth application can access.")),(0,o.kt)("h2",{id:"apply-for-authorization-code"},"Apply for authorization code"),(0,o.kt)("p",null,"Request Example\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"curl 'https://your-domain/oauth2/authorize?client_id=CLIENT_ID&response_type=code'\n")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"/open-docs/docs/next/openapi/api/auth/apply-for-authorization-code"},"Detailed Interface Introduction")),(0,o.kt)("p",null,"After the request is successful, the browser will be redirected to the ONES system. If the user is not logged in, they will need to log in. If the user is already logged in, it will redirect to the authorization consent page. Once the user agrees to the authorization, it will redirect to the Redirect URI, and 'code' and 'state' parameters will be added to the URL. The 'code' will become invalid after applying for the access token and can only be used once."),(0,o.kt)("h2",{id:"apply-for-access-token"},"Apply for access token"),(0,o.kt)("p",null,"Request Example\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"curl -X POST 'https://your-domain/oauth2/token' \\\n    -H 'Content-Type: application/x-www-form-urlencoded' \\\n    -d 'client_id=CLIENT_ID' \\\n    -d 'client_secret=CLIENT_SECRET' \\\n    -d 'code=CODE' \\\n    -d 'grant_type=authorization_code'\n")),(0,o.kt)("p",null,"Response Example\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{\n    "access_token": "CN-NDd...pLW",\n    "email": "test@ones.bot",\n    "expires_in": 86400,\n    "refresh_token": "CN-MDF...TNi",\n    "scope": "read:testcase:library,write:testcase:library",\n    "token_type": "Bearer",\n    "user_id": "CJ...qz"\n}\n')),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"/open-docs/docs/next/openapi/api/auth/apply-for-or-refresh-access-token"},"Detailed Interface Introduction")),(0,o.kt)("p",null,"The 'access_token' is a globally unique credential for making API calls. It is required when calling the Open API, and developers need to securely store it."),(0,o.kt)("h2",{id:"access-open-api"},"Access Open API"),(0,o.kt)("p",null,"Request Example\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"curl 'https://your-domain/rest/api/v1/xxx' -H \"Authorization: Bearer ACCESS_TOKEN\"\n")),(0,o.kt)("h2",{id:"get-access-token-details"},"Get access token details"),(0,o.kt)("p",null,"Request Example\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'curl "https://your-domain/oauth2/introspect" -H "Authorization: Bearer ACCESS_TOKEN"\n')),(0,o.kt)("p",null,"Response Example\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{\n    "active": true,\n    "sub": "CJ...qz",\n    "scope": "read:testcase:library,write:testcase:library",\n    "client_id": "3hF...leI",\n    "token_type": "Bearer",\n    "exp": 1681889317,\n    "team_id": "xxx"\n}\n')),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"/open-docs/docs/next/openapi/api/auth/get-access-token-details"},"Detailed Interface Introduction")),(0,o.kt)("h2",{id:"refresh-access-token"},"Refresh access token"),(0,o.kt)("p",null,"After refreshing the access token, the previously applied access token and refresh token will both become invalid, and new access and refresh tokens will be returned."),(0,o.kt)("p",null,"Request Example\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"curl -X POST 'https://your-domain/oauth2/token' \\\n    -H 'Content-Type: application/x-www-form-urlencoded' \\\n    -d 'client_id=CLIENT_ID' \\\n    -d 'refresh_token=REFRESH_TOKEN' \\\n    -d 'grant_type=refresh_token'\n")),(0,o.kt)("p",null,"Response Example\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{\n    "access_token": "CN-NDd...pLW",\n    "email": "test@ones.bot",\n    "expires_in": 86400,\n    "refresh_token": "CN-MDF...TNi",\n    "scope": "read:testcase:library,write:testcase:library",\n    "token_type": "Bearer",\n    "user_id": "CJ...qz"\n}\n')),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"/open-docs/docs/next/openapi/api/auth/apply-for-or-refresh-access-token"},"Detailed Interface Introduction")),(0,o.kt)("h2",{id:"revoke-access-token"},"Revoke access token"),(0,o.kt)("p",null,"When revoking the access token, the refresh token will also become invalid."),(0,o.kt)("p",null,"Request Example\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"curl -X POST 'https://your-domain/oauth2/revoke' \\\n    -H 'Content-Type: application/json' \\\n    -d '{\n        \"client_id\": CLIENT_ID,\n        \"client_secret\": CLIENT_SECRET,\n        \"access_token\": ACCESS_TOKEN\n    }'\n")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"/open-docs/docs/next/openapi/api/auth/revoke-access-token"},"Detailed Interface Introduction")),(0,o.kt)("h2",{id:"faq"},"FAQ"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"If the Scope of the OAuth application is changed, does the Scope of the already applied access token change synchronously?")),(0,o.kt)("p",null,"Changing the Scope of the OAuth application will not affect the Scope of the already granted access token. If the new Scope needs to be effective, you must redo the process of applying for the authorization code and the access token."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"After deleting the OAuth application, will the already applied access token become invalid?")),(0,o.kt)("p",null,"After deleting the OAuth application, the already granted authorization code, access token, and refresh token will all become invalid."))}u.isMDXComponent=!0}}]);