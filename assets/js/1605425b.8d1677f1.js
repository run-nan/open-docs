(self.webpackChunkopen_docs=self.webpackChunkopen_docs||[]).push([[2381],{33108:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/audit-log1.8ae8227.1024.png 1024w,"+n.p+"assets/ideal-img/audit-log1.35095e6.1792.png 1792w,"+n.p+"assets/ideal-img/audit-log1.7bc8fe8.2384.png 2384w",images:[{path:n.p+"assets/ideal-img/audit-log1.8ae8227.1024.png",width:1024,height:514},{path:n.p+"assets/ideal-img/audit-log1.35095e6.1792.png",width:1792,height:899},{path:n.p+"assets/ideal-img/audit-log1.7bc8fe8.2384.png",width:2384,height:1196}],src:n.p+"assets/ideal-img/audit-log1.8ae8227.1024.png",toString:function(){return n.p+"assets/ideal-img/audit-log1.8ae8227.1024.png"},placeholder:void 0,width:1024,height:514},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAe0lEQVQImTWOSw7CMBBDe/8rcgMWLZnMLxPahxpgYVmWnmVvTR13JyKIzOX//Heui+0linTFzEh3Mpz8FWYVFoPHM9mktQVpJCmNFGFU0VpDVVE1xIJNRPAI3ue5ADVjzskYg33fcTNqjC94f+v3dARVtdR75ziOtXYXP6ILwd4APYh3AAAAAElFTkSuQmCC"}},17942:(e,t,n)=>{"use strict";n.d(t,{Zo:()=>d,kt:()=>h});var i=n(50959);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=i.createContext({}),p=function(e){var t=i.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=p(e.components);return i.createElement(l.Provider,{value:t},e.children)},u="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},g=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),u=p(n),g=a,h=u["".concat(l,".").concat(g)]||u[g]||c[g]||o;return n?i.createElement(h,r(r({ref:t},d),{},{components:n})):i.createElement(h,r({ref:t},d))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,r=new Array(o);r[0]=g;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[u]="string"==typeof e?e:a,r[1]=s;for(var p=2;p<o;p++)r[p]=n[p];return i.createElement.apply(null,r)}return i.createElement.apply(null,n)}g.displayName="MDXCreateElement"},56336:(e,t,n)=>{"use strict";n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>p,default:()=>y,frontMatter:()=>l,metadata:()=>d,toc:()=>c});var i=n(28957),a=(n(50959),n(17942)),o=n(33108),r=n.n(o),s=n(49500);const l={sidebar_position:10,description:'Plugins can write audit logs to ONES. On the "Configuration -> System security -> Audit Log" page, you can view the contents of the audit logs. The operation type of the audit logs generated by plugins using this capability is "Plugin Log".'},p="Audit log",d={unversionedId:"abilities/basic/auditlog",id:"abilities/basic/auditlog",title:"Audit log",description:'Plugins can write audit logs to ONES. On the "Configuration -> System security -> Audit Log" page, you can view the contents of the audit logs. The operation type of the audit logs generated by plugins using this capability is "Plugin Log".',source:"@site/docs/abilities/basic/auditlog.mdx",sourceDirName:"abilities/basic",slug:"/abilities/basic/auditlog",permalink:"/open-docs/docs/abilities/basic/auditlog",draft:!1,tags:[],version:"current",lastUpdatedBy:"liupengfei",lastUpdatedAt:1703234094,formattedLastUpdatedAt:"Dec 22, 2023",sidebarPosition:10,frontMatter:{sidebar_position:10,description:'Plugins can write audit logs to ONES. On the "Configuration -> System security -> Audit Log" page, you can view the contents of the audit logs. The operation type of the audit logs generated by plugins using this capability is "Plugin Log".'},sidebar:"abilities",previous:{title:"Timer",permalink:"/open-docs/docs/abilities/basic/timer"},next:{title:"Upload file",permalink:"/open-docs/docs/abilities/basic/uploadFile"}},u={},c=[{value:"Requirements",id:"requirements",level:2},{value:"Overview",id:"overview",level:2},{value:"Usage",id:"usage",level:2},{value:"Step 1\uff1aInstalling dependencies",id:"step-1installing-dependencies",level:3},{value:"Step 2\uff1aCall the <code>createLog</code> method in the plugin to write the audit log to ONES",id:"step-2call-the-createlog-method-in-the-plugin-to-write-the-audit-log-to-ones",level:3}],g=(h="Image",function(e){return s.warn("Component "+h+" was not imported, exported, or provided by MDXProvider as global scope"),(0,a.kt)("div",e)});var h;const m={toc:c},f="wrapper";function y(e){let{components:t,...n}=e;return(0,a.kt)(f,(0,i.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"audit-log"},"Audit log"),(0,a.kt)("h2",{id:"requirements"},"Requirements"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:"left"},"ONES"),(0,a.kt)("th",{parentName:"tr",align:"left"},"@ones-op/node-ability"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"v3.6.0+"),(0,a.kt)("td",{parentName:"tr",align:"left"},"v0.1.9+")))),(0,a.kt)("h2",{id:"overview"},"Overview"),(0,a.kt)("p",null,"The plugin can write the audit log to the ONES. You can see the contents of the audit log on the ",(0,a.kt)("inlineCode",{parentName:"p"},"Configuration -> System security -> Audit Log")," page."),(0,a.kt)("p",null,"The operation type of audit log generated by plugin using this ability is ",(0,a.kt)("strong",{parentName:"p"},"Plugin log"),"."),(0,a.kt)(g,{img:r(),mdxType:"Image"}),(0,a.kt)("h2",{id:"usage"},"Usage"),(0,a.kt)("h3",{id:"step-1installing-dependencies"},"Step 1\uff1aInstalling dependencies"),(0,a.kt)("p",null,"Enter the ",(0,a.kt)("inlineCode",{parentName:"p"},"/backend")," directory of the plugin project, and execute the following command for dependent installation:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"npm i @ones-op/node-ability\n")),(0,a.kt)("h3",{id:"step-2call-the-createlog-method-in-the-plugin-to-write-the-audit-log-to-ones"},"Step 2\uff1aCall the ",(0,a.kt)("inlineCode",{parentName:"h3"},"createLog")," method in the plugin to write the audit log to ONES"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"The ",(0,a.kt)("inlineCode",{parentName:"p"},"createLog")," method requires two input parameters, one of which contains the structure of the ",(0,a.kt)("inlineCode",{parentName:"p"},"X-Real-Ip")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"Ones-User-Id")," fields, as well as the audit information to be recorded ",(0,a.kt)("inlineCode",{parentName:"p"},"message"),". ",(0,a.kt)("inlineCode",{parentName:"p"},"Ones-User-Id")," is the uuid of the operator,",(0,a.kt)("inlineCode",{parentName:"p"},"X-Real-Ip")," is the IP address of the operator.")),(0,a.kt)("p",null,"As shown in the following code, construct a structure ",(0,a.kt)("inlineCode",{parentName:"p"},"auditData")," with ",(0,a.kt)("inlineCode",{parentName:"p"},"X-Real-Ip")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"Ones-User-Id")," as the first input parameter, and take the audit information you want to record ",(0,a.kt)("inlineCode",{parentName:"p"},"message")," as the second input parameter, and call the ",(0,a.kt)("inlineCode",{parentName:"p"},"createLog")," method to write to the plugin audit log. If it is an organization-level plugin, it needs the team's unique identifier ",(0,a.kt)("inlineCode",{parentName:"p"},"teamUUID")," as the third entry."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"import { AuditLog } from '@ones-op/node-ability'\n\nexport async function testAuditLog(request: PluginRequest): Promise<PluginResponse> {\n  const auditHeader = {\n    'Ones-User-Id': 'E6ZqgsSX', //This parameter is user uuid\n    'X-Real-Ip': '127.0.0.1', //IP address\n  }\n  const resp = await AuditLog.createLog(auditHeader, 'Test log')\n  return {\n    body: {\n      res: 'audit log',\n      resp: resp,\n    },\n  }\n}\n")),(0,a.kt)("p",null,"The header of ",(0,a.kt)("inlineCode",{parentName:"p"},"request")," contains all the parameters required by the ",(0,a.kt)("inlineCode",{parentName:"p"},"createLog")," method, so you can directly use the header of ",(0,a.kt)("inlineCode",{parentName:"p"},"request")," as a parameter. The operator of the audit diary is the user accessing the interface, and the IP address of the audit log is the IP address of the user accessing the interface, as shown below."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"import { AuditLog } from '@ones-op/node-ability'\n\nexport async function hello(request: PluginRequest): Promise<PluginResponse> {\n  const body = request.body || {}\n  await AuditLog.createLog(request.headers, 'Audit log from plugin') //write audit information\n  return {\n    body: {\n      res: 'audit log',\n      requestBody: body,\n    },\n  }\n}\n")))}y.isMDXComponent=!0}}]);