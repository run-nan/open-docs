(self.webpackChunkopen_docs=self.webpackChunkopen_docs||[]).push([[4603],{73615:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/custom-config1.0027b13.1024.png 1024w,"+n.p+"assets/ideal-img/custom-config1.934e130.1230.png 1230w",images:[{path:n.p+"assets/ideal-img/custom-config1.0027b13.1024.png",width:1024,height:561},{path:n.p+"assets/ideal-img/custom-config1.934e130.1230.png",width:1230,height:674}],src:n.p+"assets/ideal-img/custom-config1.0027b13.1024.png",toString:function(){return n.p+"assets/ideal-img/custom-config1.0027b13.1024.png"},placeholder:void 0,width:1024,height:561},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAZklEQVQImXWMQQ6DIBQFuf8Vu60NFYGiFT8IfxrdNbWTvM1k8sy8vMlSmFch54yIoKo/M27yhLQyhI29FlS5DkfnmXwkuOf5dvA3jDHxGi17rae8wtxt4uEWbrZTSqX3Tmvta4f7ADn9w3INhVNBAAAAAElFTkSuQmCC"}},52626:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/custom-config2.0e46056.1024.png 1024w,"+n.p+"assets/ideal-img/custom-config2.b5012d0.1576.png 1576w",images:[{path:n.p+"assets/ideal-img/custom-config2.0e46056.1024.png",width:1024,height:606},{path:n.p+"assets/ideal-img/custom-config2.b5012d0.1576.png",width:1576,height:933}],src:n.p+"assets/ideal-img/custom-config2.0e46056.1024.png",toString:function(){return n.p+"assets/ideal-img/custom-config2.0e46056.1024.png"},placeholder:void 0,width:1024,height:606},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAYAAAD68A/GAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAXUlEQVQImX2PWwqAMAwEc/+jik0faa0QkxWr4I91YVgCQ2CpSkXvO1rbcKjC3WFmMLv6hTgmFGlQ1SHMQmtg5CLj8Av3T4g5IuVyixNpiAsLQrw//oVyFtS2PwPmnIBa7Hk3HszPAAAAAElFTkSuQmCC"}},17942:(e,t,n)=>{"use strict";n.d(t,{Zo:()=>p,kt:()=>m});var i=n(50959);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=i.createContext({}),u=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=u(e.components);return i.createElement(s.Provider,{value:t},e.children)},d="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},c=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=u(n),c=a,m=d["".concat(s,".").concat(c)]||d[c]||g[c]||o;return n?i.createElement(m,r(r({ref:t},p),{},{components:n})):i.createElement(m,r({ref:t},p))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,r=new Array(o);r[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:a,r[1]=l;for(var u=2;u<o;u++)r[u]=n[u];return i.createElement.apply(null,r)}return i.createElement.apply(null,n)}c.displayName="MDXCreateElement"},48066:(e,t,n)=>{"use strict";n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>d,default:()=>y,frontMatter:()=>p,metadata:()=>g,toc:()=>m});var i=n(28957),a=(n(50959),n(17942)),o=n(73615),r=n.n(o),l=n(52626),s=n.n(l),u=n(49500);const p={id:"custom-config",sidebar_position:6,description:"Plugins can use this capability to customize and add configuration options for plugins under 'Configuration -> Plugin Management'."},d="Custom plugin configuration",g={unversionedId:"abilities/basic/custom-config",id:"abilities/basic/custom-config",title:"Custom plugin configuration",description:"Plugins can use this capability to customize and add configuration options for plugins under 'Configuration -> Plugin Management'.",source:"@site/docs/abilities/basic/custom-config.mdx",sourceDirName:"abilities/basic",slug:"/abilities/basic/custom-config",permalink:"/open-docs/docs/abilities/basic/custom-config",draft:!1,tags:[],version:"current",lastUpdatedBy:"liupengfei",lastUpdatedAt:1703230356,formattedLastUpdatedAt:"Dec 22, 2023",sidebarPosition:6,frontMatter:{id:"custom-config",sidebar_position:6,description:"Plugins can use this capability to customize and add configuration options for plugins under 'Configuration -> Plugin Management'."},sidebar:"abilities",previous:{title:"Send external notifications",permalink:"/open-docs/docs/abilities/basic/notifications"},next:{title:"Get plugin ability configuration",permalink:"/open-docs/docs/abilities/basic/ability-config"}},c={},m=[{value:"Requirements",id:"requirements",level:2},{value:"Overview",id:"overview",level:2},{value:"Usage",id:"usage",level:2},{value:"1. Add in the <code>Basic info</code> tab",id:"1-add-in-the-basic-info-tab",level:3},{value:"Add custom configuration items to the plugin",id:"add-custom-configuration-items-to-the-plugin",level:4},{value:"The plugin backend get the plugin custom configuration item",id:"the-plugin-backend-get-the-plugin-custom-configuration-item",level:4},{value:"Get by calling the SDK method",id:"get-by-calling-the-sdk-method",level:5},{value:"Get by ONES API access",id:"get-by-ones-api-access",level:5},{value:"2. Add in the new tab",id:"2-add-in-the-new-tab",level:3},{value:"FAQ",id:"faq",level:2}],f=(h="Image",function(e){return u.warn("Component "+h+" was not imported, exported, or provided by MDXProvider as global scope"),(0,a.kt)("div",e)});var h;const k={toc:m},b="wrapper";function y(e){let{components:t,...n}=e;return(0,a.kt)(b,(0,i.Z)({},k,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"custom-plugin-configuration"},"Custom plugin configuration"),(0,a.kt)("h2",{id:"requirements"},"Requirements"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:"left"},"ONES"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"v3.6.0+")))),(0,a.kt)("h2",{id:"overview"},"Overview"),(0,a.kt)("p",null,"Through this ability, plugin can customize and add configuration items for plugin under the route ",(0,a.kt)("inlineCode",{parentName:"p"},"Configuration -> plugin management"),". There are two ways to achieve this:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"The ",(0,a.kt)("inlineCode",{parentName:"li"},"Basic info")," tab")),(0,a.kt)("p",null,"The details page of each plugin contains the value of the configuration item. You can modify the value of the configuration item when the plugin is not enabled.\nThe type of configuration item supports three types: single-line, multi-line text and encrypted text and the required configuration item can't be empty before enabling the plugin."),(0,a.kt)(f,{img:r(),mdxType:"Image"}),(0,a.kt)("p",null,"And the plugin backend can get the data of the plugin custom configuration item by calling API."),(0,a.kt)("ol",{start:2},(0,a.kt)("li",{parentName:"ol"},"New tab")),(0,a.kt)(f,{img:s(),mdxType:"Image"}),(0,a.kt)("p",null,"You can add a new tab before the ",(0,a.kt)("inlineCode",{parentName:"p"},"Log")," tab by adding a slot. You need to render the configuration page and determine how to store and get the configuration data in this slot."),(0,a.kt)("p",null,"The tab is reachable only when the plugin is enabled."),(0,a.kt)("h2",{id:"usage"},"Usage"),(0,a.kt)("h3",{id:"1-add-in-the-basic-info-tab"},"1. Add in the ",(0,a.kt)("inlineCode",{parentName:"h3"},"Basic info")," tab"),(0,a.kt)("h4",{id:"add-custom-configuration-items-to-the-plugin"},"Add custom configuration items to the plugin"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Plugin configuration item field description")),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Key"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"),(0,a.kt)("th",{parentName:"tr",align:null},"Type"),(0,a.kt)("th",{parentName:"tr",align:null},"Required"),(0,a.kt)("th",{parentName:"tr",align:null},"Default"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"key"),(0,a.kt)("td",{parentName:"tr",align:null},"Unique identification"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"string")),(0,a.kt)("td",{parentName:"tr",align:null},"Y"),(0,a.kt)("td",{parentName:"tr",align:null})),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"type"),(0,a.kt)("td",{parentName:"tr",align:null},"Control type",(0,a.kt)("br",null)," ",(0,a.kt)("inlineCode",{parentName:"td"},"Input"),": single-line ",(0,a.kt)("br",null),(0,a.kt)("inlineCode",{parentName:"td"},"TextArea"),": multi-line text",(0,a.kt)("br",null)," ",(0,a.kt)("inlineCode",{parentName:"td"},"Password"),": encrypted text"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"string")),(0,a.kt)("td",{parentName:"tr",align:null},"Y"),(0,a.kt)("td",{parentName:"tr",align:null})),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"required"),(0,a.kt)("td",{parentName:"tr",align:null},"Is this required"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"boolean")),(0,a.kt)("td",{parentName:"tr",align:null},"N"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"false"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"label"),(0,a.kt)("td",{parentName:"tr",align:null},"Alias"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"string")),(0,a.kt)("td",{parentName:"tr",align:null},"N"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"key"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"value"),(0,a.kt)("td",{parentName:"tr",align:null},"Default"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"string")),(0,a.kt)("td",{parentName:"tr",align:null},"N"),(0,a.kt)("td",{parentName:"tr",align:null})))),(0,a.kt)("p",null,"Add the required content to the ",(0,a.kt)("inlineCode",{parentName:"p"},"config")," field under the plugin configuration file ",(0,a.kt)("inlineCode",{parentName:"p"},"plugin.yaml")," to add a new configuration item ",(0,a.kt)("strong",{parentName:"p"},"cexampleConfigKey")," for the plugin, with the type of single-line."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="config/plugin.yaml"',title:'"config/plugin.yaml"'},"service:\n  config:\n    - key: exampleConfigKey\n      label: my example key\n      type: Input\n")),(0,a.kt)("h4",{id:"the-plugin-backend-get-the-plugin-custom-configuration-item"},"The plugin backend get the plugin custom configuration item"),(0,a.kt)("h5",{id:"get-by-calling-the-sdk-method"},"Get by calling the SDK method"),(0,a.kt)("p",null,"Obtain the plugin configuration directly through the ",(0,a.kt)("inlineCode",{parentName:"p"},"Plugin.getPluginConfig()")," of the ",(0,a.kt)("inlineCode",{parentName:"p"},"@ones-op/node-ability")," package"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Plugin } from '@ones-op/node-ability'\n\nexport async function configurationPageTest1() {\n  const configs = await Plugin.getPluginConfig()\n}\n")),(0,a.kt)("h5",{id:"get-by-ones-api-access"},"Get by ",(0,a.kt)("a",{parentName:"h5",href:"/open-docs/docs/abilities/basic/ones-api/access"},"ONES API access")),(0,a.kt)("p",null,"By constructing the ",(0,a.kt)("inlineCode",{parentName:"p"},"fetchONES")," input parameter according to the following code and parameters for API access, you can obtain the relevant information about the plugin configuration item from the returned value."),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"Note that you need to convert the return parameters to json format, and then get the information about the configuration item from the json array.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"import { fetchONES } from '@ones-op/node-fetch'\n\nexport async function configurationPageTest() {\n  const response = await fetchONES({\n    path: `/team/${globalThis.onesEnv.teamUUID}`,\n    method: 'POST',\n    headers: {\n      'Ones-Plugin-Id': ['built_in_apis'],\n      'Ones-Check-Point': ['team'],\n      'Ones-Check-Id': [`${globalThis.onesEnv.teamUUID}`],\n      'AbilityName': ['ConfigList'],\n    },\n    body: {\n      instance_id: `${globalThis.onesEnv.instanceId}`,\n      team_uuid: `${globalThis.onesEnv.teamUUID}`,\n      organization_uuid: `${globalThis.onesEnv.organizationUUID}`,\n    },\n  })\n  //@ts-ignore\n  const byteBody = response?.body || {}\n  console.log(byteBody)\n\n  const stringBody = byteBody.toString()\n  const JSONBody = JSON.parse(stringBody)\n\n  for (let i = 0; i < JSONBody.length; i++) {\n    Logger.info(JSONBody[i]['arg_key']) //Gets the key value of the configuration item\n    Logger.info(JSONBody[i]['arg_value']) //Gets the value of the configuration item\n  }\n  return {\n    body: response?.body.toString(),\n  }\n}\n")),(0,a.kt)("h3",{id:"2-add-in-the-new-tab"},"2. Add in the new tab"),(0,a.kt)("p",null,"Execute the ",(0,a.kt)("inlineCode",{parentName:"p"},"npx op add module")," instruction under the plug-in project directory, and select: ",(0,a.kt)("inlineCode",{parentName:"p"},"settings"),"."),(0,a.kt)("p",null,"After the execution is completed, a new configuration will be added under the ",(0,a.kt)("strong",{parentName:"p"},"modules")," attribute of the ",(0,a.kt)("inlineCode",{parentName:"p"},"plugin.yaml")," configuration file. The configuration is as follows:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"modules:\n  - id: settings-1cGv\n    title: Settings\n    moduleType: settings\n    entry: modules/settings-1cGv/index.html\n")),(0,a.kt)("p",null,"Now you can write your configuration page."),(0,a.kt)("h2",{id:"faq"},"FAQ"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Plugin upgrade and modify the original declaration of the plugin configuration did not take effect"),(0,a.kt)("p",{parentName:"li"},"Plugin upgrade does not support the modification of existing plugin configuration declaration, please refer to ",(0,a.kt)("a",{parentName:"p",href:"../../guide/upgrade#service.config"},"Upgrade"),"."))))}y.isMDXComponent=!0}}]);