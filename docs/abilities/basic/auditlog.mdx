---
sidebar_position: 8
description: Audit log are used in plugins.
---

import Image from '@theme/IdealImage'
import auditLog1 from './images/audit-log1.png'

# Audit log

## Requirements

| **ONES** |
| -------- |
| v3.6.0+  |

## Overview

The plugin can write the audit log to the ONES. You can see the contents of the audit log on the `Configuration -> System security-> Audit Log` page.

The operation type of audit log generated by plugin using this ability is **Plugin log**.

<Image img={auditLog1} />

## Usage

### Step 1：Installing dependencies

Run the following instructions under the plugin project root directory to install dependencies. (note that this ability is used by backend by default, and the usage directory is under `backend`)

```shell
cd backend
npm i @ones-op/node-ability
```

### Step 2：Call the `createLog` method in the plugin to write the audit log to ONES

> The `createLog` method requires two input parameters, one of which contains the structure of the `X-Real-Ip` and `Ones-User-Id` fields, as well as the audit information to be recorded `message`. `Ones-User-Id` is the uuid of the operator,`X-Real-Ip` is the IP address of the operator.

As shown in the following code, construct a structure `auditData` with `Ones-User-Id` and `Ones-User-Id` as the first input parameter, and take the audit information you want to record `message` as the second input parameter, and call the `createLog` method to write to the plugin audit log.

```typescript
import { AuditLog } from '@ones-op/node-ability'

export async function hello(request: PluginRequest): Promise<PluginResponse> {
  const body = request.body || {}
  let auditData = {
    'Ones-User-Id': 'icNcsEpo', //该参数为用户uuid
    'X-Real-Ip': '127.0.0.1', //IP地址
  }
  await AuditLog.createLog(auditData, '插件方法B') //写入审计信息
  return {
    body: {
      res: 'audit log',
      requestBody: body,
    },
  }
}
```

The header of `request` contains all the parameters required by the `createLog` method, so you can directly use the header of `request` as a parameter. The operator of the audit diary is the user accessing the interface, and the IP address of the audit log is the IP address of the user accessing the interface, as shown below.

```typescript
import { AuditLog } from '@ones-op/node-ability'

export async function hello(request: PluginRequest): Promise<PluginResponse> {
  const body = request.body || {}
  await AuditLog.createLog(request.headers, '插件方法A') //写入审计信息
  return {
    body: {
      res: 'audit log',
      requestBody: body,
    },
  }
}
```
