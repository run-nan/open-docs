import Image from '@theme/IdealImage'
import multiLan1 from './images/multiple-Languages1.png'
import multiLan2 from './images/multiple-Languages2.png'

# Plugin multilingual support

## Requirements

| **ONES** |
| :------- |
| 3.6+     |

## Overview

This ability allows the plugin to be synchronized with the language of the ONES . After the plugin is installed, the language of the plugin can be switched with the language switch of the ONES .

Take the details page of the plugin as an example, when the language of the ONES is Chinese, as shown in the following figure.

<Image img={multiLan1} />

After adjusting the language to English on `Personal Center -> language Setting`, the plugin details are shown in the figure below.

<Image img={multiLan2} />

As can be seen from above, the name description and configuration of the plugin are all shown in English.

## Usage

1. ### Use multiple languages in plugin configuration

   The multilingual implementation of the plugin configuration is relatively simple. Follow these steps to modify the configuration file.

   **Step 1**：Replace the places in the `config/plugin.yaml` file that need to use multiple languages with `{{.key}`, and replace 2 fields as shown below.

   ```yaml
   service:
     name: '{{.PluginName}}'
     description: '{{.PluginDescription}}'
   ```

   **Step 2**：Create a new `language` folder under the `workspace` folder under the plugin root directory, and create two new yaml files `en.yaml` and `zh.yaml` under the path `{{plugin root directory}}/workspace/language`. Write the Chinese value of `{{key}}`in `zh.yaml` and the English value in `en.yaml` as shown below.

   `{{plugin root directory}}/workspace/language/zh.yaml`

   ```yaml
   PluginName: 多语言
   PluginDescription: 这是一个支持中英文两种语言的插件
   ```

   `{{plugin root directory}}/workspace/language/en.yaml`

   ```yaml
   PluginName: Multil-Language-Plugin
   PluginDescription: The plugin is used to test Mult-Language abilities.
   ```

   This completes the use of multiple languages in the plugin configuration.

2. ### Plugin custom configuration items with multiple languages.

   The multilingual implementation of the plugin custom configuration item is also achieved by modifying the configuration file, but requires a few additional actions.

   **Step 1**：Add a new `label` field to the `config` configuration item in `config/plugin.yaml`, and replace it with `{{.key} `in `label`, as shown below. At the same time, the name of the `config` on the page is replaced by the value in the `label` field.

   ```yaml
   service:
   name: '{{.PluginName}}'
   description: '{{.PluginDescription}}'
   config:
      - key: configKey1
         label: '{{.Name}}'
         value: li
         type: Input
         required: true
      - key: configKey2
         label: '{{.Age}}'
         value: 20
         type: Input
         required: true
   ```

   **Step 2**：Add the corresponding values of `{{.key}}` in `zh.yaml` and `en.yaml`, as shown below.

   `{{plugin root directory}}\workspace\language\zh.yaml`

   ```yaml
   PluginName: 多语言
   PluginDescription: 这是一个支持中英文两种语言的插件
   Name: 姓名
   Age: 年龄
   ```

   `{{plugin root directory}}\workspace\language\en.yaml`

   ```yaml
   PluginName: Multil-Language-Plugin
   PluginDescription: The plugin is used to test Mult-Language abilities.
   Name: Name
   Age: Age
   ```

   In this way, the custom configuration items of the plugin also implement multiple languages.

3. ### Use multiple languages in plugin code

   Through API, plugin developers can obtain the user's locale. For variables that exist in `zh.yaml` and `en.yaml`, we can directly call API to obtain values, so as to build different return parameters according to the current locale.

   ```typescript
   import { Language } from '@ones-op/node-ability'

   export async function multiple_language() {
     // obtain the user's locale
     const language = await Language.getLanguage(user_uuid)
     // Get the PluginDescription value corresponding to the user's language
     const description = await Language.getLanguageString(language, 'PluginDescription')
     Logger.info(language)
     Logger.info(description)
   }
   ```

4. ### Plugin front-end uses multiple languages

   In the plugin, you can use `window` to access the global variables that we injected in the plugin execution environment to get the locale.
   We can get the current user's language settings to dynamically change the front-end display information, as shown below.

   ```javascript
      //Access the global variable to get the locale
      const locale = (window as any).__ones_op_locale__?.locale || 'zh-CN'

      const zhHans = {
      toast: '吐司',
      modal: '对话框',
      text: '你好',
      pwdErr: '请再次输入密码！',
      userNameErr: '用户名错误!',
      ok: '确定',
      cancel: '取消'
      }

      const en: typeof zhHans = {
      toast: 'toast',
      modal: 'Dialog',
      text: 'hello',
      pwdErr: 'please input password again',
      userNameErr: 'usename error!',
      ok: 'ok',
      cancel: 'cancel'
      }

      const resourceMap: { [_: string]: typeof zhHans } = {
      'zh-CN': zhHans,
      'en': en
      }

      const langResource = resourceMap[locale]
   ```

### Use suggestion:

When users switch languages, the functional parts of ONES that support multiple languages, their copywriting will change accordingly. If you want the effect of the plugin to be consistent with ONES , the plugin should:

1. The copy in the custom page of the plugin should be changed according to the language currently set by the user;
2. The return information of each prompt pop-up window of the plugin should be changed according to the language currently set by the user;
3. The display information in the plugin management page should be changed according to the user's current setting language；
