---
sidebar_position: 3
---

import Image from '@theme/IdealImage'
import scriptFieldSelection1 from './images/script-field-selection1.png'
import scriptFieldSelection2 from './images/script-field-selection2.png'
import scriptFieldSelection3 from './images/script-field-selection3.png'

# Plugin script field - Selection

## Requirements

| **ONES** |
| :------- |
| v3.6.0+  |

## Overview

This ability allows the plugin to implement a special `issue/project` field.Script field and system field of the same type are rerepresented in the same way in **ONES**(also supports searching through filters and sorting display).The difference between them is that the name of the script field is determined by the code of the plugin, the user cannot modify it on the ONES, and its individual option values are calculated by its own business logic,plugin developers can complete a variety of business development by implementing different rules for calculating the values of script field.

### Performance

When the plugin executes the install method, the issue field is created and added to the global fileds list. The user can add this field to the desired `issue type` or `project`.

:::caution

Script field added to issue item types are allowed to be removed, but cannot be removed after global script field list and script field in the project are added

:::

<br />

When this script field is added to a `issue type/project`, it behaves the same as other system fields.

<Image img={scriptFieldSelection1} />

### script field in `issue`

<Image img={scriptFieldSelection2} />

### script field in `project`

:::caution

- The current script fileds of project can only be used under the project's 'overview', but not under the project's fileds header.

:::

<Image img={scriptFieldSelection3} />

## Usage

You can use the ability by following these steps.

### Step 1: Add new content in the `apis` field in the plugin configuration file `config/plugin.yaml`.

This step is to expose an interface in the plugin through which ONES gets the option content of the script field when the user clicks on the script field generated by the ability.

Add `/scriptFieldSearch` to plugin configuration file `plugin.yaml`, this interface is shared by multiple script field.

```yaml
service:
  app_id: ...
  ...
apis:
  - type: addition
    methods:
      - POST
    url: /scriptFieldSearch
    function: GetOptions
```

### Step 2: Complete the creation of script field in the `install` method called when the plugin is installed

#### Use the `FieldsAdd` method to create script field under `issue`

```typescript
import { Field } from '@ones-op/node-ability'
import { Logger } from '@ones-op/node-logger'
import type { PluginRequest, PluginResponse } from '@ones-op/node-types'

export async function Install() {
  Logger.info('[Plugin] Install')
  //Call the script field add method to create a script field of type "radio menu"
  const FieldsAddRes = await Field.FieldsAdd({
    Name: '脚本属性-单选',
    Type: 1001, //Multiple selection code is 1002
    Renderer: 1,
    FilterOption: 0,
    SearchOption: 1,
  })
  if (FieldsAddRes.Error) {
    //If the addition fails, an exception is thrown
    throw new Error('Failed to create field')
  }
  //Add a UUID with a successfully returned field
  const { UUID: fieldUUID } = FieldsAddRes
  Logger.info('fieldUUID:', fieldUUID)
  return {
    body: {
      message: 'Field Add UUID:',
      fieldUUID,
    },
  }
}
```

**Parameter introduction**

| Param | Type   | Desc                                                       |
| :---- | :----- | :--------------------------------------------------------- |
| Name  | string | name of field                                              |
| Type  | int    | type of selection<br />- 1001：single<br/>- 1002：multiple |

#### Use the `ItemsAdd` method to create script field under `project`

```typescript
import { Field, FieldTypeEnum, PoolEnum } from '@ones-op/node-ability'
import { Logger } from '@ones-op/node-logger'

export async function Install() {
  Logger.info('[Plugin] Install')
  //添加项目属性
  const ItemsAddProjectRes = await Field.ItemsAdd({
    FieldType: FieldTypeEnum.SingleLabel, //表示添加单选类型脚本属性
    Name: 'project_field',
    ItemType: 'field',
    Pool: PoolEnum.Project, //实体类型为项目
    ContextType: 'team',
    required: false,
  })
  if (ItemsAddProjectRes.Error) {
    throw new Error('Failed to create field')
  }
  const { UUID: fieldUUID } = ItemsAddProjectRes //获取属性`uuid`
  return {
    body: {
      message: 'Field Add UUID:',
      fieldUUID,
    },
  }
}
```

**ItemsAdd Parameter introduction**

| Param       | Type   | Desc                                                                                                  |
| :---------- | :----- | :---------------------------------------------------------------------------------------------------- |
| FieldType   | string | type of field：<br />- `FieldTypeEnum.SingleLabel`: single<br />- `FieldTypeEnum.MultiLabel`:multiple |
| Name        | string | name of field                                                                                         |
| ItemType    | string | fixed value：`field`                                                                                  |
| Pool        | string | fixed value: `PoolEnum.Project`                                                                       |
| ContextType | string | content                                                                                               |
| required    | bool   | requirement or not                                                                                    |

### Step 3: In the `GetOptions` method, complete the construction of the script field option values in the following format.

Write the `GetOptions` processing function. If there are multiple **single/multiple selection script fileds** at the same time, you can process different script fileds according to the `fieldUUID` returned when adding the script field.

ONES loads the option values of script fileds through the plugin's `GetOptions` method.

```typescript
interface OptionType {
  uuid: string //属性值`UUID`
  value: string //属性值
}

export async function GetOptions(request: PluginRequest): Promise<PluginResponse> {
  const body = request?.body as any
  const options: OptionType[] = [] //返回的选项数据

  for (let i = 0; i < 3; i++) {
    options.push({
      uuid: 'optionsUUID' + i.toString(), //选项值的`uuid`，开发者自定义
      value: '选项值' + i.toString(), //选项值
    })
  }

  return {
    body: {
      code: 200,
      body: {
        options: options,
      },
    },
  }
}
```

## Examples

- [Location information field](sample-script-field-selection1.mdx)
