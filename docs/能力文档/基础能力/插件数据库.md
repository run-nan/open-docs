---
title: 插件数据库
order: 2
group:
    title: 基础能力
    order: 1
nav:
    title: 能力文档
    order: 4
    toc: menu
---

| 能力代号 | 能力名称   |
| -------- | ---------- |
| Database | 插件数据库 |

## 能力描述

提供访问插件数据库能力。

## 能力声明

```ts
import { select, count, exec, importSql } from '@ones-op/node-database'
```

## API

### importSql

数据库操作方法

example:

```ts
async function importSql() {
  await importSql("plugin.sql")
}
```

workspace/plugin.sql

```sql
CREATE TABLE IF NOT EXISTS `{{email_id_map}}`  (
    `email` varchar(128) CHARACTER SET latin1 NOT NULL COMMENT '邮箱',
    `id_number` varchar(128) CHARACTER SET utf8mb4 DEFAULT NULL COMMENT '工号',
  PRIMARY KEY (`email`)
) ENGINE = InnoDB DEFAULT CHARSET=latin1 COLLATE=latin1_bin;
```

入参

| 参数         | 类型     | 说明                                 | 默认值 |
| :----------- | -------- | ------------------------------------ | ------ |
| sqlFileName* | `string` | SQL文件位置（以workspace为相对路径） | -      |

返回

| 参数 | 类型 | 说明 |
| ---- | ---- | ---- |
| data | void | -    |

### select

数据库查询方法

example: 

```ts
async function Select() {
  const result: Record<string, any>[] = await select("select * from email_id_map limit 10;")
  return result
}
```

入参

| 参数 | 类型     | 说明            | 默认值 |
| :--- | -------- | --------------- | ------ |
| sql* | `string` | SQL select 查询 | -      |

返回

| 参数 | 类型       | 说明                                                         |
| ---- | ---------- | ------------------------------------------------------------ |
| data | `object[]` | 对象数组，每一个对象都是一条数据，对象的key是SQL的字段，example: [{email: 'plugin@ones.ai', id_number: '001'}] |

### exec

数据库操作方法

example:

```ts
async function Exec() {
  await exec("insert", `INSERT INTO email_id_map VALUES ("plugin@ones.ai", "001");`)
}
```

入参

| 参数     | 类型                                                         | 说明        | 默认值 |
| :------- | ------------------------------------------------------------ | ----------- | ------ |
| operate* | `'insert' \| 'update' \| 'delete' \| 'create' \| 'alter' \| 'drop'` | 操作类型    | -      |
| sql*     | `string`                                                     | SQL执行语句 | -      |

返回

| 参数 | 类型 | 说明 |
| ---- | ---- | ---- |
| data | void | -    |

### count

数据库计数方法

example: 

```ts
async function Count() {
  const c: number = await count("select count(*) from email_id_map;")
  return c
}
```

入参

| 参数 | 类型     | 说明                  | 默认值 |
| :--- | -------- | --------------------- | ------ |
| sql* | `string` | SQL select count 查询 | -      |

返回

| 参数 | 类型     | 说明 |
| ---- | -------- | ---- |
| data | `number` | -    |

## 示例插件

[node-plugin-example](https://gitlab.plugins.myones.net/example/node-plugin-demo/)

## FAQ

1. 本地开发使用本地数据库进行调试

   修改`config/local.yaml`中的配置，再重新执行`run`命令重启服务

   ```yaml
   local:
     mysql_in_local: true
     mysql_user_name: "your mysql user name"
     mysql_user_password: "your mysql user password"
     mysql_database_name: "your mysql database name"
     mysql_host: "your mysql host"
     mysql_port: "your mysql port"
   ```