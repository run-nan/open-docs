---
title: 简单登录校验
order: 1
group:
    title: 业务开放能力
    order: 3
---

|  能力代号  |   能力名称   |
| :--------: | :----------: |
| SimpleAuth | 简单登录校验 |

## 能力描述

为插件提供对接第三方登录校验协议的能力



## 能力使用

### 能力声明

#### 1. 在插件的 plugin.yaml

```yaml
abilities:
  - id: simple-login // id 可以自定义
    name: 登录  // name 自定义
    abilityType: SimpleAuth //  SimpleAuth 为简单登录能力
    function:
      validateFunc: SimpleAuthValidate  // 需要替换 validateFunc 的方法名
```



nodejs实例代码如下，

```javascript
import { Logger } from '@ones-op/node-logger'

export async function SimpleAuthValidate(request: any) {
	const body = request.body || {}
	Logger.info('[Plugin] SimpleAuthValidate =======', body)
	return {
		body: {
			code: 200,
			data: {
				uuid: "QmPCusvS",
			},
		}
	}
}
```




### 实现过程

1. 开放平台会根据需要向标品注册路由 `POST /ability/simple_auth_login`
2. 用户使用路由注册，开放平台会转发请求到 bang-api 的 `POST /internal_plugin_platform//ability/simple_login`
3. bang-api 的简单登录认证拆分成为了2个步骤， 第一步是使用平台的能力调用插件的 validateFunc 替换的实现进行校验。第二步是为用户生产 Token 并返回

相关代码实现，

```go
// bang-api 如何 CallAbilityFunc
resp, err := plugin.CallAbilityFunc(s.TeamUUID, request, "SimpleAuth", "validateFunc")

// 插件替换的实现 返回体中需要包含uuid
func (p *mockPlugin) SimpleAuthValidate(req *common.HttpRequest) *common.HttpResponse {
    uuidObj := &map[string]interface{}{
        "uuid": uuid,
    }

    return buildOkResp(uuidObj)
}
```



## 示例插件

P8024 插件地址 : https://github.com/BangWork/ones-platform-plugin/tree/P8024/zhongfu-account-sso